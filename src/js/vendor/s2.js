(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.S2=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){(function(globalScope){"use strict";var EXP_LIMIT=9e15,MAX_DIGITS=1e9,NUMERALS="0123456789abcdef",LN10="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",PI="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Decimal={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-EXP_LIMIT,maxE:EXP_LIMIT,crypto:void 0},inexact,noConflict,quadrant,cryptoObject=typeof crypto!="undefined"?crypto:null,external=true,decimalError="[DecimalError] ",invalidArgument=decimalError+"Invalid argument: ",precisionLimitExceeded=decimalError+"Precision limit exceeded",mathfloor=Math.floor,mathpow=Math.pow,isBinary=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,isHex=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,isOctal=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,isDecimal=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,BASE=1e7,LOG_BASE=7,MAX_SAFE_INTEGER=9007199254740991,LN10_PRECISION=LN10.length-1,PI_PRECISION=PI.length-1,P={};P.absoluteValue=P.abs=function(){var x=new this.constructor(this);if(x.s<0)x.s=1;return finalise(x)};P.ceil=function(){return finalise(new this.constructor(this),this.e+1,2)};P.comparedTo=P.cmp=function(y){var i,j,xdL,ydL,x=this,xd=x.d,yd=(y=new x.constructor(y)).d,xs=x.s,ys=y.s;if(!xd||!yd){return!xs||!ys?NaN:xs!==ys?xs:xd===yd?0:!xd^xs<0?1:-1}if(!xd[0]||!yd[0])return xd[0]?xs:yd[0]?-ys:0;if(xs!==ys)return xs;if(x.e!==y.e)return x.e>y.e^xs<0?1:-1;xdL=xd.length;ydL=yd.length;for(i=0,j=xdL<ydL?xdL:ydL;i<j;++i){if(xd[i]!==yd[i])return xd[i]>yd[i]^xs<0?1:-1}return xdL===ydL?0:xdL>ydL^xs<0?1:-1};P.cosine=P.cos=function(){var pr,rm,x=this,Ctor=x.constructor;if(!x.d)return new Ctor(NaN);if(!x.d[0])return new Ctor(1);pr=Ctor.precision;rm=Ctor.rounding;Ctor.precision=pr+Math.max(x.e,x.sd())+LOG_BASE;Ctor.rounding=1;x=cosine(Ctor,toLessThanHalfPi(Ctor,x));Ctor.precision=pr;Ctor.rounding=rm;return finalise(quadrant==2||quadrant==3?x.neg():x,pr,rm,true)};P.cubeRoot=P.cbrt=function(){var e,m,n,r,rep,s,sd,t,t3,t3plusx,x=this,Ctor=x.constructor;if(!x.isFinite()||x.isZero())return new Ctor(x);external=false;s=x.s*Math.pow(x.s*x,1/3);if(!s||Math.abs(s)==1/0){n=digitsToString(x.d);e=x.e;if(s=(e-n.length+1)%3)n+=s==1||s==-2?"0":"00";s=Math.pow(n,1/3);e=mathfloor((e+1)/3)-(e%3==(e<0?-1:2));if(s==1/0){n="5e"+e}else{n=s.toExponential();n=n.slice(0,n.indexOf("e")+1)+e}r=new Ctor(n);r.s=x.s}else{r=new Ctor(s.toString())}sd=(e=Ctor.precision)+3;for(;;){t=r;t3=t.times(t).times(t);t3plusx=t3.plus(x);r=divide(t3plusx.plus(x).times(t),t3plusx.plus(t3),sd+2,1);if(digitsToString(t.d).slice(0,sd)===(n=digitsToString(r.d)).slice(0,sd)){n=n.slice(sd-3,sd+1);if(n=="9999"||!rep&&n=="4999"){if(!rep){finalise(t,e+1,0);if(t.times(t).times(t).eq(x)){r=t;break}}sd+=4;rep=1}else{if(!+n||!+n.slice(1)&&n.charAt(0)=="5"){finalise(r,e+1,1);m=!r.times(r).times(r).eq(x)}break}}}external=true;return finalise(r,e,Ctor.rounding,m)};P.decimalPlaces=P.dp=function(){var w,d=this.d,n=NaN;if(d){w=d.length-1;n=(w-mathfloor(this.e/LOG_BASE))*LOG_BASE;w=d[w];if(w)for(;w%10==0;w/=10)n--;if(n<0)n=0}return n};P.dividedBy=P.div=function(y){return divide(this,new this.constructor(y))};P.dividedToIntegerBy=P.divToInt=function(y){var x=this,Ctor=x.constructor;return finalise(divide(x,new Ctor(y),0,1,1),Ctor.precision,Ctor.rounding)};P.equals=P.eq=function(y){return this.cmp(y)===0};P.floor=function(){return finalise(new this.constructor(this),this.e+1,3)};P.greaterThan=P.gt=function(y){return this.cmp(y)>0};P.greaterThanOrEqualTo=P.gte=function(y){var k=this.cmp(y);return k==1||k===0};P.hyperbolicCosine=P.cosh=function(){var k,n,pr,rm,len,x=this,Ctor=x.constructor,one=new Ctor(1);if(!x.isFinite())return new Ctor(x.s?1/0:NaN);if(x.isZero())return one;pr=Ctor.precision;rm=Ctor.rounding;Ctor.precision=pr+Math.max(x.e,x.sd())+4;Ctor.rounding=1;len=x.d.length;if(len<32){k=Math.ceil(len/3);n=Math.pow(4,-k).toString()}else{k=16;n="2.3283064365386962890625e-10"}x=taylorSeries(Ctor,1,x.times(n),new Ctor(1),true);var cosh2_x,i=k,d8=new Ctor(8);for(;i--;){cosh2_x=x.times(x);x=one.minus(cosh2_x.times(d8.minus(cosh2_x.times(d8))))}return finalise(x,Ctor.precision=pr,Ctor.rounding=rm,true)};P.hyperbolicSine=P.sinh=function(){var k,pr,rm,len,x=this,Ctor=x.constructor;if(!x.isFinite()||x.isZero())return new Ctor(x);pr=Ctor.precision;rm=Ctor.rounding;Ctor.precision=pr+Math.max(x.e,x.sd())+4;Ctor.rounding=1;len=x.d.length;if(len<3){x=taylorSeries(Ctor,2,x,x,true)}else{k=1.4*Math.sqrt(len);k=k>16?16:k|0;x=x.times(Math.pow(5,-k));x=taylorSeries(Ctor,2,x,x,true);var sinh2_x,d5=new Ctor(5),d16=new Ctor(16),d20=new Ctor(20);for(;k--;){sinh2_x=x.times(x);x=x.times(d5.plus(sinh2_x.times(d16.times(sinh2_x).plus(d20))))}}Ctor.precision=pr;Ctor.rounding=rm;return finalise(x,pr,rm,true)};P.hyperbolicTangent=P.tanh=function(){var pr,rm,x=this,Ctor=x.constructor;if(!x.isFinite())return new Ctor(x.s);if(x.isZero())return new Ctor(x);pr=Ctor.precision;rm=Ctor.rounding;Ctor.precision=pr+7;Ctor.rounding=1;return divide(x.sinh(),x.cosh(),Ctor.precision=pr,Ctor.rounding=rm)};P.inverseCosine=P.acos=function(){var halfPi,x=this,Ctor=x.constructor,k=x.abs().cmp(1),pr=Ctor.precision,rm=Ctor.rounding;if(k!==-1){return k===0?x.isNeg()?getPi(Ctor,pr,rm):new Ctor(0):new Ctor(NaN)}if(x.isZero())return getPi(Ctor,pr+4,rm).times(.5);Ctor.precision=pr+6;Ctor.rounding=1;x=x.asin();halfPi=getPi(Ctor,pr+4,rm).times(.5);Ctor.precision=pr;Ctor.rounding=rm;return halfPi.minus(x)};P.inverseHyperbolicCosine=P.acosh=function(){var pr,rm,x=this,Ctor=x.constructor;if(x.lte(1))return new Ctor(x.eq(1)?0:NaN);if(!x.isFinite())return new Ctor(x);pr=Ctor.precision;rm=Ctor.rounding;Ctor.precision=pr+Math.max(Math.abs(x.e),x.sd())+4;Ctor.rounding=1;external=false;x=x.times(x).minus(1).sqrt().plus(x);external=true;Ctor.precision=pr;Ctor.rounding=rm;return x.ln()};P.inverseHyperbolicSine=P.asinh=function(){var pr,rm,x=this,Ctor=x.constructor;if(!x.isFinite()||x.isZero())return new Ctor(x);pr=Ctor.precision;rm=Ctor.rounding;Ctor.precision=pr+2*Math.max(Math.abs(x.e),x.sd())+6;Ctor.rounding=1;external=false;x=x.times(x).plus(1).sqrt().plus(x);external=true;Ctor.precision=pr;Ctor.rounding=rm;return x.ln()};P.inverseHyperbolicTangent=P.atanh=function(){var pr,rm,wpr,xsd,x=this,Ctor=x.constructor;if(!x.isFinite())return new Ctor(NaN);if(x.e>=0)return new Ctor(x.abs().eq(1)?x.s/0:x.isZero()?x:NaN);pr=Ctor.precision;rm=Ctor.rounding;xsd=x.sd();if(Math.max(xsd,pr)<2*-x.e-1)return finalise(new Ctor(x),pr,rm,true);Ctor.precision=wpr=xsd-x.e;x=divide(x.plus(1),new Ctor(1).minus(x),wpr+pr,1);Ctor.precision=pr+4;Ctor.rounding=1;x=x.ln();Ctor.precision=pr;Ctor.rounding=rm;return x.times(.5)};P.inverseSine=P.asin=function(){var halfPi,k,pr,rm,x=this,Ctor=x.constructor;if(x.isZero())return new Ctor(x);k=x.abs().cmp(1);pr=Ctor.precision;rm=Ctor.rounding;if(k!==-1){if(k===0){halfPi=getPi(Ctor,pr+4,rm).times(.5);halfPi.s=x.s;return halfPi}return new Ctor(NaN)}Ctor.precision=pr+6;Ctor.rounding=1;x=x.div(new Ctor(1).minus(x.times(x)).sqrt().plus(1)).atan();Ctor.precision=pr;Ctor.rounding=rm;return x.times(2)};P.inverseTangent=P.atan=function(){var i,j,k,n,px,t,r,wpr,x2,x=this,Ctor=x.constructor,pr=Ctor.precision,rm=Ctor.rounding;if(!x.isFinite()){if(!x.s)return new Ctor(NaN);if(pr+4<=PI_PRECISION){r=getPi(Ctor,pr+4,rm).times(.5);r.s=x.s;return r}}else if(x.isZero()){return new Ctor(x)}else if(x.abs().eq(1)&&pr+4<=PI_PRECISION){r=getPi(Ctor,pr+4,rm).times(.25);r.s=x.s;return r}Ctor.precision=wpr=pr+10;Ctor.rounding=1;k=Math.min(28,wpr/LOG_BASE+2|0);for(i=k;i;--i)x=x.div(x.times(x).plus(1).sqrt().plus(1));external=false;j=Math.ceil(wpr/LOG_BASE);n=1;x2=x.times(x);r=new Ctor(x);px=x;for(;i!==-1;){px=px.times(x2);t=r.minus(px.div(n+=2));px=px.times(x2);r=t.plus(px.div(n+=2));if(r.d[j]!==void 0)for(i=j;r.d[i]===t.d[i]&&i--;);}if(k)r=r.times(2<<k-1);external=true;return finalise(r,Ctor.precision=pr,Ctor.rounding=rm,true)};P.isFinite=function(){return!!this.d};P.isInteger=P.isInt=function(){return!!this.d&&mathfloor(this.e/LOG_BASE)>this.d.length-2};P.isNaN=function(){return!this.s};P.isNegative=P.isNeg=function(){return this.s<0};P.isPositive=P.isPos=function(){return this.s>0};P.isZero=function(){return!!this.d&&this.d[0]===0};P.lessThan=P.lt=function(y){return this.cmp(y)<0};P.lessThanOrEqualTo=P.lte=function(y){return this.cmp(y)<1};P.logarithm=P.log=function(base){var isBase10,d,denominator,k,inf,num,sd,r,arg=this,Ctor=arg.constructor,pr=Ctor.precision,rm=Ctor.rounding,guard=5;if(base==null){base=new Ctor(10);isBase10=true}else{base=new Ctor(base);d=base.d;if(base.s<0||!d||!d[0]||base.eq(1))return new Ctor(NaN);isBase10=base.eq(10)}d=arg.d;if(arg.s<0||!d||!d[0]||arg.eq(1)){return new Ctor(d&&!d[0]?-1/0:arg.s!=1?NaN:d?0:1/0)}if(isBase10){if(d.length>1){inf=true}else{for(k=d[0];k%10===0;)k/=10;inf=k!==1}}external=false;sd=pr+guard;num=naturalLogarithm(arg,sd);denominator=isBase10?getLn10(Ctor,sd+10):naturalLogarithm(base,sd);r=divide(num,denominator,sd,1);if(checkRoundingDigits(r.d,k=pr,rm)){do{sd+=10;num=naturalLogarithm(arg,sd);denominator=isBase10?getLn10(Ctor,sd+10):naturalLogarithm(base,sd);r=divide(num,denominator,sd,1);if(!inf){if(+digitsToString(r.d).slice(k+1,k+15)+1==1e14){r=finalise(r,pr+1,0)}break}}while(checkRoundingDigits(r.d,k+=10,rm))}external=true;return finalise(r,pr,rm)};P.minus=P.sub=function(y){var d,e,i,j,k,len,pr,rm,xd,xe,xLTy,yd,x=this,Ctor=x.constructor;y=new Ctor(y);if(!x.d||!y.d){if(!x.s||!y.s)y=new Ctor(NaN);else if(x.d)y.s=-y.s;else y=new Ctor(y.d||x.s!==y.s?x:NaN);return y}if(x.s!=y.s){y.s=-y.s;return x.plus(y)}xd=x.d;yd=y.d;pr=Ctor.precision;rm=Ctor.rounding;if(!xd[0]||!yd[0]){if(yd[0])y.s=-y.s;else if(xd[0])y=new Ctor(x);else return new Ctor(rm===3?-0:0);return external?finalise(y,pr,rm):y}e=mathfloor(y.e/LOG_BASE);xe=mathfloor(x.e/LOG_BASE);xd=xd.slice();k=xe-e;if(k){xLTy=k<0;if(xLTy){d=xd;k=-k;len=yd.length}else{d=yd;e=xe;len=xd.length}i=Math.max(Math.ceil(pr/LOG_BASE),len)+2;if(k>i){k=i;d.length=1}d.reverse();for(i=k;i--;)d.push(0);d.reverse()}else{i=xd.length;len=yd.length;xLTy=i<len;if(xLTy)len=i;for(i=0;i<len;i++){if(xd[i]!=yd[i]){xLTy=xd[i]<yd[i];break}}k=0}if(xLTy){d=xd;xd=yd;yd=d;y.s=-y.s}len=xd.length;for(i=yd.length-len;i>0;--i)xd[len++]=0;for(i=yd.length;i>k;){if(xd[--i]<yd[i]){for(j=i;j&&xd[--j]===0;)xd[j]=BASE-1;--xd[j];xd[i]+=BASE}xd[i]-=yd[i]}for(;xd[--len]===0;)xd.pop();for(;xd[0]===0;xd.shift())--e;if(!xd[0])return new Ctor(rm===3?-0:0);y.d=xd;y.e=getBase10Exponent(xd,e);return external?finalise(y,pr,rm):y};P.modulo=P.mod=function(y){var q,x=this,Ctor=x.constructor;y=new Ctor(y);if(!x.d||!y.s||y.d&&!y.d[0])return new Ctor(NaN);if(!y.d||x.d&&!x.d[0]){return finalise(new Ctor(x),Ctor.precision,Ctor.rounding)}external=false;if(Ctor.modulo==9){q=divide(x,y.abs(),0,3,1);q.s*=y.s}else{q=divide(x,y,0,Ctor.modulo,1)}q=q.times(y);external=true;return x.minus(q)};P.naturalExponential=P.exp=function(){return naturalExponential(this)};P.naturalLogarithm=P.ln=function(){return naturalLogarithm(this)};P.negated=P.neg=function(){var x=new this.constructor(this);x.s=-x.s;return finalise(x)};P.plus=P.add=function(y){var carry,d,e,i,k,len,pr,rm,xd,yd,x=this,Ctor=x.constructor;y=new Ctor(y);if(!x.d||!y.d){if(!x.s||!y.s)y=new Ctor(NaN);else if(!x.d)y=new Ctor(y.d||x.s===y.s?x:NaN);return y}if(x.s!=y.s){y.s=-y.s;return x.minus(y)}xd=x.d;yd=y.d;pr=Ctor.precision;rm=Ctor.rounding;if(!xd[0]||!yd[0]){if(!yd[0])y=new Ctor(x);return external?finalise(y,pr,rm):y}k=mathfloor(x.e/LOG_BASE);e=mathfloor(y.e/LOG_BASE);xd=xd.slice();i=k-e;if(i){if(i<0){d=xd;i=-i;len=yd.length}else{d=yd;e=k;len=xd.length}k=Math.ceil(pr/LOG_BASE);len=k>len?k+1:len+1;if(i>len){i=len;d.length=1}d.reverse();for(;i--;)d.push(0);d.reverse()}len=xd.length;i=yd.length;if(len-i<0){i=len;d=yd;yd=xd;xd=d}for(carry=0;i;){carry=(xd[--i]=xd[i]+yd[i]+carry)/BASE|0;xd[i]%=BASE}if(carry){xd.unshift(carry);++e}for(len=xd.length;xd[--len]==0;)xd.pop();y.d=xd;y.e=getBase10Exponent(xd,e);return external?finalise(y,pr,rm):y};P.precision=P.sd=function(z){var k,x=this;if(z!==void 0&&z!==!!z&&z!==1&&z!==0)throw Error(invalidArgument+z);if(x.d){k=getPrecision(x.d);if(z&&x.e+1>k)k=x.e+1}else{k=NaN}return k};P.round=function(){var x=this,Ctor=x.constructor;return finalise(new Ctor(x),x.e+1,Ctor.rounding)};P.sine=P.sin=function(){var pr,rm,x=this,Ctor=x.constructor;if(!x.isFinite())return new Ctor(NaN);if(x.isZero())return new Ctor(x);pr=Ctor.precision;rm=Ctor.rounding;Ctor.precision=pr+Math.max(x.e,x.sd())+LOG_BASE;Ctor.rounding=1;x=sine(Ctor,toLessThanHalfPi(Ctor,x));Ctor.precision=pr;Ctor.rounding=rm;return finalise(quadrant>2?x.neg():x,pr,rm,true)};P.squareRoot=P.sqrt=function(){var m,n,sd,r,rep,t,x=this,d=x.d,e=x.e,s=x.s,Ctor=x.constructor;if(s!==1||!d||!d[0]){return new Ctor(!s||s<0&&(!d||d[0])?NaN:d?x:1/0)}external=false;s=Math.sqrt(+x);if(s==0||s==1/0){n=digitsToString(d);if((n.length+e)%2==0)n+="0";s=Math.sqrt(n);e=mathfloor((e+1)/2)-(e<0||e%2);if(s==1/0){n="1e"+e}else{n=s.toExponential();n=n.slice(0,n.indexOf("e")+1)+e}r=new Ctor(n)}else{r=new Ctor(s.toString())}sd=(e=Ctor.precision)+3;for(;;){t=r;r=t.plus(divide(x,t,sd+2,1)).times(.5);if(digitsToString(t.d).slice(0,sd)===(n=digitsToString(r.d)).slice(0,sd)){n=n.slice(sd-3,sd+1);if(n=="9999"||!rep&&n=="4999"){if(!rep){finalise(t,e+1,0);if(t.times(t).eq(x)){r=t;break}}sd+=4;rep=1}else{if(!+n||!+n.slice(1)&&n.charAt(0)=="5"){finalise(r,e+1,1);m=!r.times(r).eq(x)}break}}}external=true;return finalise(r,e,Ctor.rounding,m)};P.tangent=P.tan=function(){var pr,rm,x=this,Ctor=x.constructor;if(!x.isFinite())return new Ctor(NaN);if(x.isZero())return new Ctor(x);pr=Ctor.precision;rm=Ctor.rounding;Ctor.precision=pr+10;Ctor.rounding=1;x=x.sin();x.s=1;x=divide(x,new Ctor(1).minus(x.times(x)).sqrt(),pr+10,0);Ctor.precision=pr;Ctor.rounding=rm;return finalise(quadrant==2||quadrant==4?x.neg():x,pr,rm,true)};P.times=P.mul=function(y){var carry,e,i,k,r,rL,t,xdL,ydL,x=this,Ctor=x.constructor,xd=x.d,yd=(y=new Ctor(y)).d;y.s*=x.s;if(!xd||!xd[0]||!yd||!yd[0]){return new Ctor(!y.s||xd&&!xd[0]&&!yd||yd&&!yd[0]&&!xd?NaN:!xd||!yd?y.s/0:y.s*0)}e=mathfloor(x.e/LOG_BASE)+mathfloor(y.e/LOG_BASE);xdL=xd.length;ydL=yd.length;if(xdL<ydL){r=xd;xd=yd;yd=r;rL=xdL;xdL=ydL;ydL=rL}r=[];rL=xdL+ydL;for(i=rL;i--;)r.push(0);for(i=ydL;--i>=0;){carry=0;for(k=xdL+i;k>i;){t=r[k]+yd[i]*xd[k-i-1]+carry;r[k--]=t%BASE|0;carry=t/BASE|0}r[k]=(r[k]+carry)%BASE|0}for(;!r[--rL];)r.pop();if(carry)++e;else r.shift();for(i=r.length;!r[--i];)r.pop();y.d=r;y.e=getBase10Exponent(r,e);return external?finalise(y,Ctor.precision,Ctor.rounding):y};P.toBinary=function(sd,rm){return toStringBinary(this,2,sd,rm)};P.toDecimalPlaces=P.toDP=function(dp,rm){var x=this,Ctor=x.constructor;x=new Ctor(x);if(dp===void 0)return x;checkInt32(dp,0,MAX_DIGITS);if(rm===void 0)rm=Ctor.rounding;else checkInt32(rm,0,8);return finalise(x,dp+x.e+1,rm)};P.toExponential=function(dp,rm){var str,x=this,Ctor=x.constructor;if(dp===void 0){str=finiteToString(x,true)}else{checkInt32(dp,0,MAX_DIGITS);if(rm===void 0)rm=Ctor.rounding;else checkInt32(rm,0,8);x=finalise(new Ctor(x),dp+1,rm);str=finiteToString(x,true,dp+1)}return x.isNeg()&&!x.isZero()?"-"+str:str};P.toFixed=function(dp,rm){var str,y,x=this,Ctor=x.constructor;if(dp===void 0){str=finiteToString(x)}else{checkInt32(dp,0,MAX_DIGITS);if(rm===void 0)rm=Ctor.rounding;else checkInt32(rm,0,8);y=finalise(new Ctor(x),dp+x.e+1,rm);str=finiteToString(y,false,dp+y.e+1)}return x.isNeg()&&!x.isZero()?"-"+str:str};P.toFraction=function(maxD){var d,d0,d1,d2,e,k,n,n0,n1,pr,q,r,x=this,xd=x.d,Ctor=x.constructor;if(!xd)return new Ctor(x);n1=d0=new Ctor(1);d1=n0=new Ctor(0);d=new Ctor(d1);e=d.e=getPrecision(xd)-x.e-1;k=e%LOG_BASE;d.d[0]=mathpow(10,k<0?LOG_BASE+k:k);if(maxD==null){maxD=e>0?d:n1}else{n=new Ctor(maxD);if(!n.isInt()||n.lt(n1))throw Error(invalidArgument+n);maxD=n.gt(d)?e>0?d:n1:n}external=false;n=new Ctor(digitsToString(xd));pr=Ctor.precision;Ctor.precision=e=xd.length*LOG_BASE*2;for(;;){q=divide(n,d,0,1,1);d2=d0.plus(q.times(d1));if(d2.cmp(maxD)==1)break;d0=d1;d1=d2;d2=n1;n1=n0.plus(q.times(d2));n0=d2;d2=d;d=n.minus(q.times(d2));n=d2}d2=divide(maxD.minus(d0),d1,0,1,1);n0=n0.plus(d2.times(n1));d0=d0.plus(d2.times(d1));n0.s=n1.s=x.s;r=divide(n1,d1,e,1).minus(x).abs().cmp(divide(n0,d0,e,1).minus(x).abs())<1?[n1,d1]:[n0,d0];Ctor.precision=pr;external=true;return r};P.toHexadecimal=P.toHex=function(sd,rm){return toStringBinary(this,16,sd,rm)};P.toNearest=function(y,rm){var x=this,Ctor=x.constructor;x=new Ctor(x);if(y==null){if(!x.d)return x;y=new Ctor(1);rm=Ctor.rounding}else{y=new Ctor(y);if(rm!==void 0)checkInt32(rm,0,8);if(!x.d)return y.s?x:y;if(!y.d){if(y.s)y.s=x.s;return y}}if(y.d[0]){external=false;if(rm<4)rm=[4,5,7,8][rm];x=divide(x,y,0,rm,1).times(y);external=true;finalise(x)}else{y.s=x.s;x=y}return x};P.toNumber=function(){return+this};P.toOctal=function(sd,rm){return toStringBinary(this,8,sd,rm)};P.toPower=P.pow=function(y){var e,k,pr,r,rm,sign,yIsInt,x=this,Ctor=x.constructor,yn=+(y=new Ctor(y));if(!x.d||!y.d||!x.d[0]||!y.d[0])return new Ctor(mathpow(+x,yn));x=new Ctor(x);if(x.eq(1))return x;pr=Ctor.precision;rm=Ctor.rounding;if(y.eq(1))return finalise(x,pr,rm);e=mathfloor(y.e/LOG_BASE);k=y.d.length-1;yIsInt=e>=k;sign=x.s;if(!yIsInt){if(sign<0)return new Ctor(NaN)}else if((k=yn<0?-yn:yn)<=MAX_SAFE_INTEGER){r=intPow(Ctor,x,k,pr);return y.s<0?new Ctor(1).div(r):finalise(r,pr,rm)}sign=sign<0&&y.d[Math.max(e,k)]&1?-1:1;k=mathpow(+x,yn);e=k==0||!isFinite(k)?mathfloor(yn*(Math.log("0."+digitsToString(x.d))/Math.LN10+x.e+1)):new Ctor(k+"").e;if(e>Ctor.maxE+1||e<Ctor.minE-1)return new Ctor(e>0?sign/0:0);external=false;Ctor.rounding=x.s=1;k=Math.min(12,(e+"").length);r=naturalExponential(y.times(naturalLogarithm(x,pr+k)),pr);r=finalise(r,pr+5,1);if(checkRoundingDigits(r.d,pr,rm)){e=pr+10;r=finalise(naturalExponential(y.times(naturalLogarithm(x,e+k)),e),e+5,1);if(+digitsToString(r.d).slice(pr+1,pr+15)+1==1e14){r=finalise(r,pr+1,0)}}r.s=sign;external=true;Ctor.rounding=rm;return finalise(r,pr,rm)};P.toPrecision=function(sd,rm){var str,x=this,Ctor=x.constructor;if(sd===void 0){str=finiteToString(x,x.e<=Ctor.toExpNeg||x.e>=Ctor.toExpPos)}else{checkInt32(sd,1,MAX_DIGITS);if(rm===void 0)rm=Ctor.rounding;else checkInt32(rm,0,8);x=finalise(new Ctor(x),sd,rm);str=finiteToString(x,sd<=x.e||x.e<=Ctor.toExpNeg,sd)}return x.isNeg()&&!x.isZero()?"-"+str:str};P.toSignificantDigits=P.toSD=function(sd,rm){var x=this,Ctor=x.constructor;if(sd===void 0){sd=Ctor.precision;rm=Ctor.rounding}else{checkInt32(sd,1,MAX_DIGITS);if(rm===void 0)rm=Ctor.rounding;else checkInt32(rm,0,8)}return finalise(new Ctor(x),sd,rm)};P.toString=function(){var x=this,Ctor=x.constructor,str=finiteToString(x,x.e<=Ctor.toExpNeg||x.e>=Ctor.toExpPos);return x.isNeg()&&!x.isZero()?"-"+str:str};P.truncated=P.trunc=function(){return finalise(new this.constructor(this),this.e+1,1)};P.valueOf=P.toJSON=function(){var x=this,Ctor=x.constructor,str=finiteToString(x,x.e<=Ctor.toExpNeg||x.e>=Ctor.toExpPos);return x.isNeg()?"-"+str:str};function digitsToString(d){var i,k,ws,indexOfLastWord=d.length-1,str="",w=d[0];if(indexOfLastWord>0){str+=w;for(i=1;i<indexOfLastWord;i++){ws=d[i]+"";k=LOG_BASE-ws.length;if(k)str+=getZeroString(k);str+=ws}w=d[i];ws=w+"";k=LOG_BASE-ws.length;if(k)str+=getZeroString(k)}else if(w===0){return"0"}for(;w%10===0;)w/=10;return str+w}function checkInt32(i,min,max){if(i!==~~i||i<min||i>max){throw Error(invalidArgument+i)}}function checkRoundingDigits(d,i,rm,repeating){var di,k,r,rd;for(k=d[0];k>=10;k/=10)--i;if(--i<0){i+=LOG_BASE;di=0}else{di=Math.ceil((i+1)/LOG_BASE);i%=LOG_BASE}k=mathpow(10,LOG_BASE-i);rd=d[di]%k|0;if(repeating==null){if(i<3){if(i==0)rd=rd/100|0;else if(i==1)rd=rd/10|0;r=rm<4&&rd==99999||rm>3&&rd==49999||rd==5e4||rd==0}else{r=(rm<4&&rd+1==k||rm>3&&rd+1==k/2)&&(d[di+1]/k/100|0)==mathpow(10,i-2)-1||(rd==k/2||rd==0)&&(d[di+1]/k/100|0)==0}}else{if(i<4){if(i==0)rd=rd/1e3|0;else if(i==1)rd=rd/100|0;else if(i==2)rd=rd/10|0;r=(repeating||rm<4)&&rd==9999||!repeating&&rm>3&&rd==4999}else{r=((repeating||rm<4)&&rd+1==k||!repeating&&rm>3&&rd+1==k/2)&&(d[di+1]/k/1e3|0)==mathpow(10,i-3)-1}}return r}function convertBase(str,baseIn,baseOut){var j,arr=[0],arrL,i=0,strL=str.length;for(;i<strL;){for(arrL=arr.length;arrL--;)arr[arrL]*=baseIn;arr[0]+=NUMERALS.indexOf(str.charAt(i++));for(j=0;j<arr.length;j++){if(arr[j]>baseOut-1){if(arr[j+1]===void 0)arr[j+1]=0;arr[j+1]+=arr[j]/baseOut|0;arr[j]%=baseOut}}}return arr.reverse()}function cosine(Ctor,x){var k,y,len=x.d.length;if(len<32){k=Math.ceil(len/3);y=Math.pow(4,-k).toString()}else{k=16;y="2.3283064365386962890625e-10"}Ctor.precision+=k;x=taylorSeries(Ctor,1,x.times(y),new Ctor(1));for(var i=k;i--;){var cos2x=x.times(x);x=cos2x.times(cos2x).minus(cos2x).times(8).plus(1)}Ctor.precision-=k;return x}var divide=function(){function multiplyInteger(x,k,base){var temp,carry=0,i=x.length;for(x=x.slice();i--;){temp=x[i]*k+carry;x[i]=temp%base|0;carry=temp/base|0}if(carry)x.unshift(carry);return x}function compare(a,b,aL,bL){var i,r;if(aL!=bL){r=aL>bL?1:-1}else{for(i=r=0;i<aL;i++){if(a[i]!=b[i]){r=a[i]>b[i]?1:-1;break}}}return r}function subtract(a,b,aL,base){var i=0;for(;aL--;){a[aL]-=i;i=a[aL]<b[aL]?1:0;a[aL]=i*base+a[aL]-b[aL]}for(;!a[0]&&a.length>1;)a.shift()}return function(x,y,pr,rm,dp,base){var cmp,e,i,k,logBase,more,prod,prodL,q,qd,rem,remL,rem0,sd,t,xi,xL,yd0,yL,yz,Ctor=x.constructor,sign=x.s==y.s?1:-1,xd=x.d,yd=y.d;if(!xd||!xd[0]||!yd||!yd[0]){return new Ctor(!x.s||!y.s||(xd?yd&&xd[0]==yd[0]:!yd)?NaN:xd&&xd[0]==0||!yd?sign*0:sign/0)}if(base){logBase=1;e=x.e-y.e}else{base=BASE;logBase=LOG_BASE;e=mathfloor(x.e/logBase)-mathfloor(y.e/logBase)}yL=yd.length;xL=xd.length;q=new Ctor(sign);qd=q.d=[];for(i=0;yd[i]==(xd[i]||0);i++);if(yd[i]>(xd[i]||0))e--;if(pr==null){sd=pr=Ctor.precision;rm=Ctor.rounding}else if(dp){sd=pr+(x.e-y.e)+1}else{sd=pr}if(sd<0){qd.push(1);more=true}else{sd=sd/logBase+2|0;i=0;if(yL==1){k=0;yd=yd[0];sd++;for(;(i<xL||k)&&sd--;i++){t=k*base+(xd[i]||0);qd[i]=t/yd|0;k=t%yd|0}more=k||i<xL}else{k=base/(yd[0]+1)|0;if(k>1){yd=multiplyInteger(yd,k,base);xd=multiplyInteger(xd,k,base);yL=yd.length;xL=xd.length}xi=yL;rem=xd.slice(0,yL);remL=rem.length;for(;remL<yL;)rem[remL++]=0;yz=yd.slice();yz.unshift(0);yd0=yd[0];if(yd[1]>=base/2)++yd0;do{k=0;cmp=compare(yd,rem,yL,remL);if(cmp<0){rem0=rem[0];if(yL!=remL)rem0=rem0*base+(rem[1]||0);k=rem0/yd0|0;if(k>1){if(k>=base)k=base-1;prod=multiplyInteger(yd,k,base);prodL=prod.length;remL=rem.length;cmp=compare(prod,rem,prodL,remL);if(cmp==1){k--;subtract(prod,yL<prodL?yz:yd,prodL,base)}}else{if(k==0)cmp=k=1;prod=yd.slice()}prodL=prod.length;if(prodL<remL)prod.unshift(0);subtract(rem,prod,remL,base);if(cmp==-1){remL=rem.length;cmp=compare(yd,rem,yL,remL);if(cmp<1){k++;subtract(rem,yL<remL?yz:yd,remL,base)}}remL=rem.length}else if(cmp===0){k++;rem=[0]}qd[i++]=k;if(cmp&&rem[0]){rem[remL++]=xd[xi]||0}else{rem=[xd[xi]];remL=1}}while((xi++<xL||rem[0]!==void 0)&&sd--);more=rem[0]!==void 0}if(!qd[0])qd.shift()}if(logBase==1){q.e=e;inexact=more}else{for(i=1,k=qd[0];k>=10;k/=10)i++;q.e=i+e*logBase-1;finalise(q,dp?pr+q.e+1:pr,rm,more)}return q}}();function finalise(x,sd,rm,isTruncated){var digits,i,j,k,rd,roundUp,w,xd,xdi,Ctor=x.constructor;out:if(sd!=null){xd=x.d;if(!xd)return x;for(digits=1,k=xd[0];k>=10;k/=10)digits++;i=sd-digits;if(i<0){i+=LOG_BASE;j=sd;w=xd[xdi=0];rd=w/mathpow(10,digits-j-1)%10|0}else{xdi=Math.ceil((i+1)/LOG_BASE);k=xd.length;if(xdi>=k){if(isTruncated){for(;k++<=xdi;)xd.push(0);w=rd=0;digits=1;i%=LOG_BASE;j=i-LOG_BASE+1}else{break out}}else{w=k=xd[xdi];for(digits=1;k>=10;k/=10)digits++;i%=LOG_BASE;j=i-LOG_BASE+digits;rd=j<0?0:w/mathpow(10,digits-j-1)%10|0}}isTruncated=isTruncated||sd<0||xd[xdi+1]!==void 0||(j<0?w:w%mathpow(10,digits-j-1));roundUp=rm<4?(rd||isTruncated)&&(rm==0||rm==(x.s<0?3:2)):rd>5||rd==5&&(rm==4||isTruncated||rm==6&&(i>0?j>0?w/mathpow(10,digits-j):0:xd[xdi-1])%10&1||rm==(x.s<0?8:7));if(sd<1||!xd[0]){xd.length=0;if(roundUp){sd-=x.e+1;xd[0]=mathpow(10,(LOG_BASE-sd%LOG_BASE)%LOG_BASE);x.e=-sd||0}else{xd[0]=x.e=0}return x}if(i==0){xd.length=xdi;k=1;xdi--}else{xd.length=xdi+1;k=mathpow(10,LOG_BASE-i);xd[xdi]=j>0?(w/mathpow(10,digits-j)%mathpow(10,j)|0)*k:0}if(roundUp){for(;;){if(xdi==0){for(i=1,j=xd[0];j>=10;j/=10)i++;j=xd[0]+=k;for(k=1;j>=10;j/=10)k++;if(i!=k){x.e++;if(xd[0]==BASE)xd[0]=1}break}else{xd[xdi]+=k;if(xd[xdi]!=BASE)break;xd[xdi--]=0;k=1}}}for(i=xd.length;xd[--i]===0;)xd.pop()}if(external){if(x.e>Ctor.maxE){x.d=null;x.e=NaN}else if(x.e<Ctor.minE){x.e=0;x.d=[0]}}return x}function finiteToString(x,isExp,sd){if(!x.isFinite())return nonFiniteToString(x);var k,e=x.e,str=digitsToString(x.d),len=str.length;if(isExp){if(sd&&(k=sd-len)>0){str=str.charAt(0)+"."+str.slice(1)+getZeroString(k)}else if(len>1){str=str.charAt(0)+"."+str.slice(1)}str=str+(x.e<0?"e":"e+")+x.e}else if(e<0){str="0."+getZeroString(-e-1)+str;if(sd&&(k=sd-len)>0)str+=getZeroString(k)}else if(e>=len){str+=getZeroString(e+1-len);if(sd&&(k=sd-e-1)>0)str=str+"."+getZeroString(k)}else{if((k=e+1)<len)str=str.slice(0,k)+"."+str.slice(k);if(sd&&(k=sd-len)>0){if(e+1===len)str+=".";str+=getZeroString(k)}}return str}function getBase10Exponent(digits,e){for(var i=1,w=digits[0];w>=10;w/=10)i++;return i+e*LOG_BASE-1}function getLn10(Ctor,sd,pr){if(sd>LN10_PRECISION){external=true;if(pr)Ctor.precision=pr;throw Error(precisionLimitExceeded)}return finalise(new Ctor(LN10),sd,1,true)}function getPi(Ctor,sd,rm){if(sd>PI_PRECISION)throw Error(precisionLimitExceeded);return finalise(new Ctor(PI),sd,rm,true)}function getPrecision(digits){var w=digits.length-1,len=w*LOG_BASE+1;w=digits[w];if(w){for(;w%10==0;w/=10)len--;for(w=digits[0];w>=10;w/=10)len++}return len}function getZeroString(k){var zs="";for(;k--;)zs+="0";return zs}function intPow(Ctor,x,n,pr){var isTruncated,r=new Ctor(1),k=Math.ceil(pr/LOG_BASE+4);external=false;for(;;){if(n%2){r=r.times(x);if(truncate(r.d,k))isTruncated=true}n=mathfloor(n/2);if(n===0){n=r.d.length-1;if(isTruncated&&r.d[n]===0)++r.d[n];break}x=x.times(x);truncate(x.d,k)}external=true;return r}function isOdd(n){return n.d[n.d.length-1]&1}function maxOrMin(Ctor,args,ltgt){var y,x=new Ctor(args[0]),i=0;for(;++i<args.length;){y=new Ctor(args[i]);if(!y.s){x=y;break}else if(x[ltgt](y)){x=y}}return x}function naturalExponential(x,sd){var denominator,guard,j,pow,sum,t,wpr,rep=0,i=0,k=0,Ctor=x.constructor,rm=Ctor.rounding,pr=Ctor.precision;if(!x.d||!x.d[0]||x.e>17){return new Ctor(x.d?!x.d[0]?1:x.s<0?0:1/0:x.s?x.s<0?0:x:0/0)}if(sd==null){external=false;wpr=pr}else{wpr=sd}t=new Ctor(.03125);while(x.e>-2){x=x.times(t);k+=5}guard=Math.log(mathpow(2,k))/Math.LN10*2+5|0;wpr+=guard;denominator=pow=sum=new Ctor(1);Ctor.precision=wpr;for(;;){pow=finalise(pow.times(x),wpr,1);denominator=denominator.times(++i);t=sum.plus(divide(pow,denominator,wpr,1));if(digitsToString(t.d).slice(0,wpr)===digitsToString(sum.d).slice(0,wpr)){j=k;while(j--)sum=finalise(sum.times(sum),wpr,1);if(sd==null){if(rep<3&&checkRoundingDigits(sum.d,wpr-guard,rm,rep)){Ctor.precision=wpr+=10;denominator=pow=t=new Ctor(1);i=0;rep++}else{return finalise(sum,Ctor.precision=pr,rm,external=true)}}else{Ctor.precision=pr;return sum}}sum=t}}function naturalLogarithm(y,sd){var c,c0,denominator,e,numerator,rep,sum,t,wpr,x1,x2,n=1,guard=10,x=y,xd=x.d,Ctor=x.constructor,rm=Ctor.rounding,pr=Ctor.precision;if(x.s<0||!xd||!xd[0]||!x.e&&xd[0]==1&&xd.length==1){return new Ctor(xd&&!xd[0]?-1/0:x.s!=1?NaN:xd?0:x)}if(sd==null){external=false;wpr=pr}else{wpr=sd}Ctor.precision=wpr+=guard;c=digitsToString(xd);c0=c.charAt(0);if(Math.abs(e=x.e)<15e14){while(c0<7&&c0!=1||c0==1&&c.charAt(1)>3){x=x.times(y);c=digitsToString(x.d);c0=c.charAt(0);n++}e=x.e;if(c0>1){x=new Ctor("0."+c);e++}else{x=new Ctor(c0+"."+c.slice(1))}}else{t=getLn10(Ctor,wpr+2,pr).times(e+"");x=naturalLogarithm(new Ctor(c0+"."+c.slice(1)),wpr-guard).plus(t);Ctor.precision=pr;return sd==null?finalise(x,pr,rm,external=true):x}x1=x;sum=numerator=x=divide(x.minus(1),x.plus(1),wpr,1);x2=finalise(x.times(x),wpr,1);denominator=3;for(;;){numerator=finalise(numerator.times(x2),wpr,1);t=sum.plus(divide(numerator,new Ctor(denominator),wpr,1));if(digitsToString(t.d).slice(0,wpr)===digitsToString(sum.d).slice(0,wpr)){sum=sum.times(2);if(e!==0)sum=sum.plus(getLn10(Ctor,wpr+2,pr).times(e+""));sum=divide(sum,new Ctor(n),wpr,1);if(sd==null){if(checkRoundingDigits(sum.d,wpr-guard,rm,rep)){Ctor.precision=wpr+=guard;t=numerator=x=divide(x1.minus(1),x1.plus(1),wpr,1);x2=finalise(x.times(x),wpr,1);denominator=rep=1}else{return finalise(sum,Ctor.precision=pr,rm,external=true)}}else{Ctor.precision=pr;return sum}}sum=t;denominator+=2}}function nonFiniteToString(x){return String(x.s*x.s/0)}function parseDecimal(x,str){var e,i,len;if((e=str.indexOf("."))>-1)str=str.replace(".","");if((i=str.search(/e/i))>0){if(e<0)e=i;e+=+str.slice(i+1);str=str.substring(0,i)}else if(e<0){e=str.length}for(i=0;str.charCodeAt(i)===48;i++);for(len=str.length;str.charCodeAt(len-1)===48;--len);str=str.slice(i,len);if(str){len-=i;x.e=e=e-i-1;x.d=[];i=(e+1)%LOG_BASE;if(e<0)i+=LOG_BASE;if(i<len){if(i)x.d.push(+str.slice(0,i));for(len-=LOG_BASE;i<len;)x.d.push(+str.slice(i,i+=LOG_BASE));str=str.slice(i);i=LOG_BASE-str.length}else{i-=len}for(;i--;)str+="0";x.d.push(+str);if(external){if(x.e>x.constructor.maxE){x.d=null;x.e=NaN}else if(x.e<x.constructor.minE){x.e=0;x.d=[0]}}}else{x.e=0;x.d=[0]}return x}function parseOther(x,str){var base,Ctor,divisor,i,isFloat,len,p,xd,xe;if(str==="Infinity"||str==="NaN"){if(!+str)x.s=NaN;x.e=NaN;x.d=null;return x}if(isHex.test(str)){base=16;str=str.toLowerCase()}else if(isBinary.test(str)){base=2}else if(isOctal.test(str)){base=8}else{throw Error(invalidArgument+str)}i=str.search(/p/i);if(i>0){p=+str.slice(i+1);str=str.substring(2,i)}else{str=str.slice(2)}i=str.indexOf(".");isFloat=i>=0;Ctor=x.constructor;if(isFloat){str=str.replace(".","");len=str.length;i=len-i;divisor=intPow(Ctor,new Ctor(base),i,i*2)}xd=convertBase(str,base,BASE);xe=xd.length-1;for(i=xe;xd[i]===0;--i)xd.pop();if(i<0)return new Ctor(x.s*0);x.e=getBase10Exponent(xd,xe);x.d=xd;external=false;if(isFloat)x=divide(x,divisor,len*4);if(p)x=x.times(Math.abs(p)<54?Math.pow(2,p):Decimal.pow(2,p));external=true;return x}function sine(Ctor,x){var k,len=x.d.length;if(len<3)return taylorSeries(Ctor,2,x,x);k=1.4*Math.sqrt(len);k=k>16?16:k|0;x=x.times(Math.pow(5,-k));x=taylorSeries(Ctor,2,x,x);var sin2_x,d5=new Ctor(5),d16=new Ctor(16),d20=new Ctor(20);for(;k--;){sin2_x=x.times(x);x=x.times(d5.plus(sin2_x.times(d16.times(sin2_x).minus(d20))))}return x}function taylorSeries(Ctor,n,x,y,isHyperbolic){var j,t,u,x2,i=1,pr=Ctor.precision,k=Math.ceil(pr/LOG_BASE);external=false;x2=x.times(x);u=new Ctor(y);for(;;){t=divide(u.times(x2),new Ctor(n++*n++),pr,1);u=isHyperbolic?y.plus(t):y.minus(t);y=divide(t.times(x2),new Ctor(n++*n++),pr,1);t=u.plus(y);if(t.d[k]!==void 0){for(j=k;t.d[j]===u.d[j]&&j--;);if(j==-1)break}j=u;u=y;y=t;t=j;i++}external=true;t.d.length=k+1;return t}function toLessThanHalfPi(Ctor,x){var t,isNeg=x.s<0,pi=getPi(Ctor,Ctor.precision,1),halfPi=pi.times(.5);x=x.abs();if(x.lte(halfPi)){quadrant=isNeg?4:1;return x}t=x.divToInt(pi);if(t.isZero()){quadrant=isNeg?3:2}else{x=x.minus(t.times(pi));if(x.lte(halfPi)){quadrant=isOdd(t)?isNeg?2:3:isNeg?4:1;return x}quadrant=isOdd(t)?isNeg?1:4:isNeg?3:2}return x.minus(pi).abs()}function toStringBinary(x,baseOut,sd,rm){var base,e,i,k,len,roundUp,str,xd,y,Ctor=x.constructor,isExp=sd!==void 0;if(isExp){checkInt32(sd,1,MAX_DIGITS);if(rm===void 0)rm=Ctor.rounding;else checkInt32(rm,0,8)}else{sd=Ctor.precision;rm=Ctor.rounding}if(!x.isFinite()){str=nonFiniteToString(x)}else{str=finiteToString(x);i=str.indexOf(".");if(isExp){base=2;if(baseOut==16){sd=sd*4-3}else if(baseOut==8){sd=sd*3-2}}else{base=baseOut}if(i>=0){str=str.replace(".","");y=new Ctor(1);y.e=str.length-i;y.d=convertBase(finiteToString(y),10,base);y.e=y.d.length}xd=convertBase(str,10,base);e=len=xd.length;for(;xd[--len]==0;)xd.pop();if(!xd[0]){str=isExp?"0p+0":"0"}else{if(i<0){e--}else{x=new Ctor(x);x.d=xd;x.e=e;x=divide(x,y,sd,rm,0,base);xd=x.d;e=x.e;roundUp=inexact}i=xd[sd];k=base/2;roundUp=roundUp||xd[sd+1]!==void 0;roundUp=rm<4?(i!==void 0||roundUp)&&(rm===0||rm===(x.s<0?3:2)):i>k||i===k&&(rm===4||roundUp||rm===6&&xd[sd-1]&1||rm===(x.s<0?8:7));xd.length=sd;if(roundUp){for(;++xd[--sd]>base-1;){xd[sd]=0;if(!sd){++e;xd.unshift(1)}}}for(len=xd.length;!xd[len-1];--len);for(i=0,str="";i<len;i++)str+=NUMERALS.charAt(xd[i]);if(isExp){if(len>1){if(baseOut==16||baseOut==8){i=baseOut==16?4:3;for(--len;len%i;len++)str+="0";xd=convertBase(str,base,baseOut);for(len=xd.length;!xd[len-1];--len);for(i=1,str="1.";i<len;i++)str+=NUMERALS.charAt(xd[i])}else{str=str.charAt(0)+"."+str.slice(1)}}str=str+(e<0?"p":"p+")+e}else if(e<0){for(;++e;)str="0"+str;str="0."+str}else{if(++e>len)for(e-=len;e--;)str+="0";else if(e<len)str=str.slice(0,e)+"."+str.slice(e)}}str=(baseOut==16?"0x":baseOut==2?"0b":baseOut==8?"0o":"")+str}return x.s<0?"-"+str:str}function truncate(arr,len){if(arr.length>len){arr.length=len;return true}}function abs(x){return new this(x).abs()}function acos(x){return new this(x).acos()}function acosh(x){return new this(x).acosh()}function add(x,y){return new this(x).plus(y)}function asin(x){return new this(x).asin()}function asinh(x){return new this(x).asinh()}function atan(x){return new this(x).atan()}function atanh(x){return new this(x).atanh()}function atan2(y,x){y=new this(y);x=new this(x);var r,pr=this.precision,rm=this.rounding,wpr=pr+4;if(!y.s||!x.s){r=new this(NaN)}else if(!y.d&&!x.d){r=getPi(this,wpr,1).times(x.s>0?.25:.75);r.s=y.s}else if(!x.d||y.isZero()){r=x.s<0?getPi(this,pr,rm):new this(0);r.s=y.s}else if(!y.d||x.isZero()){r=getPi(this,wpr,1).times(.5);r.s=y.s}else if(x.s<0){this.precision=wpr;this.rounding=1;r=this.atan(divide(y,x,wpr,1));x=getPi(this,wpr,1);this.precision=pr;this.rounding=rm;r=y.s<0?r.minus(x):r.plus(x)}else{r=this.atan(divide(y,x,wpr,1))}return r}function cbrt(x){return new this(x).cbrt()}function ceil(x){return finalise(x=new this(x),x.e+1,2)}function config(obj){if(!obj||typeof obj!=="object")throw Error(decimalError+"Object expected");var i,p,v,ps=["precision",1,MAX_DIGITS,"rounding",0,8,"toExpNeg",-EXP_LIMIT,0,"toExpPos",0,EXP_LIMIT,"maxE",0,EXP_LIMIT,"minE",-EXP_LIMIT,0,"modulo",0,9];for(i=0;i<ps.length;i+=3){if((v=obj[p=ps[i]])!==void 0){if(mathfloor(v)===v&&v>=ps[i+1]&&v<=ps[i+2])this[p]=v;else throw Error(invalidArgument+p+": "+v)}}if(obj.hasOwnProperty(p="crypto")){if((v=obj[p])===void 0){this[p]=v}else if(v===true||v===false||v===0||v===1){this[p]=!!(v&&cryptoObject&&(cryptoObject.getRandomValues||cryptoObject.randomBytes))}else{throw Error(invalidArgument+p+": "+v)}}return this}function cos(x){return new this(x).cos()}function cosh(x){return new this(x).cosh()}function clone(obj){var i,p,ps;function Decimal(v){var e,i,t,x=this;if(!(x instanceof Decimal))return new Decimal(v);x.constructor=Decimal;if(v instanceof Decimal){x.s=v.s;x.e=v.e;x.d=(v=v.d)?v.slice():v;return}t=typeof v;if(t==="number"){if(v===0){x.s=1/v<0?-1:1;x.e=0;x.d=[0];return}if(v<0){v=-v;x.s=-1}else{x.s=1}if(v===~~v&&v<1e7){for(e=0,i=v;i>=10;i/=10)e++;x.e=e;x.d=[v];return}else if(v*0!==0){if(!v)x.s=NaN;x.e=NaN;x.d=null;return}return parseDecimal(x,v.toString())}else if(t!=="string"){throw Error(invalidArgument+v)}if(v.charCodeAt(0)===45){v=v.slice(1);x.s=-1}else{x.s=1}return isDecimal.test(v)?parseDecimal(x,v):parseOther(x,v)}Decimal.prototype=P;Decimal.ROUND_UP=0;Decimal.ROUND_DOWN=1;Decimal.ROUND_CEIL=2;Decimal.ROUND_FLOOR=3;Decimal.ROUND_HALF_UP=4;Decimal.ROUND_HALF_DOWN=5;Decimal.ROUND_HALF_EVEN=6;Decimal.ROUND_HALF_CEIL=7;Decimal.ROUND_HALF_FLOOR=8;Decimal.EUCLID=9;Decimal.config=config;Decimal.clone=clone;Decimal.abs=abs;Decimal.acos=acos;Decimal.acosh=acosh;Decimal.add=add;Decimal.asin=asin;Decimal.asinh=asinh;Decimal.atan=atan;Decimal.atanh=atanh;Decimal.atan2=atan2;Decimal.cbrt=cbrt;Decimal.ceil=ceil;Decimal.cos=cos;Decimal.cosh=cosh;Decimal.div=div;Decimal.exp=exp;Decimal.floor=floor;Decimal.hypot=hypot;Decimal.ln=ln;Decimal.log=log;Decimal.log10=log10;Decimal.log2=log2;Decimal.max=max;Decimal.min=min;Decimal.mod=mod;Decimal.mul=mul;Decimal.pow=pow;Decimal.random=random;Decimal.round=round;Decimal.sign=sign;Decimal.sin=sin;Decimal.sinh=sinh;Decimal.sqrt=sqrt;Decimal.sub=sub;Decimal.tan=tan;Decimal.tanh=tanh;Decimal.trunc=trunc;if(obj===void 0)obj={};if(obj){ps=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"];for(i=0;i<ps.length;)if(!obj.hasOwnProperty(p=ps[i++]))obj[p]=this[p]}Decimal.config(obj);return Decimal}function div(x,y){return new this(x).div(y)}function exp(x){return new this(x).exp()}function floor(x){return finalise(x=new this(x),x.e+1,3)}function hypot(){var i,n,t=new this(0);external=false;for(i=0;i<arguments.length;){n=new this(arguments[i++]);if(!n.d){if(n.s){external=true;return new this(1/0)}t=n}else if(t.d){t=t.plus(n.times(n))}}external=true;return t.sqrt()}function ln(x){return new this(x).ln()}function log(x,y){return new this(x).log(y)}function log2(x){return new this(x).log(2)}function log10(x){return new this(x).log(10)}function max(){return maxOrMin(this,arguments,"lt")}function min(){return maxOrMin(this,arguments,"gt")}function mod(x,y){return new this(x).mod(y)}function mul(x,y){return new this(x).mul(y)}function pow(x,y){return new this(x).pow(y)}function random(sd){var d,e,k,n,i=0,r=new this(1),rd=[];if(sd===void 0)sd=this.precision;else checkInt32(sd,1,MAX_DIGITS);k=Math.ceil(sd/LOG_BASE);if(this.crypto===false){for(;i<k;)rd[i++]=Math.random()*1e7|0}else if(cryptoObject&&cryptoObject.getRandomValues){d=cryptoObject.getRandomValues(new Uint32Array(k));for(;i<k;){n=d[i];if(n>=429e7){d[i]=cryptoObject.getRandomValues(new Uint32Array(1))[0]}else{rd[i++]=n%1e7}}}else if(cryptoObject&&cryptoObject.randomBytes){d=cryptoObject.randomBytes(k*=4);for(;i<k;){n=d[i]+(d[i+1]<<8)+(d[i+2]<<16)+((d[i+3]&127)<<24);if(n>=214e7){cryptoObject.randomBytes(4).copy(d,i)}else{rd.push(n%1e7);i+=4}}i=k/4}else if(this.crypto){throw Error(decimalError+"crypto unavailable")}else{for(;i<k;)rd[i++]=Math.random()*1e7|0}k=rd[--i];sd%=LOG_BASE;if(k&&sd){n=mathpow(10,LOG_BASE-sd);rd[i]=(k/n|0)*n}for(;rd[i]===0;i--)rd.pop();if(i<0){e=0;rd=[0]}else{e=-1;for(;rd[0]===0;e-=LOG_BASE)rd.shift();for(k=1,n=rd[0];n>=10;n/=10)k++;if(k<LOG_BASE)e-=LOG_BASE-k}r.e=e;r.d=rd;return r}function round(x){return finalise(x=new this(x),x.e+1,this.rounding)}function sign(x){x=new this(x);return x.d?x.d[0]?x.s:0*x.s:x.s||NaN}function sin(x){return new this(x).sin()}function sinh(x){return new this(x).sinh()}function sqrt(x){return new this(x).sqrt()}function sub(x,y){return new this(x).sub(y)}function tan(x){return new this(x).tan()}function tanh(x){return new this(x).tanh()}function trunc(x){return finalise(x=new this(x),x.e+1,1)}Decimal=clone(Decimal);LN10=new Decimal(LN10);PI=new Decimal(PI);if(typeof define=="function"&&define.amd){define(function(){return Decimal})}else if(typeof module!="undefined"&&module.exports){module.exports=Decimal;if(!cryptoObject){try{cryptoObject=require("cry"+"pto")}catch(e){}}}else{if(!globalScope){globalScope=typeof self!="undefined"&&self&&self.self==self?self:Function("return this")()}noConflict=globalScope.Decimal;Decimal.noConflict=function(){globalScope.Decimal=noConflict;return Decimal};globalScope.Decimal=Decimal}})(this)},{}],2:[function(require,module,exports){(function(global,factory){if(typeof define==="function"&&define["amd"])define([],factory);else if(typeof require==="function"&&typeof module==="object"&&module&&module["exports"])module["exports"]=factory();else(global["dcodeIO"]=global["dcodeIO"]||{})["Long"]=factory()})(this,function(){"use strict";function Long(low,high,unsigned){this.low=low|0;this.high=high|0;this.unsigned=!!unsigned}Long.prototype.__isLong__;Object.defineProperty(Long.prototype,"__isLong__",{value:true,enumerable:false,configurable:false});function isLong(obj){return(obj&&obj["__isLong__"])===true}Long.isLong=isLong;var INT_CACHE={};var UINT_CACHE={};function fromInt(value,unsigned){var obj,cachedObj,cache;if(unsigned){value>>>=0;if(cache=0<=value&&value<256){cachedObj=UINT_CACHE[value];if(cachedObj)return cachedObj}obj=fromBits(value,(value|0)<0?-1:0,true);if(cache)UINT_CACHE[value]=obj;return obj}else{value|=0;if(cache=-128<=value&&value<128){cachedObj=INT_CACHE[value];if(cachedObj)return cachedObj}obj=fromBits(value,value<0?-1:0,false);if(cache)INT_CACHE[value]=obj;return obj}}Long.fromInt=fromInt;function fromNumber(value,unsigned){if(isNaN(value)||!isFinite(value))return unsigned?UZERO:ZERO;if(unsigned){if(value<0)return UZERO;if(value>=TWO_PWR_64_DBL)return MAX_UNSIGNED_VALUE}else{if(value<=-TWO_PWR_63_DBL)return MIN_VALUE;if(value+1>=TWO_PWR_63_DBL)return MAX_VALUE}if(value<0)return fromNumber(-value,unsigned).neg();return fromBits(value%TWO_PWR_32_DBL|0,value/TWO_PWR_32_DBL|0,unsigned)}Long.fromNumber=fromNumber;function fromBits(lowBits,highBits,unsigned){return new Long(lowBits,highBits,unsigned)}Long.fromBits=fromBits;var pow_dbl=Math.pow;function fromString(str,unsigned,radix){if(str.length===0)throw Error("empty string");if(str==="NaN"||str==="Infinity"||str==="+Infinity"||str==="-Infinity")return ZERO;if(typeof unsigned==="number"){radix=unsigned,unsigned=false}else{unsigned=!!unsigned}radix=radix||10;if(radix<2||36<radix)throw RangeError("radix");var p;if((p=str.indexOf("-"))>0)throw Error("interior hyphen");else if(p===0){return fromString(str.substring(1),unsigned,radix).neg()}var radixToPower=fromNumber(pow_dbl(radix,8));var result=ZERO;for(var i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i),value=parseInt(str.substring(i,i+size),radix);if(size<8){var power=fromNumber(pow_dbl(radix,size));result=result.mul(power).add(fromNumber(value))}else{result=result.mul(radixToPower);result=result.add(fromNumber(value))}}result.unsigned=unsigned;return result}Long.fromString=fromString;function fromValue(val){if(val instanceof Long)return val;if(typeof val==="number")return fromNumber(val);if(typeof val==="string")return fromString(val);return fromBits(val.low,val.high,val.unsigned)}Long.fromValue=fromValue;var TWO_PWR_16_DBL=1<<16;var TWO_PWR_24_DBL=1<<24;var TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL;var TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL;var TWO_PWR_63_DBL=TWO_PWR_64_DBL/2;var TWO_PWR_24=fromInt(TWO_PWR_24_DBL);var ZERO=fromInt(0);Long.ZERO=ZERO;var UZERO=fromInt(0,true);Long.UZERO=UZERO;var ONE=fromInt(1);Long.ONE=ONE;var UONE=fromInt(1,true);Long.UONE=UONE;var NEG_ONE=fromInt(-1);Long.NEG_ONE=NEG_ONE;var MAX_VALUE=fromBits(4294967295|0,2147483647|0,false);Long.MAX_VALUE=MAX_VALUE;var MAX_UNSIGNED_VALUE=fromBits(4294967295|0,4294967295|0,true);Long.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,2147483648|0,false);Long.MIN_VALUE=MIN_VALUE;var LongPrototype=Long.prototype;LongPrototype.toInt=function toInt(){return this.unsigned?this.low>>>0:this.low};LongPrototype.toNumber=function toNumber(){if(this.unsigned)return(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0);return this.high*TWO_PWR_32_DBL+(this.low>>>0)};LongPrototype.toString=function toString(radix){radix=radix||10;if(radix<2||36<radix)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(MIN_VALUE)){var radixLong=fromNumber(radix),div=this.div(radixLong),rem1=div.mul(radixLong).sub(this);return div.toString(radix)+rem1.toInt().toString(radix)}else return"-"+this.neg().toString(radix)}var radixToPower=fromNumber(pow_dbl(radix,6),this.unsigned),rem=this;var result="";while(true){var remDiv=rem.div(radixToPower),intval=rem.sub(remDiv.mul(radixToPower)).toInt()>>>0,digits=intval.toString(radix);rem=remDiv;if(rem.isZero())return digits+result;else{while(digits.length<6)digits="0"+digits;result=""+digits+result}}};LongPrototype.getHighBits=function getHighBits(){return this.high};LongPrototype.getHighBitsUnsigned=function getHighBitsUnsigned(){return this.high>>>0};LongPrototype.getLowBits=function getLowBits(){return this.low};LongPrototype.getLowBitsUnsigned=function getLowBitsUnsigned(){return this.low>>>0};LongPrototype.getNumBitsAbs=function getNumBitsAbs(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();var val=this.high!=0?this.high:this.low;for(var bit=31;bit>0;bit--)if((val&1<<bit)!=0)break;return this.high!=0?bit+33:bit+1};LongPrototype.isZero=function isZero(){return this.high===0&&this.low===0};LongPrototype.isNegative=function isNegative(){return!this.unsigned&&this.high<0};LongPrototype.isPositive=function isPositive(){return this.unsigned||this.high>=0};LongPrototype.isOdd=function isOdd(){return(this.low&1)===1};LongPrototype.isEven=function isEven(){return(this.low&1)===0};LongPrototype.equals=function equals(other){if(!isLong(other))other=fromValue(other);if(this.unsigned!==other.unsigned&&this.high>>>31===1&&other.high>>>31===1)return false;return this.high===other.high&&this.low===other.low};LongPrototype.eq=LongPrototype.equals;LongPrototype.notEquals=function notEquals(other){return!this.eq(other)};LongPrototype.neq=LongPrototype.notEquals;LongPrototype.lessThan=function lessThan(other){return this.comp(other)<0};LongPrototype.lt=LongPrototype.lessThan;LongPrototype.lessThanOrEqual=function lessThanOrEqual(other){return this.comp(other)<=0};LongPrototype.lte=LongPrototype.lessThanOrEqual;LongPrototype.greaterThan=function greaterThan(other){return this.comp(other)>0};LongPrototype.gt=LongPrototype.greaterThan;LongPrototype.greaterThanOrEqual=function greaterThanOrEqual(other){return this.comp(other)>=0};LongPrototype.gte=LongPrototype.greaterThanOrEqual;LongPrototype.compare=function compare(other){if(!isLong(other))other=fromValue(other);if(this.eq(other))return 0;var thisNeg=this.isNegative(),otherNeg=other.isNegative();if(thisNeg&&!otherNeg)return-1;if(!thisNeg&&otherNeg)return 1;if(!this.unsigned)return this.sub(other).isNegative()?-1:1;return other.high>>>0>this.high>>>0||other.high===this.high&&other.low>>>0>this.low>>>0?-1:1};LongPrototype.comp=LongPrototype.compare;LongPrototype.negate=function negate(){if(!this.unsigned&&this.eq(MIN_VALUE))return MIN_VALUE;return this.not().add(ONE)};LongPrototype.neg=LongPrototype.negate;LongPrototype.add=function add(addend){if(!isLong(addend))addend=fromValue(addend);var a48=this.high>>>16;var a32=this.high&65535;var a16=this.low>>>16;var a00=this.low&65535;var b48=addend.high>>>16;var b32=addend.high&65535;var b16=addend.low>>>16;var b00=addend.low&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00+b00;c16+=c00>>>16;c00&=65535;c16+=a16+b16;c32+=c16>>>16;c16&=65535;c32+=a32+b32;c48+=c32>>>16;c32&=65535;c48+=a48+b48;c48&=65535;return fromBits(c16<<16|c00,c48<<16|c32,this.unsigned)};LongPrototype.subtract=function subtract(subtrahend){if(!isLong(subtrahend))subtrahend=fromValue(subtrahend);return this.add(subtrahend.neg())};LongPrototype.sub=LongPrototype.subtract;LongPrototype.multiply=function multiply(multiplier){if(this.isZero())return ZERO;if(!isLong(multiplier))multiplier=fromValue(multiplier);if(multiplier.isZero())return ZERO;if(this.eq(MIN_VALUE))return multiplier.isOdd()?MIN_VALUE:ZERO;if(multiplier.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative()){if(multiplier.isNegative())return this.neg().mul(multiplier.neg());else return this.neg().mul(multiplier).neg()}else if(multiplier.isNegative())return this.mul(multiplier.neg()).neg();if(this.lt(TWO_PWR_24)&&multiplier.lt(TWO_PWR_24))return fromNumber(this.toNumber()*multiplier.toNumber(),this.unsigned);var a48=this.high>>>16;var a32=this.high&65535;var a16=this.low>>>16;var a00=this.low&65535;var b48=multiplier.high>>>16;var b32=multiplier.high&65535;var b16=multiplier.low>>>16;var b00=multiplier.low&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00*b00;c16+=c00>>>16;c00&=65535;c16+=a16*b00;c32+=c16>>>16;c16&=65535;c16+=a00*b16;c32+=c16>>>16;c16&=65535;c32+=a32*b00;c48+=c32>>>16;c32&=65535;c32+=a16*b16;c48+=c32>>>16;c32&=65535;c32+=a00*b32;c48+=c32>>>16;c32&=65535;c48+=a48*b00+a32*b16+a16*b32+a00*b48;c48&=65535;return fromBits(c16<<16|c00,c48<<16|c32,this.unsigned)};LongPrototype.mul=LongPrototype.multiply;LongPrototype.divide=function divide(divisor){if(!isLong(divisor))divisor=fromValue(divisor);if(divisor.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?UZERO:ZERO;var approx,rem,res;if(!this.unsigned){if(this.eq(MIN_VALUE)){if(divisor.eq(ONE)||divisor.eq(NEG_ONE))return MIN_VALUE;else if(divisor.eq(MIN_VALUE))return ONE;else{var halfThis=this.shr(1);approx=halfThis.div(divisor).shl(1);if(approx.eq(ZERO)){return divisor.isNegative()?ONE:NEG_ONE}else{rem=this.sub(divisor.mul(approx));res=approx.add(rem.div(divisor));return res}}}else if(divisor.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative()){if(divisor.isNegative())return this.neg().div(divisor.neg());return this.neg().div(divisor).neg()}else if(divisor.isNegative())return this.div(divisor.neg()).neg();res=ZERO}else{if(!divisor.unsigned)divisor=divisor.toUnsigned();if(divisor.gt(this))return UZERO;if(divisor.gt(this.shru(1)))return UONE;res=UZERO}rem=this;while(rem.gte(divisor)){approx=Math.max(1,Math.floor(rem.toNumber()/divisor.toNumber()));var log2=Math.ceil(Math.log(approx)/Math.LN2),delta=log2<=48?1:pow_dbl(2,log2-48),approxRes=fromNumber(approx),approxRem=approxRes.mul(divisor);while(approxRem.isNegative()||approxRem.gt(rem)){approx-=delta;approxRes=fromNumber(approx,this.unsigned);approxRem=approxRes.mul(divisor)}if(approxRes.isZero())approxRes=ONE;res=res.add(approxRes);rem=rem.sub(approxRem)}return res};LongPrototype.div=LongPrototype.divide;LongPrototype.modulo=function modulo(divisor){if(!isLong(divisor))divisor=fromValue(divisor);return this.sub(this.div(divisor).mul(divisor))};LongPrototype.mod=LongPrototype.modulo;LongPrototype.not=function not(){return fromBits(~this.low,~this.high,this.unsigned)};LongPrototype.and=function and(other){if(!isLong(other))other=fromValue(other);return fromBits(this.low&other.low,this.high&other.high,this.unsigned)};LongPrototype.or=function or(other){if(!isLong(other))other=fromValue(other);return fromBits(this.low|other.low,this.high|other.high,this.unsigned)};LongPrototype.xor=function xor(other){if(!isLong(other))other=fromValue(other);return fromBits(this.low^other.low,this.high^other.high,this.unsigned)};LongPrototype.shiftLeft=function shiftLeft(numBits){if(isLong(numBits))numBits=numBits.toInt();if((numBits&=63)===0)return this;else if(numBits<32)return fromBits(this.low<<numBits,this.high<<numBits|this.low>>>32-numBits,this.unsigned);else return fromBits(0,this.low<<numBits-32,this.unsigned)};LongPrototype.shl=LongPrototype.shiftLeft;LongPrototype.shiftRight=function shiftRight(numBits){if(isLong(numBits))numBits=numBits.toInt();if((numBits&=63)===0)return this;else if(numBits<32)return fromBits(this.low>>>numBits|this.high<<32-numBits,this.high>>numBits,this.unsigned);else return fromBits(this.high>>numBits-32,this.high>=0?0:-1,this.unsigned)};LongPrototype.shr=LongPrototype.shiftRight;LongPrototype.shiftRightUnsigned=function shiftRightUnsigned(numBits){if(isLong(numBits))numBits=numBits.toInt();numBits&=63;if(numBits===0)return this;else{var high=this.high;if(numBits<32){var low=this.low;return fromBits(low>>>numBits|high<<32-numBits,high>>>numBits,this.unsigned)}else if(numBits===32)return fromBits(high,0,this.unsigned);else return fromBits(high>>>numBits-32,0,this.unsigned)}};LongPrototype.shru=LongPrototype.shiftRightUnsigned;LongPrototype.toSigned=function toSigned(){if(!this.unsigned)return this;return fromBits(this.low,this.high,false)};LongPrototype.toUnsigned=function toUnsigned(){if(this.unsigned)return this;return fromBits(this.low,this.high,true)};LongPrototype.toBytes=function(le){return le?this.toBytesLE():this.toBytesBE()};LongPrototype.toBytesLE=function(){var hi=this.high,lo=this.low;return[lo&255,lo>>>8&255,lo>>>16&255,lo>>>24&255,hi&255,hi>>>8&255,hi>>>16&255,hi>>>24&255]};LongPrototype.toBytesBE=function(){var hi=this.high,lo=this.low;return[hi>>>24&255,hi>>>16&255,hi>>>8&255,hi&255,lo>>>24&255,lo>>>16&255,lo>>>8&255,lo&255]};return Long})},{}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var S2_1=require("./S2");var Interval=function(){function Interval(lo,hi){this.lo=S2_1.S2.toDecimal(lo);this.hi=S2_1.S2.toDecimal(hi)}Interval.prototype.toString=function(){return"["+this.lo.toString()+", "+this.hi.toString()+"]"};Interval.prototype.equals=function(that){if(typeof that===typeof this){return this.lo.eq(that.lo)&&this.hi.eq(that.hi)}return false};return Interval}();exports.Interval=Interval},{"./S2":9}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var MutableInteger=function(){function MutableInteger(val){this.val=val}return MutableInteger}();exports.MutableInteger=MutableInteger},{}],5:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var Interval_1=require("./Interval");var S2_1=require("./S2");var decimal_1=require("./decimal");var R1Interval=function(_super){__extends(R1Interval,_super);function R1Interval(){return _super!==null&&_super.apply(this,arguments)||this}R1Interval.prototype.isEmpty=function(){return this.lo.gt(this.hi)};R1Interval.prototype.getCenter=function(){return this.lo.plus(this.hi).dividedBy(2)};R1Interval.prototype.getLength=function(){return this.hi.minus(this.lo)};R1Interval.prototype.contains=function(_p){var p=S2_1.S2.toDecimal(_p);return p.gte(this.lo)&&p.lte(this.hi)};R1Interval.prototype.interiorContains=function(_p){var p=S2_1.S2.toDecimal(_p);return p.gt(this.lo)&&p.lt(this.hi)};R1Interval.prototype.containsI=function(y){if(y.isEmpty()){return true}return y.lo.gte(this.lo)&&y.hi.lte(this.hi)};R1Interval.prototype.interiorContainsI=function(y){if(y.isEmpty()){return true}return y.lo.gt(this.lo)&&y.hi.lt(this.hi)};R1Interval.prototype.intersects=function(y){if(this.lo.lte(y.lo)){return y.lo.lte(this.hi)&&y.lo.lte(y.hi)}else{return this.lo.lte(y.hi)&&this.lo.lte(this.hi)}};R1Interval.prototype.interiorIntersects=function(y){return y.lo.lt(this.hi)&&this.lo.lt(y.hi)&&this.lo.lt(this.hi)&&y.lo.lte(y.hi)};R1Interval.prototype.addPoint=function(_p){var p=S2_1.S2.toDecimal(_p);if(this.isEmpty()){return R1Interval.fromPoint(p)}else if(p.lt(this.lo)){return new R1Interval(p,this.hi)}else if(p.gt(this.hi)){return new R1Interval(this.lo,p)}else{return new R1Interval(this.lo,this.hi)}};R1Interval.prototype.expanded=function(_radius){var radius=S2_1.S2.toDecimal(_radius);if(this.isEmpty()){return this}return new R1Interval(this.lo.minus(radius),this.hi.plus(radius))};R1Interval.prototype.union=function(y){if(this.isEmpty()){return y}if(y.isEmpty()){return this}return new R1Interval(decimal_1.Decimal.min(this.lo,y.lo),decimal_1.Decimal.max(this.hi,y.hi))};R1Interval.prototype.intersection=function(y){return new R1Interval(decimal_1.Decimal.max(this.lo,y.lo),decimal_1.Decimal.min(this.hi,y.hi))};R1Interval.prototype.approxEquals=function(y,maxError){if(maxError===void 0){maxError=1e-15}if(this.isEmpty()){return y.getLength().lte(maxError)}if(y.isEmpty()){return this.getLength().lte(maxError)}return y.lo.minus(this.lo).abs().plus(y.hi.minus(this.hi).abs()).lte(maxError)};R1Interval.empty=function(){return new R1Interval(1,0)};R1Interval.fromPoint=function(p){return new R1Interval(p,p)};R1Interval.fromPointPair=function(_p1,_p2){var p1=S2_1.S2.toDecimal(_p1);var p2=S2_1.S2.toDecimal(_p2);if(p1.lte(p2)){return new R1Interval(p1,p2)}else{return new R1Interval(p2,p1)}};return R1Interval}(Interval_1.Interval);exports.R1Interval=R1Interval},{"./Interval":3,"./S2":9,"./decimal":21}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var S2Point_1=require("./S2Point");var decimal_1=require("./decimal");var S2_1=require("./S2");var R2Vector=function(){function R2Vector(_x,_y){this._x=new decimal_1.Decimal(_x);this._y=new decimal_1.Decimal(_y)}Object.defineProperty(R2Vector.prototype,"x",{get:function(){return this._x},enumerable:true,configurable:true});Object.defineProperty(R2Vector.prototype,"y",{get:function(){return this._y},enumerable:true,configurable:true});R2Vector.prototype.get=function(index){if(index>1){throw new Error("Index out fo bounds error "+index)}return index==0?this._x:this._y};R2Vector.fromPointFace=function(p,face){return p.toR2Vector(face)};R2Vector.add=function(p1,p2){return new R2Vector(p1._x.plus(p2._x),p1._y.plus(p2._y))};R2Vector.mul=function(p,_m){var m=new decimal_1.Decimal(_m);return new R2Vector(m.times(p._x),m.times(p._y))};R2Vector.prototype.norm2=function(){return this.x.pow(2).plus(this.y.pow(2))};R2Vector.dotProd=function(p1,p2){return p1.x.times(p2.x).plus(p1.y.times(p2.y))};R2Vector.prototype.dotProd=function(that){return R2Vector.dotProd(this,that)};R2Vector.prototype.crossProd=function(that){return this.x.times(that.y).minus(this.y.times(that.x))};R2Vector.prototype.lessThan=function(vb){if(this.x.lt(vb.x)){return true}if(vb.x.lt(this.x)){return false}if(this.y.lt(vb.y)){return true}return false};R2Vector.fromSTVector=function(stVector){return new R2Vector(R2Vector.singleStTOUV(stVector.x),R2Vector.singleStTOUV(stVector.y))};R2Vector.singleStTOUV=function(_s){var s=S2_1.S2.toDecimal(_s);if(s.gte(0)){return S2_1.S2.toDecimal(1).dividedBy(3).times(s.plus(1).pow(2).minus(1))}else{return S2_1.S2.toDecimal(1).dividedBy(3).times(S2_1.S2.toDecimal(1).minus(S2_1.S2.toDecimal(1).minus(s).pow(2)))}};R2Vector.singleUVToST=function(_x){var x=S2_1.S2.toDecimal(_x);if(x.gte(0)){return decimal_1.Decimal.sqrt(x.times(3).plus(1)).minus(1)}else{return S2_1.S2.toDecimal(1).minus(decimal_1.Decimal.sqrt(S2_1.S2.toDecimal(1).minus(x.times(3))))}};R2Vector.prototype.toPoint=function(face){switch(face){case 0:return new S2Point_1.S2Point(1,this.x,this.y);case 1:return new S2Point_1.S2Point(this.x.neg(),1,this.y);case 2:return new S2Point_1.S2Point(this.x.neg(),this.y.neg(),1);case 3:return new S2Point_1.S2Point(-1,this.y.neg(),this.x.neg());case 4:return new S2Point_1.S2Point(this.y,-1,this.x.neg());default:return new S2Point_1.S2Point(this.y,this.x,-1)}};R2Vector.prototype.toSt=function(which){return which==0?R2Vector.singleUVToST(this.x):R2Vector.singleUVToST(this.y)};R2Vector.prototype.toString=function(){return"("+this.x.toString()+", "+this.y.toString()+")"};return R2Vector}();exports.R2Vector=R2Vector},{"./S2":9,"./S2Point":18,"./decimal":21}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var decimal_1=require("./decimal");var S2_1=require("./S2");var S1Angle=function(){function S1Angle(radians){this.radians=new decimal_1.Decimal(radians)}S1Angle.prototype.degrees=function(){return S2_1.S2.toDecimal(this.radians).times(180/Math.PI)};S1Angle.fromPoints=function(x,y){return new S1Angle(x.angle(y))};S1Angle.prototype.lessThan=function(that){return this.radians.lt(that.radians)};S1Angle.prototype.greaterThan=function(that){return this.radians.gt(that.radians)};S1Angle.prototype.lessOrEquals=function(that){return this.radians.lte(that.radians)};S1Angle.prototype.greaterOrEquals=function(that){return this.radians.gte(that.radians)};S1Angle.max=function(left,right){return right.greaterThan(left)?right:left};S1Angle.min=function(left,right){return right.greaterThan(left)?left:right};S1Angle.degrees=function(degrees){var d=new decimal_1.Decimal(degrees);return new S1Angle(d.times(Math.PI/180))};S1Angle.prototype.toString=function(){return this.degrees()+"d"};S1Angle.prototype.compareTo=function(that){return this.radians<that.radians?-1:this.radians>that.radians?1:0};return S1Angle}();exports.S1Angle=S1Angle},{"./S2":9,"./decimal":21}],8:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var Interval_1=require("./Interval");var S2_1=require("./S2");var S1Interval=function(_super){__extends(S1Interval,_super);function S1Interval(lo,hi,checked){if(checked===void 0){checked=false}var _this=_super.call(this,lo,hi)||this;if(!checked){if(_this.lo.eq(-S2_1.S2.M_PI)&&!_this.hi.eq(S2_1.S2.M_PI)){_this.lo=S2_1.S2.toDecimal(S2_1.S2.M_PI)}if(_this.hi.eq(-S2_1.S2.M_PI)&&!_this.lo.eq(S2_1.S2.M_PI)){_this.hi=S2_1.S2.toDecimal(S2_1.S2.M_PI)}}return _this}S1Interval.prototype.isValid=function(){return this.lo.abs().lte(S2_1.S2.M_PI)&&this.hi.abs().lte(S2_1.S2.M_PI)&&!(this.lo.eq(-S2_1.S2.M_PI)&&!this.hi.eq(S2_1.S2.M_PI))&&!(this.hi.eq(-S2_1.S2.M_PI)&&!this.lo.eq(S2_1.S2.M_PI))};S1Interval.prototype.isFull=function(){return this.hi.minus(this.lo).eq(2*S2_1.S2.M_PI)};S1Interval.prototype.isEmpty=function(){return this.lo.minus(this.hi).eq(2*S2_1.S2.M_PI)};S1Interval.prototype.isInverted=function(){return this.lo.gt(this.hi)};S1Interval.prototype.getCenter=function(){var center=this.lo.plus(this.hi).dividedBy(2);if(!this.isInverted()){return center}return center.lte(0)?center.plus(S2_1.S2.M_PI):center.minus(S2_1.S2.M_PI)};S1Interval.prototype.getLength=function(){var length=this.hi.minus(this.lo);if(length.gte(0)){return length}length=length.plus(2*S2_1.S2.M_PI);return length.gt(0)?length:S2_1.S2.toDecimal(-1)};S1Interval.prototype.complement=function(){if(this.lo.eq(this.hi)){return S1Interval.full()}return new S1Interval(this.hi,this.lo,true)};S1Interval.prototype.contains=function(_p){var p=S2_1.S2.toDecimal(_p);if(p.eq(-S2_1.S2.M_PI)){p=S2_1.S2.toDecimal(S2_1.S2.M_PI)}return this.fastContains(p)};S1Interval.prototype.fastContains=function(_p){var p=S2_1.S2.toDecimal(_p);if(this.isInverted()){return(p.gte(this.lo)||p.lte(this.hi))&&!this.isEmpty()}else{return p.gte(this.lo)&&p.lte(this.hi)}};S1Interval.prototype.interiorContains=function(_p){var p=S2_1.S2.toDecimal(_p);if(p.eq(-S2_1.S2.M_PI)){p=S2_1.S2.toDecimal(S2_1.S2.M_PI)}if(this.isInverted()){return p.gt(this.lo)||p.lt(this.hi)}else{return p.gt(this.lo)&&p.lt(this.hi)||this.isFull()}};S1Interval.prototype.containsI=function(y){if(this.isInverted()){if(y.isInverted()){return y.lo.gte(this.lo)&&y.hi.lte(this.hi)}return(y.lo.gte(this.lo)||y.hi.lte(this.hi))&&!this.isEmpty()}else{if(y.isInverted()){return this.isFull()||y.isEmpty()}return y.lo.gte(this.lo)&&y.hi.lte(this.hi)}};S1Interval.prototype.interiorContainsI=function(y){if(this.isInverted()){if(!y.isInverted()){return this.lo.gt(this.lo)||y.hi.lt(this.hi)}return y.lo.gt(this.lo)&&y.hi.lt(this.hi)||y.isEmpty()}else{if(y.isInverted()){return this.isFull()||y.isEmpty()}return y.lo.gt(this.lo)&&y.hi.lt(this.hi)||this.isFull()}};S1Interval.prototype.intersects=function(y){if(this.isEmpty()||y.isEmpty()){return false}if(this.isInverted()){return y.isInverted()||y.lo.lte(this.hi)||y.hi.gte(this.lo)}else{if(y.isInverted()){return y.lo.lte(this.hi)||y.hi.gte(this.lo)}return y.lo.lte(this.hi)&&y.hi.gte(this.lo)}};S1Interval.prototype.interiorIntersects=function(y){if(this.isEmpty()||y.isEmpty()||this.lo.eq(this.hi)){return false}if(this.isInverted()){return y.isInverted()||y.lo.lt(this.hi)||y.hi.gt(this.lo)}else{if(y.isInverted()){return y.lo.lt(this.hi)||y.hi.gt(this.lo)}return y.lo.lt(this.hi)&&y.hi.gt(this.lo)||this.isFull()}};S1Interval.prototype.addPoint=function(_p){var p=S2_1.S2.toDecimal(_p);if(p.eq(-S2_1.S2.M_PI)){p=S2_1.S2.toDecimal(S2_1.S2.M_PI)}if(this.fastContains(p)){return new S1Interval(this.lo,this.hi)}if(this.isEmpty()){return S1Interval.fromPoint(p)}else{var dlo=S1Interval.positiveDistance(p,this.lo);var dhi=S1Interval.positiveDistance(this.hi,p);if(dlo.lt(dhi)){return new S1Interval(p,this.hi)}else{return new S1Interval(this.lo,p)}}};S1Interval.prototype.expanded=function(_radius){var radius=S2_1.S2.toDecimal(_radius);if(this.isEmpty()){return this}if(this.getLength().plus(radius.times(2)).gte(2*S2_1.S2.M_PI-1e-15)){return S1Interval.full()}var lo=S2_1.S2.IEEEremainder(this.lo.minus(radius),2*S2_1.S2.M_PI);var hi=S2_1.S2.IEEEremainder(this.hi.plus(radius),2*S2_1.S2.M_PI);if(lo.eq(-S2_1.S2.M_PI)){lo=S2_1.S2.toDecimal(S2_1.S2.M_PI)}return new S1Interval(lo,hi)};S1Interval.prototype.union=function(y){if(y.isEmpty()){return this}if(this.fastContains(y.lo)){if(this.fastContains(y.hi)){if(this.containsI(y)){return this}return S1Interval.full()}return new S1Interval(this.lo,this.hi,true)}if(this.fastContains(y.hi)){return new S1Interval(y.lo,this.hi,true)}if(this.isEmpty()||y.fastContains(this.lo)){return y}var dlo=S1Interval.positiveDistance(y.hi,this.lo);var dhi=S1Interval.positiveDistance(this.hi,y.lo);if(dlo<dhi){return new S1Interval(y.lo,this.hi,true)}else{return new S1Interval(this.lo,y.hi,true)}};S1Interval.prototype.intersection=function(y){if(y.isEmpty()){return S1Interval.empty()}if(this.fastContains(y.lo)){if(this.fastContains(y.hi)){if(y.getLength().lt(this.getLength())){return y}return this}return new S1Interval(y.lo,this.hi,true)}if(this.fastContains(y.hi)){return new S1Interval(this.lo,y.hi,true)}if(y.fastContains(this.lo)){return this}return S1Interval.empty()};S1Interval.prototype.approxEquals=function(y,maxError){if(maxError===void 0){maxError=1e-9}if(this.isEmpty()){return y.getLength().lte(maxError)}if(y.isEmpty()){return this.getLength().lte(maxError)}return S2_1.S2.IEEEremainder(y.lo.minus(this.lo),2*S2_1.S2.M_PI).abs().plus(S2_1.S2.IEEEremainder(y.hi.minus(this.hi),2*S2_1.S2.M_PI).abs()).lte(maxError)};S1Interval.empty=function(){return new S1Interval(S2_1.S2.M_PI,-S2_1.S2.M_PI,true)};S1Interval.full=function(){return new S1Interval(-S2_1.S2.M_PI,S2_1.S2.M_PI,true)};S1Interval.fromPoint=function(_p){var p=S2_1.S2.toDecimal(_p);if(p.eq(-S2_1.S2.M_PI)){p=S2_1.S2.toDecimal(S2_1.S2.M_PI)}return new S1Interval(p,p,true)};S1Interval.fromPointPair=function(_p1,_p2){var p1=S2_1.S2.toDecimal(_p1);var p2=S2_1.S2.toDecimal(_p2);if(p1.eq(-S2_1.S2.M_PI)){p1=S2_1.S2.toDecimal(S2_1.S2.M_PI)}if(p2.eq(-S2_1.S2.M_PI)){p2=S2_1.S2.toDecimal(S2_1.S2.M_PI)}if(S1Interval.positiveDistance(p1,p2).lte(S2_1.S2.M_PI)){return new S1Interval(p1,p2,true)}else{return new S1Interval(p2,p1,true)}};S1Interval.positiveDistance=function(_a,_b){var a=S2_1.S2.toDecimal(_a);var b=S2_1.S2.toDecimal(_b);var d=b.minus(a);if(d.gte(0)){return d}return b.plus(S2_1.S2.M_PI).minus(a.minus(S2_1.S2.M_PI))};return S1Interval}(Interval_1.Interval);exports.S1Interval=S1Interval},{"./Interval":3,"./S2":9}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var S2Point_1=require("./S2Point");var decimal_1=require("./decimal");var S2Metric_1=require("./S2Metric");exports.S2Metric=S2Metric_1.S2Metric;var Long=require("long");var S2=function(){function S2(){}S2.IEEEremainder=function(_f1,_f2){var f1=S2.toDecimal(_f1);var f2=S2.toDecimal(_f2);var r=f1.mod(f2);if(r.isNaN()||r.eq(f2)||r.lessThanOrEqualTo(f2.abs().dividedBy(2))){return r}else{return(f1.gte(0)?S2.toDecimal(1):S2.toDecimal(-1)).times(r.minus(f2))}};S2.isUnitLength=function(p){return p.norm2().minus(1).abs().lte(1e-15)};S2.exp=function(v){if(v==0){return 0}var start=Math.floor(Math.log(v)/Math.log(2));for(var i=start;i<start+10;i++){var curVal=Math.abs(v)*Math.pow(2,-i);if(curVal>=.5&&curVal<1){return i}}throw new Error("method not written yet")};S2.robustCrossProd=function(a,b){var x=S2Point_1.S2Point.crossProd(S2Point_1.S2Point.add(b,a),S2Point_1.S2Point.sub(b,a));if(!x.equals(new S2Point_1.S2Point(0,0,0))){return x}return a.ortho()};S2.area=function(a,b,c){var sa=b.angle(c);var sb=c.angle(a);var sc=a.angle(b);var s=sa.plus(sb).plus(sc).times(.5);if(s.gte(3e-4)){var s2=s.pow(2);var dmin=s.minus(decimal_1.Decimal.max(sa,sb,sc));if(dmin.lt(s2.pow(2).times(s).times(.01))){var area=S2.girardArea(a,b,c);if(dmin.lt(s.times(area.times(.1)))){return area}}}return S2.toDecimal(4).times(decimal_1.Decimal.atan(decimal_1.Decimal.sqrt(decimal_1.Decimal.max(0,decimal_1.Decimal.tan(s.times(.5)).times(decimal_1.Decimal.tan(s.minus(sa).times(.5))).times(decimal_1.Decimal.tan(s.minus(sb).times(.5))).times(decimal_1.Decimal.tan(s.minus(sc).times(.5)))))))};S2.girardArea=function(a,b,c){var ab=S2Point_1.S2Point.crossProd(a,b);var bc=S2Point_1.S2Point.crossProd(b,c);var ac=S2Point_1.S2Point.crossProd(a,c);return decimal_1.Decimal.max(0,ab.angle(ac).minus(ab.angle(bc)).plus(bc.angle(ac)))};S2.toDecimal=function(value){if(typeof value==="number"||typeof value==="string"){return new decimal_1.Decimal(value)}return value};S2.simpleCCW=function(a,b,c){return S2Point_1.S2Point.crossProd(c,a).dotProd(b).gt(0)};S2.simpleCrossing=function(a,b,c,d){var ab=S2Point_1.S2Point.crossProd(a,b);var cd=S2Point_1.S2Point.crossProd(c,d);var acb=ab.dotProd(c).neg();var cbd=cd.dotProd(b).neg();var bda=ab.dotProd(d);var dac=cd.dotProd(a);return acb.times(cbd).gt(0)&&cbd.times(bda).gt(0)&&bda.times(dac).gt(0)};S2.M_PI=Math.PI;S2.M_1_PI=1/Math.PI;S2.M_PI_2=Math.PI/2;S2.M_PI_4=Math.PI/4;S2.M_SQRT2=Math.sqrt(2);S2.M_E=Math.E;S2.SWAP_MASK=1;S2.INVERT_MASK=2;S2.EXPONENT_SHIFT=52;S2.EXPONENT_MASK=Long.fromString("0x7ff0000000000000",true,16);S2.POS_TO_ORIENTATION=[S2.SWAP_MASK,0,0,S2.INVERT_MASK+S2.SWAP_MASK];S2.POS_TO_IJ=[[0,1,3,2],[0,2,3,1],[3,2,0,1],[3,1,0,2]];S2.MAX_LEVEL=30;S2.Metric=S2Metric_1.S2Metric;return S2}();exports.S2=S2},{"./S2Metric":17,"./S2Point":18,"./decimal":21,long:2}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var S2_1=require("./S2");var S2Point_1=require("./S2Point");var S1Angle_1=require("./S1Angle");var S2LatLngRect_1=require("./S2LatLngRect");var S2LatLng_1=require("./S2LatLng");var R1Interval_1=require("./R1Interval");var S1Interval_1=require("./S1Interval");var Long=require("long");var decimal_1=require("./decimal");var S2Cap=function(){function S2Cap(axis,_height){this.axis=axis;this.height=S2_1.S2.toDecimal(_height)}S2Cap.fromAxisAngle=function(axis,angle){var d=angle.radians.times(.5).sin();return new S2Cap(axis,d.pow(2).times(2))};S2Cap.fromAxisArea=function(axis,_area){var area=S2_1.S2.toDecimal(_area);return new S2Cap(axis,area.dividedBy(S2_1.S2.toDecimal(2).times(S2_1.S2.M_PI)))};S2Cap.empty=function(){return new S2Cap(new S2Point_1.S2Point(1,0,0),-1)};S2Cap.full=function(){return new S2Cap(new S2Point_1.S2Point(1,0,0),2)};S2Cap.prototype.getCapBound=function(){return this};S2Cap.prototype.area=function(){return decimal_1.Decimal.max(0,this.height).times(S2_1.S2.M_PI).times(2)};S2Cap.prototype.angle=function(){if(this.isEmpty()){return new S1Angle_1.S1Angle(-1)}return new S1Angle_1.S1Angle(decimal_1.Decimal.asin(this.height.times(.5).sqrt()).times(2))};S2Cap.prototype.isValid=function(){return S2_1.S2.isUnitLength(this.axis)&&this.height.lte(2)};S2Cap.prototype.isEmpty=function(){return this.height.lt(0)};S2Cap.prototype.isFull=function(){return this.height.gte(2)};S2Cap.prototype.complement=function(){var cHeight=this.isFull()?-1:decimal_1.Decimal.max(this.height,0).neg().plus(2);return new S2Cap(S2Point_1.S2Point.neg(this.axis),cHeight)};S2Cap.prototype.containsCap=function(other){if(this.isFull()||other.isEmpty()){return true}return this.angle().radians.gte(this.axis.angle(other.axis).plus(other.angle().radians))};S2Cap.prototype.interiorIntersects=function(other){return!this.complement().containsCap(other)};S2Cap.prototype.interiorContains=function(p){return this.isFull()||S2Point_1.S2Point.sub(this.axis,p).norm2().lt(this.height.times(2))};S2Cap.prototype.addPoint=function(p){if(this.isEmpty()){return new S2Cap(p,0)}else{var dist2=S2Point_1.S2Point.sub(this.axis,p).norm2();var newHeight=decimal_1.Decimal.max(this.height,S2Cap.ROUND_UP.times(.5).times(dist2));return new S2Cap(this.axis,newHeight)}};S2Cap.prototype.addCap=function(other){if(this.isEmpty()){return new S2Cap(other.axis,other.height)}else{var angle=this.axis.angle(other.axis).plus(other.angle().radians);if(angle.gte(S2_1.S2.M_PI)){return new S2Cap(this.axis,2)}else{var d=angle.times(.5).sin();var newHeight=decimal_1.Decimal.max(this.height,S2Cap.ROUND_UP.times(2).times(d.pow(2)));return new S2Cap(this.axis,newHeight)}}};S2Cap.prototype.getRectBound=function(){if(this.isEmpty()){return S2LatLngRect_1.S2LatLngRect.empty()}var axisLatLng=S2LatLng_1.S2LatLng.fromPoint(this.axis);var capAngle=this.angle().radians;var allLongitudes=false;var lat=Array(2);var lng=Array(2);lng[0]=S2_1.S2.toDecimal(-S2_1.S2.M_PI);lng[1]=S2_1.S2.toDecimal(S2_1.S2.M_PI);lat[0]=axisLatLng.latRadians.minus(capAngle);if(lat[0].lte(-S2_1.S2.M_PI_2)){lat[0]=S2_1.S2.toDecimal(-S2_1.S2.M_PI_2);allLongitudes=true}lat[1]=axisLatLng.latRadians.plus(capAngle);if(lat[1].gte(S2_1.S2.M_PI_2)){lat[1]=S2_1.S2.toDecimal(S2_1.S2.M_PI_2);allLongitudes=true}if(!allLongitudes){var sinA=this.height.times(this.height.neg().plus(2)).sqrt();var sinC=axisLatLng.latRadians.cos();if(sinA.lte(sinC)){var angleA=decimal_1.Decimal.asin(sinA.dividedBy(sinC));lng[0]=S2_1.S2.IEEEremainder(axisLatLng.lngRadians.minus(angleA),2*S2_1.S2.M_PI);lng[1]=S2_1.S2.IEEEremainder(axisLatLng.lngRadians.plus(angleA),2*S2_1.S2.M_PI)}}return new S2LatLngRect_1.S2LatLngRect(new R1Interval_1.R1Interval(lat[0],lat[1]),new S1Interval_1.S1Interval(lng[0],lng[1]))};S2Cap.prototype.containsC=function(cell){var vertices=new Array(4);for(var k=0;k<4;++k){vertices[k]=cell.getVertex(k);if(!this.contains(vertices[k])){return false}}return!this.complement().intersects(cell,vertices)};S2Cap.prototype.mayIntersectC=function(cell){var vertices=new Array(4);for(var k=0;k<4;++k){vertices[k]=cell.getVertex(k);if(this.contains(vertices[k])){return true}}return this.intersects(cell,vertices)};S2Cap.prototype.intersects=function(cell,vertices){if(this.height.gte(1)){return false}if(this.isEmpty()){return false}if(cell.contains(this.axis)){return true}var sin2Angle=this.height.times(this.height.neg().plus(2));for(var k=0;k<4;++k){var edge=cell.getEdgeRaw(k);var dot=this.axis.dotProd(edge);if(dot.gt(0)){continue}if(dot.pow(2).gt(sin2Angle.times(edge.norm2()))){return false}var dir=S2Point_1.S2Point.crossProd(edge,this.axis);if(dir.dotProd(vertices[k]).lt(0)&&dir.dotProd(vertices[k+1&3]).gt(0)){return true}}return false};S2Cap.prototype.contains=function(p){return S2Point_1.S2Point.sub(this.axis,p).norm2().lte(this.height.times(2))};S2Cap.prototype.approxEquals=function(other,maxError){if(maxError===void 0){maxError=1e-14}return this.axis.aequal(other.axis,maxError)&&this.height.minus(other.height).lte(maxError)||this.isEmpty()&&other.height.lte(maxError)||other.isEmpty()&&this.height.lte(maxError)||this.isFull()&&other.height.gte(2-maxError)||other.isFull()&&this.height.gte(2-maxError)};S2Cap.prototype.toString=function(){return"[Point = "+this.axis.toString()+" Height = "+this.height.toString()+"]"};S2Cap.prototype.toGEOJSON=function(){return this.getRectBound().toGEOJSON()};S2Cap.ROUND_UP=S2_1.S2.toDecimal(1).dividedBy(new Long(1).shiftLeft(52).toString()).plus(1);return S2Cap}();exports.S2Cap=S2Cap},{"./R1Interval":5,"./S1Angle":7,"./S1Interval":8,"./S2":9,"./S2LatLng":15,"./S2LatLngRect":16,"./S2Point":18,"./decimal":21,long:2}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Long=require("long");var decimal_1=require("./decimal");var S2CellId_1=require("./S2CellId");var S2Point_1=require("./S2Point");var S2LatLng_1=require("./S2LatLng");var S2Projections_1=require("./S2Projections");var R2Vector_1=require("./R2Vector");var MutableInteger_1=require("./MutableInteger");var S2_1=require("./S2");var S2LatLngRect_1=require("./S2LatLngRect");var R1Interval_1=require("./R1Interval");var S1Interval_1=require("./S1Interval");var S2Cap_1=require("./S2Cap");var S2Cell=function(){function S2Cell(cellID){this.cellID=cellID;this._uv=[];this._uv.push([]);this._uv.push([]);this.init(cellID)}Object.defineProperty(S2Cell.prototype,"id",{get:function(){return this.cellID},enumerable:true,configurable:true});Object.defineProperty(S2Cell.prototype,"face",{get:function(){return this._face},enumerable:true,configurable:true});Object.defineProperty(S2Cell.prototype,"level",{get:function(){return this._level},enumerable:true,configurable:true});Object.defineProperty(S2Cell.prototype,"orientation",{get:function(){return this._orientation},enumerable:true,configurable:true});S2Cell.fromFacePosLevel=function(face,pos,level){return new S2Cell(S2CellId_1.S2CellId.fromFacePosLevel(face,new Long(pos),level))};S2Cell.fromPoint=function(p){return new S2Cell(S2CellId_1.S2CellId.fromPoint(p))};S2Cell.fromLatLng=function(ll){return new S2Cell(S2CellId_1.S2CellId.fromPoint(ll.toPoint()))};S2Cell.prototype.isLeaf=function(){return this.level==S2CellId_1.S2CellId.MAX_LEVEL};S2Cell.prototype.getVertex=function(k){return S2Point_1.S2Point.normalize(this.getVertexRaw(k))};S2Cell.prototype.getVertexRaw=function(k){return new R2Vector_1.R2Vector(this._uv[0][k>>1^k&1],this._uv[1][k>>1]).toPoint(this.face)};S2Cell.prototype.getEdge=function(k){return S2Point_1.S2Point.normalize(this.getEdgeRaw(k))};S2Cell.prototype.getEdgeRaw=function(k){switch(k){case 0:return S2Projections_1.S2Projections.getVNorm(this.face,this._uv[1][0]);case 1:return S2Projections_1.S2Projections.getUNorm(this.face,this._uv[0][1]);case 2:return S2Point_1.S2Point.neg(S2Projections_1.S2Projections.getVNorm(this.face,this._uv[1][1]));default:return S2Point_1.S2Point.neg(S2Projections_1.S2Projections.getUNorm(this.face,this._uv[0][0]))}};S2Cell.prototype.subdivide=function(){if(this.isLeaf()){return null}var children=new Array(4);var id=this.cellID.childBegin();for(var pos=0;pos<4;++pos,id=id.next()){children[pos]=new S2Cell(id)}return children};S2Cell.prototype.getCenter=function(){return S2Point_1.S2Point.normalize(this.getCenterRaw())};S2Cell.prototype.getCenterRaw=function(){return this.cellID.toPointRaw()};S2Cell.prototype.getCenterUV=function(){var i=new MutableInteger_1.MutableInteger(0);var j=new MutableInteger_1.MutableInteger(0);this.cellID.toFaceIJOrientation(i,j,null);var cellSize=1<<S2CellId_1.S2CellId.MAX_LEVEL-this.level;var si=(i.val&-cellSize)*2+cellSize-S2Cell.MAX_CELL_SIZE;var x=R2Vector_1.R2Vector.singleStTOUV(S2_1.S2.toDecimal(1).dividedBy(S2Cell.MAX_CELL_SIZE).times(si));var sj=(j.val&-cellSize)*2+cellSize-S2Cell.MAX_CELL_SIZE;var y=R2Vector_1.R2Vector.singleStTOUV(S2_1.S2.toDecimal(1).dividedBy(S2Cell.MAX_CELL_SIZE).times(sj));return new R2Vector_1.R2Vector(x,y)};S2Cell.averageArea=function(level){return S2Projections_1.S2Projections.AVG_AREA.getValue(level)};S2Cell.prototype.averageArea=function(){return S2Projections_1.S2Projections.AVG_AREA.getValue(this.level)};S2Cell.prototype.approxArea=function(){if(this.level<2){return this.averageArea()}var flatArea=S2Point_1.S2Point.crossProd(S2Point_1.S2Point.sub(this.getVertex(2),this.getVertex(0)),S2Point_1.S2Point.sub(this.getVertex(3),this.getVertex(1))).norm().times(.5);return flatArea.times(2).dividedBy(decimal_1.Decimal.min(flatArea.times(S2_1.S2.M_1_PI),1).neg().plus(1).sqrt().plus(1)).toNumber()};S2Cell.prototype.exactArea=function(){var v0=this.getVertex(0);var v1=this.getVertex(1);var v2=this.getVertex(2);var v3=this.getVertex(3);return S2_1.S2.area(v0,v1,v2).plus(S2_1.S2.area(v0,v2,v3))};S2Cell.prototype.getCapBound=function(){var u=this._uv[0][0].plus(this._uv[0][1]).times(.5);var v=this._uv[1][0].plus(this._uv[1][1]).times(.5);var cap=new S2Cap_1.S2Cap(S2Point_1.S2Point.normalize(S2Projections_1.S2Projections.faceUvToXyz(this.face,u,v)),0);for(var k=0;k<4;++k){cap=cap.addPoint(this.getVertex(k))}return cap};S2Cell.prototype.getRectBound=function(){if(this.level>0){var u=this._uv[0][0].plus(this._uv[0][1]);var v=this._uv[1][0].plus(this._uv[1][1]);var i=S2Projections_1.S2Projections.getUAxis(this.face).z.eq(0)?u.lt(0)?1:0:u.gt(0)?1:0;var j=S2Projections_1.S2Projections.getVAxis(this.face).z.eq(0)?v.lt(0)?1:0:v.gt(0)?1:0;var lat=R1Interval_1.R1Interval.fromPointPair(this.getLatitude(i,j),this.getLatitude(1-i,1-j));lat=lat.expanded(S2Cell.MAX_ERROR).intersection(S2LatLngRect_1.S2LatLngRect.fullLat());if(lat.lo.eq(-S2_1.S2.M_PI_2)||lat.hi.eq(S2_1.S2.M_PI_2)){return new S2LatLngRect_1.S2LatLngRect(lat,S1Interval_1.S1Interval.full())}var lng=S1Interval_1.S1Interval.fromPointPair(this.getLongitude(i,1-j),this.getLongitude(1-i,j));return new S2LatLngRect_1.S2LatLngRect(lat,lng.expanded(S2Cell.MAX_ERROR))}switch(this.face){case 0:return new S2LatLngRect_1.S2LatLngRect(new R1Interval_1.R1Interval(-S2_1.S2.M_PI_4,S2_1.S2.M_PI_4),new S1Interval_1.S1Interval(-S2_1.S2.M_PI_4,S2_1.S2.M_PI_4));case 1:return new S2LatLngRect_1.S2LatLngRect(new R1Interval_1.R1Interval(-S2_1.S2.M_PI_4,S2_1.S2.M_PI_4),new S1Interval_1.S1Interval(S2_1.S2.M_PI_4,3*S2_1.S2.M_PI_4));case 2:return new S2LatLngRect_1.S2LatLngRect(new R1Interval_1.R1Interval(S2Cell.POLE_MIN_LAT,S2_1.S2.M_PI_2),new S1Interval_1.S1Interval(-S2_1.S2.M_PI,S2_1.S2.M_PI));case 3:return new S2LatLngRect_1.S2LatLngRect(new R1Interval_1.R1Interval(-S2_1.S2.M_PI_4,S2_1.S2.M_PI_4),new S1Interval_1.S1Interval(3*S2_1.S2.M_PI_4,-3*S2_1.S2.M_PI_4));case 4:return new S2LatLngRect_1.S2LatLngRect(new R1Interval_1.R1Interval(-S2_1.S2.M_PI_4,S2_1.S2.M_PI_4),new S1Interval_1.S1Interval(-3*S2_1.S2.M_PI_4,-S2_1.S2.M_PI_4));default:return new S2LatLngRect_1.S2LatLngRect(new R1Interval_1.R1Interval(-S2_1.S2.M_PI_2,-S2Cell.POLE_MIN_LAT),new S1Interval_1.S1Interval(-S2_1.S2.M_PI,S2_1.S2.M_PI))}};S2Cell.prototype.mayIntersect=function(cell){return this.cellID.intersects(cell.cellID)};S2Cell.prototype.contains=function(p){var uvPoint=p.toR2Vector(this.face);if(uvPoint==null){return false}return uvPoint.x.gte(this._uv[0][0])&&uvPoint.x.lte(this._uv[0][1])&&uvPoint.y.gte(this._uv[1][0])&&uvPoint.y.lte(this._uv[1][1])};S2Cell.prototype.containsC=function(cell){return this.cellID.contains(cell.cellID)};S2Cell.prototype.init=function(id){this.cellID=id;var ij=[];var mOrientation=new MutableInteger_1.MutableInteger(0);for(var d=0;d<2;++d){ij[d]=new MutableInteger_1.MutableInteger(0)}this._face=id.toFaceIJOrientation(ij[0],ij[1],mOrientation);this._orientation=mOrientation.val;this._level=id.level();var cellSize=1<<S2CellId_1.S2CellId.MAX_LEVEL-this.level;for(var d=0;d<2;++d){var sijLo=(ij[d].val&-cellSize)*2-S2Cell.MAX_CELL_SIZE;var sijHi=sijLo+cellSize*2;var s=S2_1.S2.toDecimal(1).dividedBy(S2Cell.MAX_CELL_SIZE);this._uv[d][0]=R2Vector_1.R2Vector.singleStTOUV(s.times(sijLo));this._uv[d][1]=R2Vector_1.R2Vector.singleStTOUV(s.times(sijHi))}};S2Cell.prototype.getLatitude=function(i,j){var p=S2Projections_1.S2Projections.faceUvToXyz(this.face,this._uv[0][i],this._uv[1][j]);return decimal_1.Decimal.atan2(p.z,p.x.pow(2).plus(p.y.pow(2)).sqrt())};S2Cell.prototype.getLongitude=function(i,j){var p=S2Projections_1.S2Projections.faceUvToXyz(this.face,this._uv[0][i],this._uv[1][j]);return decimal_1.Decimal.atan2(p.y,p.x)};S2Cell.prototype.toString=function(){return"["+this._face+", "+this._level+", "+this._orientation+", "+this.cellID.toToken()+"]"};S2Cell.prototype.toGEOJSON=function(){var coords=[this.getVertex(0),this.getVertex(1),this.getVertex(2),this.getVertex(3),this.getVertex(0)].map(function(v){return S2LatLng_1.S2LatLng.fromPoint(v)}).map(function(v){return[v.lngDegrees.toNumber(),v.latDegrees.toNumber()]});return{type:"Feature",geometry:{type:"Polygon",coordinates:[coords]},properties:{},title:"Cell: "+this.id.toToken()+" lvl: "+this.level}};S2Cell.MAX_CELL_SIZE=1<<S2CellId_1.S2CellId.MAX_LEVEL;S2Cell.MAX_ERROR=S2_1.S2.toDecimal(1).dividedBy(S2_1.S2.toDecimal(new Long(1).shiftLeft(51).toString()));S2Cell.POLE_MIN_LAT=decimal_1.Decimal.asin(S2_1.S2.toDecimal(1).dividedBy(3).sqrt()).minus(S2Cell.MAX_ERROR);return S2Cell}();exports.S2Cell=S2Cell},{"./MutableInteger":4,"./R1Interval":5,"./R2Vector":6,"./S1Interval":8,"./S2":9,"./S2Cap":10,"./S2CellId":12,"./S2LatLng":15,"./S2LatLngRect":16,"./S2Point":18,"./S2Projections":19,"./decimal":21,long:2}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Long=require("long");var S2Point_1=require("./S2Point");var R2Vector_1=require("./R2Vector");var S2_1=require("./S2");var MutableInteger_1=require("./MutableInteger");var S2LatLng_1=require("./S2LatLng");var decimal_1=require("./decimal");var parseHex=function parseHex(str){return Long.fromString(str,false,16)};var S2CellId=function(){function S2CellId(id){if(typeof id==="string"){this.id=Long.fromString(id)}else{this.id=id}}Object.defineProperty(S2CellId.prototype,"face",{get:function(){return this.id.shiftRightUnsigned(S2CellId.POS_BITS).toInt()},enumerable:true,configurable:true});S2CellId.prototype.lowestOnBit=function(){return this.id.and(this.id.negate())};S2CellId.none=function(){return new S2CellId(new Long(0))};S2CellId.sentinel=function(){return new S2CellId(S2CellId.MAX_UNSIGNED)};S2CellId.prototype.getBits1=function(i,j,k,bits){var nbits=k==7?S2CellId.MAX_LEVEL-7*S2CellId.LOOKUP_BITS:S2CellId.LOOKUP_BITS;bits+=(this.id.shiftRightUnsigned(k*2*S2CellId.LOOKUP_BITS+1).getLowBitsUnsigned()&(1<<2*nbits)-1)<<2;bits=S2CellId.LOOKUP_IJ[bits];i.val=i.val+(bits>>S2CellId.LOOKUP_BITS+2<<k*S2CellId.LOOKUP_BITS);j.val=j.val+((bits>>2&(1<<S2CellId.LOOKUP_BITS)-1)<<k*S2CellId.LOOKUP_BITS);bits&=S2_1.S2.SWAP_MASK|S2_1.S2.INVERT_MASK;return bits};S2CellId.prototype.faceSiTiToXYZ=function(face,si,ti){var kScale=S2_1.S2.toDecimal(1).dividedBy(S2CellId.MAX_SIZE);var uvVector=R2Vector_1.R2Vector.fromSTVector(new R2Vector_1.R2Vector(kScale.times(si),kScale.times(ti)));return uvVector.toPoint(face)};S2CellId.lowestOnBitForLevel=function(level){return new Long(1).shiftLeft(2*(S2CellId.MAX_LEVEL-level))};S2CellId.prototype.toFaceIJOrientation=function(pi,pj,orientation){var face=this.face;var bits=face&S2_1.S2.SWAP_MASK;for(var k=7;k>=0;--k){bits=this.getBits1(pi,pj,k,bits)}if(orientation!=null){if(Long.fromString("0x1111111111111110",true,16).and(this.lowestOnBit()).notEquals(0)){bits^=S2_1.S2.SWAP_MASK}orientation.val=bits}return face};S2CellId.prototype.isLeaf=function(){return this.id.and(1).getLowBits()!=0};S2CellId.prototype.parentL=function(level){var newLsb=S2CellId.lowestOnBitForLevel(level);return new S2CellId(this.id.and(newLsb.negate()).or(newLsb))};S2CellId.prototype.parent=function(){var newLsb=this.lowestOnBit().shiftLeft(2);return new S2CellId(this.id.and(newLsb.negate()).or(newLsb))};S2CellId.fromFacePosLevel=function(face,pos,level){return new S2CellId(new Long(face).shiftLeft(S2CellId.POS_BITS).add(pos.or(1))).parentL(level)};S2CellId.fromPoint=function(p){var face=p.toFace();var uv=p.toR2Vector(face);var i=S2CellId.stToIJ(uv.toSt(0));var j=S2CellId.stToIJ(uv.toSt(1));return S2CellId.fromFaceIJ(face,i,j)};S2CellId.prototype.toPoint=function(){return S2Point_1.S2Point.normalize(this.toPointRaw())};S2CellId.prototype.toPointRaw=function(){var i=new MutableInteger_1.MutableInteger(0);var j=new MutableInteger_1.MutableInteger(0);var face=this.toFaceIJOrientation(i,j,null);var delta=this.isLeaf()?1:((new Long(i.val).getLowBits()^this.id.getLowBits()>>>2)&1)!=0?2:0;var si=new Long((i.val<<1)+delta-S2CellId.MAX_SIZE).getLowBits();var ti=new Long((j.val<<1)+delta-S2CellId.MAX_SIZE).getLowBits();return this.faceSiTiToXYZ(face,si,ti)};S2CellId.prototype.toLatLng=function(){return S2LatLng_1.S2LatLng.fromPoint(this.toPointRaw())};S2CellId.prototype.isValid=function(){return this.face<S2CellId.NUM_FACES&&this.lowestOnBit().and(Long.fromString("0x1555555555555555",false,16)).notEquals(0)};S2CellId.prototype.pos=function(){return this.id.and(S2CellId.MAX_UNSIGNED.shiftRightUnsigned(S2CellId.FACE_BITS))};S2CellId.prototype.level=function(){if(this.isLeaf()){return S2CellId.MAX_LEVEL}var x=this.id.getLowBits();var level=-1;if(x!=0){level+=16}else{x=this.id.shiftRightUnsigned(32).getLowBits()}x&=-x;if((x&21845)!=0){level+=8}if((x&5570645)!=0){level+=4}if((x&84215045)!=0){level+=2}if((x&286331153)!=0){level+=1}return level};S2CellId.prototype.isFace=function(){return this.level()===0};S2CellId.prototype.childPosition=function(level){return this.id.shiftRight(2*(S2CellId.MAX_LEVEL-level)+1).and(3).getLowBits()};S2CellId.prototype.rangeMin=function(){return new S2CellId(this.id.sub(this.lowestOnBit().sub(1)))};S2CellId.prototype.rangeMax=function(){return new S2CellId(this.id.add(this.lowestOnBit().sub(1)))};S2CellId.prototype.contains=function(other){return other.greaterOrEquals(this.rangeMin())&&other.lessOrEquals(this.rangeMax())};S2CellId.prototype.intersects=function(other){return other.rangeMin().lessOrEquals(this.rangeMax())&&other.rangeMax().greaterOrEquals(this.rangeMin())};S2CellId.prototype.childBegin=function(){var oldLsb=this.lowestOnBit();return new S2CellId(this.id.sub(oldLsb).add(oldLsb.shiftRight(2)))};S2CellId.prototype.childBeginL=function(level){return new S2CellId(this.id.sub(this.lowestOnBit()).add(S2CellId.lowestOnBitForLevel(level)))};S2CellId.prototype.childEnd=function(){var oldLsb=this.lowestOnBit();return new S2CellId(this.id.add(oldLsb).add(oldLsb.shiftRightUnsigned(2)))};S2CellId.prototype.childEndL=function(level){return new S2CellId(this.id.add(this.lowestOnBit()).add(S2CellId.lowestOnBitForLevel(level)))};S2CellId.prototype.next=function(){return new S2CellId(this.id.add(this.lowestOnBit().shiftLeft(1)))};S2CellId.prototype.prev=function(){return new S2CellId(this.id.sub(this.lowestOnBit().shiftLeft(1)))};S2CellId.prototype.nextWrap=function(){var n=this.next();if(S2CellId.unsignedLongLessThan(n.id,S2CellId.WRAP_OFFSET)){return n}return new S2CellId(n.id.sub(S2CellId.WRAP_OFFSET))};S2CellId.prototype.prevWrap=function(){var p=this.prev();if(p.id.lessThan(S2CellId.WRAP_OFFSET)){return p}return new S2CellId(p.id.add(S2CellId.WRAP_OFFSET))};S2CellId.begin=function(level){return S2CellId.fromFacePosLevel(0,new Long(0),0).childBeginL(level)};S2CellId.end=function(level){return S2CellId.fromFacePosLevel(5,new Long(0),0).childEndL(level)};S2CellId.fromToken=function(token){if(token==null){throw new Error("Null string in S2CellId.fromToken")}if(token.length==0){throw new Error("Empty string in S2CellId.fromToken")}if(token.length>16||"X"==token){return S2CellId.none()}var value=new Long(0);for(var pos=0;pos<16;pos++){var digit=new Long(0);if(pos<token.length){digit=Long.fromString(token[pos],true,16);if(digit.equals(-1)){throw new Error(token)}if(S2CellId.overflowInParse(value,digit.toNumber())){throw new Error("Too large for unsigned long: "+token)}}value=value.mul(16).add(digit)}return new S2CellId(value)};S2CellId.prototype.toToken=function(){if(this.id.equals(0)){return"X"}var hex=this.id.toUnsigned().toString(16);var sb="";for(var i=hex.length;i<16;i++){sb+="0"}sb+=hex;for(var len=16;len>0;len--){if(sb[len-1]!="0"){return sb.substring(0,len)}}throw new Error("Shouldn't make it here")};S2CellId.overflowInParse=function(current,digit,radix){if(radix===void 0){radix=10}if(current.greaterThanOrEqual(0)){if(current.lessThan(S2CellId.maxValueDivs[radix])){return false}if(current.greaterThan(S2CellId.maxValueDivs[radix])){return true}return digit>S2CellId.maxValueMods[radix]}return true};S2CellId.prototype.getEdgeNeighbors=function(){var i=new MutableInteger_1.MutableInteger(0);var j=new MutableInteger_1.MutableInteger(0);var level=this.level();var size=1<<S2CellId.MAX_LEVEL-level;var face=this.toFaceIJOrientation(i,j,null);var neighbors=[];neighbors.push(S2CellId.fromFaceIJSame(face,i.val,j.val-size,j.val-size>=0).parentL(level));neighbors.push(S2CellId.fromFaceIJSame(face,i.val+size,j.val,i.val+size<S2CellId.MAX_SIZE).parentL(level));neighbors.push(S2CellId.fromFaceIJSame(face,i.val,j.val+size,j.val+size<S2CellId.MAX_SIZE).parentL(level));neighbors.push(S2CellId.fromFaceIJSame(face,i.val-size,j.val,i.val-size>=0).parentL(level));return neighbors};S2CellId.prototype.getVertexNeighbors=function(level){var i=new MutableInteger_1.MutableInteger(0);var j=new MutableInteger_1.MutableInteger(0);var face=this.toFaceIJOrientation(i,j,null);var halfsize=1<<S2CellId.MAX_LEVEL-(level+1);var size=halfsize<<1;var isame,jsame;var ioffset,joffset;if((i.val&halfsize)!=0){ioffset=size;isame=i.val+size<S2CellId.MAX_SIZE}else{ioffset=-size;isame=i.val-size>=0}if((j.val&halfsize)!=0){joffset=size;jsame=j.val+size<S2CellId.MAX_SIZE}else{joffset=-size;jsame=j.val-size>=0}var toRet=[];toRet.push(this.parentL(level));toRet.push(S2CellId.fromFaceIJSame(face,i.val+ioffset,j.val,isame).parentL(level));toRet.push(S2CellId.fromFaceIJSame(face,i.val,j.val+joffset,jsame).parentL(level));if(isame||jsame){toRet.push(S2CellId.fromFaceIJSame(face,i.val+ioffset,j.val+joffset,isame&&jsame).parentL(level))}return toRet};S2CellId.prototype.getAllNeighbors=function(nbrLevel){var i=new MutableInteger_1.MutableInteger(0);var j=new MutableInteger_1.MutableInteger(0);var face=this.toFaceIJOrientation(i,j,null);var size=1<<S2CellId.MAX_LEVEL-this.level();i.val=i.val&-size;j.val=j.val&-size;var nbrSize=1<<S2CellId.MAX_LEVEL-nbrLevel;var output=[];for(var k=-nbrSize;;k+=nbrSize){var sameFace=void 0;if(k<0){sameFace=j.val+k>=0}else if(k>=size){sameFace=j.val+k<S2CellId.MAX_SIZE}else{sameFace=true;output.push(S2CellId.fromFaceIJSame(face,i.val+k,j.val-nbrSize,j.val-size>=0).parentL(nbrLevel));output.push(S2CellId.fromFaceIJSame(face,i.val+k,j.val+size,j.val+size<S2CellId.MAX_SIZE).parentL(nbrLevel))}output.push(S2CellId.fromFaceIJSame(face,i.val-nbrSize,j.val+k,sameFace&&i.val-size>=0).parentL(nbrLevel));output.push(S2CellId.fromFaceIJSame(face,i.val+size,j.val+k,sameFace&&i.val+size<S2CellId.MAX_SIZE).parentL(nbrLevel));if(k>=size){break}}return output};S2CellId.fromFaceIJ=function(face,i,j){var faceL=new Long(face);var n=[new Long(0),faceL.shiftLeft(S2CellId.POS_BITS-33)];var bits=faceL.and(S2CellId.SWAP_MASK);for(var k=7;k>=0;--k){bits=S2CellId.getBits(n,i,j,k,bits)}return new S2CellId(n[1].shiftLeft(32).add(n[0]).shiftLeft(1).add(1))};S2CellId.getBits=function(n,i,j,k,bits){var mask=new Long(1).shiftLeft(S2CellId.LOOKUP_BITS).sub(1);bits=bits.add(new Long(i).shiftRight(k*S2CellId.LOOKUP_BITS).and(mask).shiftLeft(S2CellId.LOOKUP_BITS+2));bits=bits.add(new Long(j).shiftRight(k*S2CellId.LOOKUP_BITS).and(mask).shiftLeft(2));bits=S2CellId.LOOKUP_POS[bits.toNumber()];n[k>>2]=n[k>>2].or(bits.shiftRight(2).shiftLeft((k&3)*2*S2CellId.LOOKUP_BITS));return bits.and(S2CellId.SWAP_MASK|S2CellId.INVERT_MASK)};S2CellId.stToIJ=function(_s){var s=S2_1.S2.toDecimal(_s);var m=S2_1.S2.toDecimal(S2CellId.MAX_SIZE).dividedBy(2);return decimal_1.Decimal.max(0,decimal_1.Decimal.min(m.times(2).minus(1),decimal_1.Decimal.round(m.times(s).plus(m.minus(.5))))).toNumber()};S2CellId.fromFaceIJWrap=function(face,i,j){i=Math.max(-1,Math.min(S2CellId.MAX_SIZE,i));j=Math.max(-1,Math.min(S2CellId.MAX_SIZE,j));var kScale=S2_1.S2.toDecimal(1).dividedBy(S2CellId.MAX_SIZE);var s=kScale.times(new Long(i).shiftLeft(1).add(1).sub(S2CellId.MAX_SIZE).toInt());var t=kScale.times(new Long(j).shiftLeft(1).add(1).sub(S2CellId.MAX_SIZE).toInt());var p=new R2Vector_1.R2Vector(s,t).toPoint(face);face=p.toFace();var st=p.toR2Vector(face);return S2CellId.fromFaceIJ(face,S2CellId.stToIJ(st.x),S2CellId.stToIJ(st.y))};S2CellId.fromFaceIJSame=function(face,i,j,sameFace){if(sameFace){return S2CellId.fromFaceIJ(face,i,j)}else{return S2CellId.fromFaceIJWrap(face,i,j)}};S2CellId.unsignedLongLessThan=function(x1,x2){return x1.toUnsigned().lessThan(x2.toUnsigned())};S2CellId.unsignedLongGreaterThan=function(x1,x2){return x1.toUnsigned().greaterThan(x2.toUnsigned())};S2CellId.prototype.lessThan=function(x){return S2CellId.unsignedLongLessThan(this.id,x.id)};S2CellId.prototype.greaterThan=function(x){return S2CellId.unsignedLongGreaterThan(this.id,x.id)};S2CellId.prototype.lessOrEquals=function(x){return S2CellId.unsignedLongLessThan(this.id,x.id)||this.id.equals(x.id)};S2CellId.prototype.greaterOrEquals=function(x){return S2CellId.unsignedLongGreaterThan(this.id,x.id)||this.id.equals(x.id)};S2CellId.prototype.toString=function(){return"(face="+this.face+", pos="+this.pos().toString(16)+", level="+this.level()+")"};S2CellId.prototype.compareTo=function(that){return S2CellId.unsignedLongLessThan(this.id,that.id)?-1:S2CellId.unsignedLongGreaterThan(this.id,that.id)?1:0};S2CellId.prototype.equals=function(that){return this.compareTo(that)===0};S2CellId.binarySearch=function(ids,_id,low){if(low===void 0){low=0}var id;if(_id instanceof S2CellId){id=_id}else if(_id instanceof Long){id=new S2CellId(_id)}var high=ids.length-1;while(low<=high){var mid=low+high>>>1;var midVal=ids[mid];var cmp=midVal.compareTo(id);if(cmp<0)low=mid+1;else if(cmp>0)high=mid-1;else return mid}return-(low+1)};S2CellId.indexedBinarySearch=function(ids,id,low){if(low===void 0){low=0}var toRet=this.binarySearch(ids,id,low);if(toRet>=0){return toRet}else{return-(toRet+1)}};S2CellId.FACE_BITS=3;S2CellId.NUM_FACES=6;S2CellId.MAX_LEVEL=30;S2CellId.POS_BITS=2*S2CellId.MAX_LEVEL+1;S2CellId.MAX_SIZE=1<<S2CellId.MAX_LEVEL;S2CellId.maxValueDivs=[new Long(0),new Long(0),parseHex("9223372036854775807"),parseHex("6148914691236517205"),parseHex("4611686018427387903"),parseHex("3689348814741910323"),parseHex("3074457345618258602"),parseHex("2635249153387078802"),parseHex("2305843009213693951"),parseHex("2049638230412172401"),parseHex("1844674407370955161"),parseHex("1676976733973595601"),parseHex("1537228672809129301"),parseHex("1418980313362273201"),parseHex("1317624576693539401"),parseHex("1229782938247303441"),parseHex("1152921504606846975"),parseHex("1085102592571150095"),parseHex("1024819115206086200"),parseHex("970881267037344821"),parseHex("922337203685477580"),parseHex("878416384462359600"),parseHex("838488366986797800"),parseHex("802032351030850070"),parseHex("768614336404564650"),parseHex("737869762948382064"),parseHex("709490156681136600"),parseHex("683212743470724133"),parseHex("658812288346769700"),parseHex("636094623231363848"),parseHex("614891469123651720"),parseHex("595056260442243600"),parseHex("576460752303423487"),parseHex("558992244657865200"),parseHex("542551296285575047"),parseHex("527049830677415760"),parseHex("512409557603043100")];S2CellId.maxValueMods=[0,0,1,0,3,0,3,1,7,6,5,4,3,2,1,0,15,0,15,16,15,15,15,5,15,15,15,24,15,23,15,15,31,15,17,15,15];S2CellId.MAX_UNSIGNED=Long.fromString("0xffffffffffffffff",true,16);S2CellId.LOOKUP_BITS=4;S2CellId.SWAP_MASK=1;S2CellId.INVERT_MASK=2;S2CellId.LOOKUP_POS=[];S2CellId.LOOKUP_IJ=[];S2CellId.WRAP_OFFSET=new Long(S2CellId.NUM_FACES).shiftLeft(S2CellId.POS_BITS);return S2CellId}();exports.S2CellId=S2CellId;function initLookupCell(level,i,j,origOrientation,pos,orientation){if(level==S2CellId.LOOKUP_BITS){var ij=(i<<S2CellId.LOOKUP_BITS)+j;S2CellId.LOOKUP_POS[(ij<<2)+origOrientation]=pos.shiftLeft(2).add(orientation);S2CellId.LOOKUP_IJ[pos.shiftLeft(2).add(origOrientation).toNumber()]=(ij<<2)+orientation}else{level++;i<<=1;j<<=1;pos=pos.shiftLeft(2);for(var subPos=0;subPos<4;subPos++){var ij=S2_1.S2.POS_TO_IJ[orientation][subPos];var orientationMask=S2_1.S2.POS_TO_ORIENTATION[subPos];initLookupCell(level,i+(ij>>>1),j+(ij&1),origOrientation,pos.add(subPos),orientation^orientationMask)}}}initLookupCell(0,0,0,0,new Long(0),0);initLookupCell(0,0,0,S2_1.S2.SWAP_MASK,new Long(0),S2_1.S2.SWAP_MASK);initLookupCell(0,0,0,S2_1.S2.INVERT_MASK,new Long(0),S2_1.S2.INVERT_MASK);initLookupCell(0,0,0,S2_1.S2.SWAP_MASK|S2_1.S2.INVERT_MASK,new Long(0),S2_1.S2.SWAP_MASK|S2_1.S2.INVERT_MASK)},{"./MutableInteger":4,"./R2Vector":6,"./S2":9,"./S2LatLng":15,"./S2Point":18,"./decimal":21,long:2}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Long=require("long");var S2CellId_1=require("./S2CellId");var S2Cell_1=require("./S2Cell");var S2Projections_1=require("./S2Projections");var S2LatLngRect_1=require("./S2LatLngRect");var S2Point_1=require("./S2Point");var S2_1=require("./S2");var S2Cap_1=require("./S2Cap");var S2CellUnion=function(){function S2CellUnion(){this.cellIds=[]}S2CellUnion.prototype.S2CellUnion=function(){};S2CellUnion.prototype.initFromIds=function(cellIds){this.initRawIds(cellIds);this.normalize()};S2CellUnion.prototype.initSwap=function(cellIds){this.initRawSwap(cellIds);this.normalize()};S2CellUnion.prototype.initRawCellIds=function(cellIds){this.cellIds=cellIds};S2CellUnion.prototype.initRawIds=function(cellIds){var size=cellIds.length;this.cellIds=[];for(var i=0;i<size;i++){this.cellIds.push(new S2CellId_1.S2CellId(cellIds[i]))}};S2CellUnion.prototype.initRawSwap=function(cellIds){this.cellIds=[].concat(cellIds)};S2CellUnion.prototype.size=function(){return this.cellIds.length};S2CellUnion.prototype.cellId=function(i){return this.cellIds[i]};S2CellUnion.prototype.getCellIds=function(){return this.cellIds};S2CellUnion.prototype.denormalize=function(minLevel,levelMod){var output=[];for(var i=0;i<this.cellIds.length;i++){var id=this.cellIds[i];var level=id.level();var newLevel=Math.max(minLevel,level);if(levelMod>1){newLevel+=(S2CellId_1.S2CellId.MAX_LEVEL-(newLevel-minLevel))%levelMod;newLevel=Math.min(S2CellId_1.S2CellId.MAX_LEVEL,newLevel)}if(newLevel==level){output.push(id)}else{var end=id.childEndL(newLevel);for(var iid=id.childBeginL(newLevel);!iid.equals(end);iid=iid.next()){output.push(iid)}}}return output};S2CellUnion.prototype.pack=function(){throw new Error("useless")};S2CellUnion.prototype.containsC=function(cell){return this.containsCell(cell)};S2CellUnion.prototype.mayIntersectC=function(cell){return this.mayIntersectCell(cell)};S2CellUnion.prototype.contains=function(id){var pos=S2CellId_1.S2CellId.binarySearch(this.cellIds,id.id);if(pos<0){pos=-pos-1}if(pos<this.cellIds.length&&this.cellIds[pos].rangeMin().lessOrEquals(id)){return true}return pos!=0&&this.cellIds[pos-1].rangeMax().greaterOrEquals(id)};S2CellUnion.prototype.intersects=function(id){var pos=S2CellId_1.S2CellId.binarySearch(this.cellIds,id.id);if(pos<0){pos=-pos-1}if(pos<this.cellIds.length&&this.cellIds[pos].rangeMin().lessOrEquals(id.rangeMax())){return true}return pos!=0&&this.cellIds[pos-1].rangeMax().greaterOrEquals(id.rangeMin())};S2CellUnion.prototype.containsUnion=function(that){for(var i=0;i<that.cellIds.length;i++){if(!this.contains(that.cellIds[i])){return false}}return true};S2CellUnion.prototype.containsCell=function(cell){return this.contains(cell.id)};S2CellUnion.prototype.intersectsUnion=function(that){for(var i=0;i<that.cellIds.length;i++){if(!this.intersects(that.cellIds[i])){return false}}return true};S2CellUnion.prototype.getUnion=function(x,y){this.cellIds=[].concat(x.cellIds).concat(y.cellIds);this.normalize()};S2CellUnion.prototype.getIntersection=function(x,id){this.cellIds=[];if(x.contains(id)){this.cellIds.push(id)}else{var pos=S2CellId_1.S2CellId.binarySearch(x.cellIds,id.rangeMin().id);if(pos<0){pos=-pos-1}var idmax=id.rangeMax();var size=x.cellIds.length;while(pos<size&&x.cellIds[pos].lessOrEquals(idmax)){this.cellIds.push(x.cellIds[pos++])}}};S2CellUnion.prototype.getIntersectionUU=function(x,y){this.cellIds=[];var i=0;var j=0;while(i<x.cellIds.length&&j<y.cellIds.length){var imin=x.cellId(i).rangeMin();var jmin=y.cellId(j).rangeMin();if(imin.greaterThan(jmin)){if(x.cellId(i).lessOrEquals(y.cellId(j).rangeMax())){this.cellIds.push(x.cellId(i++))}else{j=S2CellId_1.S2CellId.indexedBinarySearch(y.cellIds,imin,j+1);if(x.cellId(i).lessOrEquals(y.cellId(j-1).rangeMax())){--j}}}else if(jmin.greaterThan(imin)){if(y.cellId(j).lessOrEquals(x.cellId(i).rangeMax())){this.cellIds.push(y.cellId(j++))}else{i=S2CellId_1.S2CellId.indexedBinarySearch(x.cellIds,jmin,i+1);if(y.cellId(j).lessOrEquals(x.cellId(i-1).rangeMax())){--i}}}else{if(x.cellId(i).lessThan(y.cellId(j))){this.cellIds.push(x.cellId(i++))}else{this.cellIds.push(y.cellId(j++))}}}};S2CellUnion.prototype.expand=function(level){var output=[];var levelLsb=S2CellId_1.S2CellId.lowestOnBitForLevel(level);var i=this.size()-1;do{var id=this.cellId(i);if(id.lowestOnBit().lessThan(levelLsb)){id=id.parentL(level);while(i>0&&id.contains(this.cellId(i-1))){--i}}output.push(id);output=output.concat(id.getAllNeighbors(level))}while(--i>=0);this.initSwap(output)};S2CellUnion.prototype.expandA=function(minRadius,maxLevelDiff){var minLevel=S2CellId_1.S2CellId.MAX_LEVEL;for(var i=0;i<this.cellIds.length;i++){var id=this.cellId(i);minLevel=Math.min(minLevel,id.level())}var radiusLevel=S2Projections_1.S2Projections.MIN_WIDTH.getMaxLevel(minRadius.radians);if(radiusLevel==0&&minRadius.radians.gt(S2Projections_1.S2Projections.MIN_WIDTH.getValue(0))){this.expand(0)}this.expand(Math.min(minLevel+maxLevelDiff,radiusLevel))};S2CellUnion.prototype.getCapBound=function(){if(this.cellIds.length==0){return S2Cap_1.S2Cap.empty()}var centroid=new S2Point_1.S2Point(0,0,0);this.cellIds.forEach(function(id){var area=S2Cell_1.S2Cell.averageArea(id.level());centroid=S2Point_1.S2Point.add(centroid,S2Point_1.S2Point.mul(id.toPoint(),area))});if(centroid.equals(new S2Point_1.S2Point(0,0,0))){centroid=new S2Point_1.S2Point(1,0,0)}else{centroid=S2Point_1.S2Point.normalize(centroid)}var cap=new S2Cap_1.S2Cap(centroid,0);this.cellIds.forEach(function(id){cap=cap.addCap(new S2Cell_1.S2Cell(id).getCapBound())});return cap};S2CellUnion.prototype.getRectBound=function(){var bound=S2LatLngRect_1.S2LatLngRect.empty();this.cellIds.forEach(function(id){bound=bound.union(new S2Cell_1.S2Cell(id).getRectBound())});return bound};S2CellUnion.prototype.mayIntersectCell=function(cell){return this.intersects(cell.id)};S2CellUnion.prototype.containsPoint=function(p){return this.contains(S2CellId_1.S2CellId.fromPoint(p))};S2CellUnion.prototype.leafCellsCovered=function(){var numLeaves=new Long(0);this.cellIds.forEach(function(id){var invertedLevel=S2CellId_1.S2CellId.MAX_LEVEL-id.level();numLeaves=numLeaves.add(new Long(1).shiftLeft(invertedLevel<<1))});return numLeaves};S2CellUnion.prototype.averageBasedArea=function(){return S2_1.S2.toDecimal(this.leafCellsCovered().toString()).times(S2Projections_1.S2Projections.AVG_AREA.getValue(S2CellId_1.S2CellId.MAX_LEVEL)).toNumber()};S2CellUnion.prototype.approxArea=function(){var area=S2_1.S2.toDecimal(0);this.cellIds.forEach(function(id){area=area.plus(new S2Cell_1.S2Cell(id).approxArea())});return area.toNumber()};S2CellUnion.prototype.exactArea=function(){var area=S2_1.S2.toDecimal(0);this.cellIds.forEach(function(id){area=area.plus(new S2Cell_1.S2Cell(id).exactArea())});return area.toNumber()};S2CellUnion.prototype.normalize=function(){var output=[];this.cellIds.sort(function(a,b){return a.compareTo(b)});this.cellIds.forEach(function(id){var size=output.length;if(output.length!==0&&output[size-1].contains(id)){return}while(output.length!==0&&id.contains(output[output.length-1])){output.splice(output.length-1,1)}while(output.length>=3){size=output.length;if(output[size-3].id.and(output[size-2].id).and(output[size-1].id).notEquals(id.id)){break}var mask=id.lowestOnBit().shiftLeft(1);mask=mask.add(mask.shiftLeft(1)).not();var idMasked=id.id.and(mask);if(output[size-3].id.and(mask).notEquals(idMasked)||output[size-2].id.and(mask).notEquals(idMasked)||output[size-1].id.and(mask).notEquals(idMasked)||id.isFace()){break}output.splice(size-3);id=id.parent()}output.push(id)});if(output.length<this.size()){this.initRawSwap(output);return true}return false};return S2CellUnion}();exports.S2CellUnion=S2CellUnion},{"./S2":9,"./S2Cap":10,"./S2Cell":11,"./S2CellId":12,"./S2LatLngRect":16,"./S2Point":18,"./S2Projections":19,long:2}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var S2Point_1=require("./S2Point");var S2_1=require("./S2");var S1Angle_1=require("./S1Angle");var decimal_1=require("./decimal");var S2EdgeUtil=function(){function S2EdgeUtil(){}S2EdgeUtil.getDistance=function(x,a,b,aCrossB){if(aCrossB===void 0){aCrossB=S2_1.S2.robustCrossProd(a,b)}if(S2_1.S2.simpleCCW(aCrossB,a,x)&&S2_1.S2.simpleCCW(x,b,aCrossB)){var sinDist=x.dotProd(aCrossB).abs().dividedBy(aCrossB.norm());return new S1Angle_1.S1Angle(decimal_1.Decimal.asin(decimal_1.Decimal.min(1,sinDist)))}var linearDist2=decimal_1.Decimal.min(S2Point_1.S2Point.minus(x,a).norm2(),S2Point_1.S2Point.minus(x,b).norm2());return new S1Angle_1.S1Angle(decimal_1.Decimal.asin(decimal_1.Decimal.min(1,linearDist2.sqrt().times(.5))).times(2))};return S2EdgeUtil}();exports.S2EdgeUtil=S2EdgeUtil},{"./S1Angle":7,"./S2":9,"./S2Point":18,"./decimal":21}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var S1Angle_1=require("./S1Angle");var S2Point_1=require("./S2Point");var S2_1=require("./S2");var decimal_1=require("./decimal");var S2LatLng=function(){function S2LatLng(latRadians,lngRadians){this.latRadians=S2_1.S2.toDecimal(latRadians);this.lngRadians=S2_1.S2.toDecimal(lngRadians)}Object.defineProperty(S2LatLng.prototype,"latDegrees",{get:function(){return new S1Angle_1.S1Angle(this.latRadians).degrees()},enumerable:true,configurable:true});Object.defineProperty(S2LatLng.prototype,"lngDegrees",{get:function(){return new S1Angle_1.S1Angle(this.lngRadians).degrees()},enumerable:true,configurable:true});S2LatLng.prototype.toPoint=function(){var phi=this.latRadians;var theta=this.lngRadians;var cosphi=decimal_1.Decimal.cos(phi);return new S2Point_1.S2Point(decimal_1.Decimal.cos(theta).times(cosphi),decimal_1.Decimal.sin(theta).times(cosphi),decimal_1.Decimal.sin(phi))};S2LatLng.prototype.normalized=function(){return new S2LatLng(decimal_1.Decimal.max(-S2_1.S2.M_PI_2,decimal_1.Decimal.min(S2_1.S2.M_PI_2,this.latRadians)),S2_1.S2.IEEEremainder(this.lngRadians,S2_1.S2.toDecimal(2).times(S2_1.S2.M_PI)))};S2LatLng.fromDegrees=function(latDegrees,lngDegrees){return new S2LatLng(S1Angle_1.S1Angle.degrees(latDegrees).radians,S1Angle_1.S1Angle.degrees(lngDegrees).radians)};S2LatLng.fromPoint=function(p){return new S2LatLng(S2LatLng.latitude(p).radians,S2LatLng.longitude(p).radians)};S2LatLng.prototype.isValid=function(){return this.latRadians.abs().lte(S2_1.S2.M_PI_2)&&this.lngRadians.abs().lte(S2_1.S2.M_PI)};S2LatLng.prototype.mul=function(m){return new S2LatLng(this.latRadians.times(m),this.lngRadians.times(m))};S2LatLng.latitude=function(p){return new S1Angle_1.S1Angle(decimal_1.Decimal.atan2(p.z,p.x.pow(2).plus(p.y.pow(2)).sqrt()))};S2LatLng.longitude=function(p){return new S1Angle_1.S1Angle(decimal_1.Decimal.atan2(p.y,p.x))};S2LatLng.prototype.equals=function(other){return other.latRadians===this.latRadians&&other.lngRadians===this.lngRadians};S2LatLng.prototype.pointAtDistance=function(_distanceInKm,_bearingRadians){var distanceInM=S2_1.S2.toDecimal(_distanceInKm).times(1e3);var distanceToRadius=distanceInM.dividedBy(S2LatLng.EARTH_RADIUS_METERS);var bearingRadians=S2_1.S2.toDecimal(_bearingRadians);this.latRadians.sin();distanceToRadius.cos();var newLat=this.latRadians.sin().times(distanceToRadius.cos()).plus(this.latRadians.cos().times(distanceToRadius.sin()).times(bearingRadians.cos())).asin();var newLng=this.lngRadians.plus(decimal_1.Decimal.atan2(bearingRadians.sin().times(distanceToRadius.sin()).times(this.latRadians.cos()),distanceToRadius.cos().minus(this.latRadians.sin().times(newLat.sin()))));return new S2LatLng(newLat,newLng)};S2LatLng.prototype.pointsAtDistance=function(_distanceInKm,nPoints){var _this=this;if(nPoints===void 0){nPoints=4}return Array.apply(null,new Array(nPoints)).map(function(p,idx){return S2_1.S2.toDecimal(360).dividedBy(nPoints).times(idx)}).map(function(bearingDegree){return S1Angle_1.S1Angle.degrees(bearingDegree).radians}).map(function(bearingRadians){return _this.pointAtDistance(_distanceInKm,bearingRadians)})};S2LatLng.prototype.getEarthDistance=function(other){return this.getDistance(other).radians.times(S2LatLng.EARTH_RADIUS_METERS)};S2LatLng.prototype.getDistance=function(other){var dLat=other.latRadians.minus(this.latRadians).times(.5).sin();var dLng=other.lngRadians.minus(this.lngRadians).times(.5).sin();var x=dLat.pow(2).plus(dLng.pow(2).times(this.latRadians.cos()).times(other.latRadians.cos()));return new S1Angle_1.S1Angle(S2_1.S2.toDecimal(2).times(decimal_1.Decimal.atan2(x.sqrt(),decimal_1.Decimal.max(0,x.neg().plus(1)).sqrt())))};S2LatLng.prototype.toString=function(){return"("+this.latRadians+", "+this.lngRadians+")"};S2LatLng.prototype.toStringDegrees=function(){return"("+this.latDegrees+", "+this.lngDegrees+")"};S2LatLng.prototype.toGEOJSON=function(){return{type:"Feature",geometry:{type:"Point",coordinates:[this.lngDegrees.toNumber(),this.latDegrees.toNumber()]},properties:{}}};S2LatLng.EARTH_RADIUS_METERS=6367e3;S2LatLng.CENTER=new S2LatLng(0,0);return S2LatLng}();exports.S2LatLng=S2LatLng},{"./S1Angle":7,"./S2":9,"./S2Point":18,"./decimal":21}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var S1Interval_1=require("./S1Interval");var R1Interval_1=require("./R1Interval");var S2LatLng_1=require("./S2LatLng");var S2_1=require("./S2");var S2Point_1=require("./S2Point");var S1Angle_1=require("./S1Angle");var S2EdgeUtil_1=require("./S2EdgeUtil");var S2Cap_1=require("./S2Cap");var decimal_1=require("./decimal");var S2LatLngRect=function(){function S2LatLngRect(lat,lng){this.lat=lat;this.lng=lng}S2LatLngRect.fromLatLng=function(lo,hi){return new S2LatLngRect(new R1Interval_1.R1Interval(lo.latRadians,hi.latRadians),new S1Interval_1.S1Interval(lo.lngRadians,hi.lngRadians))};S2LatLngRect.empty=function(){return new S2LatLngRect(R1Interval_1.R1Interval.empty(),S1Interval_1.S1Interval.empty())};S2LatLngRect.full=function(){return new S2LatLngRect(S2LatLngRect.fullLat(),S1Interval_1.S1Interval.full())};S2LatLngRect.fullLat=function(){return new R1Interval_1.R1Interval(-S2_1.S2.M_PI_2,S2_1.S2.M_PI_2)};S2LatLngRect.fromCenterSize=function(center,size){return S2LatLngRect.fromPoint(center).expanded(size.mul(.5))};S2LatLngRect.fromPoint=function(p){return S2LatLngRect.fromLatLng(p,p)};S2LatLngRect.fromPointPair=function(p1,p2){return new S2LatLngRect(R1Interval_1.R1Interval.fromPointPair(p1.latRadians,p2.latRadians),S1Interval_1.S1Interval.fromPointPair(p1.lngRadians,p2.lngRadians))};S2LatLngRect.fromEdge=function(a,b){var r=S2LatLngRect.fromPointPair(S2LatLng_1.S2LatLng.fromPoint(a),S2LatLng_1.S2LatLng.fromPoint(b));var ab=S2_1.S2.robustCrossProd(a,b);var dir=S2Point_1.S2Point.crossProd(ab,new S2Point_1.S2Point(0,0,1));var da=dir.dotProd(a);var db=dir.dotProd(b);if(da.times(db).gte(0)){return r}var absLat=decimal_1.Decimal.acos(ab.z.dividedBy(ab.norm()).abs());if(da.lt(0)){return new S2LatLngRect(new R1Interval_1.R1Interval(r.lat.lo,absLat),r.lng)}else{return new S2LatLngRect(new R1Interval_1.R1Interval(-absLat,r.lat.hi),r.lng)}};S2LatLngRect.prototype.isValid=function(){return this.lat.lo.abs().lte(S2_1.S2.M_PI_2)&&this.lat.hi.abs().lte(S2_1.S2.M_PI_2)&&this.lng.isValid()&&this.lat.isEmpty()==this.lng.isEmpty()};S2LatLngRect.prototype.lo=function(){return new S2LatLng_1.S2LatLng(this.lat.lo,this.lng.lo)};S2LatLngRect.prototype.hi=function(){return new S2LatLng_1.S2LatLng(this.lat.hi,this.lng.hi)};S2LatLngRect.prototype.isEmpty=function(){return this.lat.isEmpty()};S2LatLngRect.prototype.isFull=function(){return this.lat.equals(S2LatLngRect.fullLat())&&this.lng.isFull()};S2LatLngRect.prototype.isInverted=function(){return this.lng.isInverted()};S2LatLngRect.prototype.getVertex=function(k){switch(k){case 0:return this.lo();case 1:return new S2LatLng_1.S2LatLng(this.lat.lo,this.lng.hi);case 2:return this.hi();case 3:return new S2LatLng_1.S2LatLng(this.lat.hi,this.lng.lo);default:throw new Error("Invalid vertex index.")}};S2LatLngRect.prototype.getCenter=function(){return new S2LatLng_1.S2LatLng(this.lat.getCenter(),this.lng.getCenter())};S2LatLngRect.prototype.getDistanceLL=function(p){var a=this;if(a.isEmpty()){throw new Error}if(!p.isValid()){throw new Error("point is not valid")}if(a.lng.contains(p.lngRadians)){return new S1Angle_1.S1Angle(decimal_1.Decimal.max(0,decimal_1.Decimal.max(p.latRadians.minus(a.lat.hi),a.lat.lo.minus(p.latRadians))))}var interval=new S1Interval_1.S1Interval(a.lng.hi,a.lng.complement().getCenter());var aLng=a.lng.lo;if(interval.contains(p.lngRadians)){aLng=a.lng.hi}var lo=new S2LatLng_1.S2LatLng(a.lat.lo,aLng).toPoint();var hi=new S2LatLng_1.S2LatLng(a.lat.hi,aLng).toPoint();var loCrossHi=new S2LatLng_1.S2LatLng(0,aLng.minus(S2_1.S2.M_PI_2)).normalized().toPoint();return S2EdgeUtil_1.S2EdgeUtil.getDistance(p.toPoint(),lo,hi,loCrossHi)};S2LatLngRect.prototype.getDistanceLLR=function(other){var a=this;var b=other;if(a.isEmpty()){throw new Error}if(b.isEmpty()){throw new Error}if(a.lng.intersects(b.lng)){if(a.lat.intersects(b.lat)){return new S1Angle_1.S1Angle(0)}var lo=void 0,hi=void 0;if(a.lat.lo.gt(b.lat.hi)){lo=b.lat.hi;hi=a.lat.lo}else{lo=a.lat.hi;hi=b.lat.lo}return new S1Angle_1.S1Angle(hi.radians().minus(lo.radians()))}var aLng,bLng;var loHi=S1Interval_1.S1Interval.fromPointPair(a.lng.lo,b.lng.hi);var hiLo=S1Interval_1.S1Interval.fromPointPair(a.lng.hi,b.lng.lo);if(loHi.getLength().lt(hiLo.getLength())){aLng=a.lng.lo;bLng=b.lng.hi}else{aLng=a.lng.hi;bLng=b.lng.lo}var aLo=new S2LatLng_1.S2LatLng(a.lat.lo,aLng).toPoint();var aHi=new S2LatLng_1.S2LatLng(a.lat.hi,aLng).toPoint();var aLoCrossHi=new S2LatLng_1.S2LatLng(0,aLng.radians().minus(S2_1.S2.M_PI_2)).normalized().toPoint();var bLo=new S2LatLng_1.S2LatLng(b.lat.lo,bLng).toPoint();var bHi=new S2LatLng_1.S2LatLng(b.lat.hi,bLng).toPoint();var bLoCrossHi=new S2LatLng_1.S2LatLng(0,bLng.radians().minus(S2_1.S2.M_PI_2)).normalized().toPoint();return S1Angle_1.S1Angle.min(S2EdgeUtil_1.S2EdgeUtil.getDistance(aLo,bLo,bHi,bLoCrossHi),S1Angle_1.S1Angle.min(S2EdgeUtil_1.S2EdgeUtil.getDistance(aHi,bLo,bHi,bLoCrossHi),S1Angle_1.S1Angle.min(S2EdgeUtil_1.S2EdgeUtil.getDistance(bLo,aLo,aHi,aLoCrossHi),S2EdgeUtil_1.S2EdgeUtil.getDistance(bHi,aLo,aHi,aLoCrossHi))))};S2LatLngRect.prototype.getSize=function(){return new S2LatLng_1.S2LatLng(this.lat.getLength(),this.lng.getLength())};S2LatLngRect.prototype.containsLL=function(ll){return this.lat.contains(ll.latRadians)&&this.lng.contains(ll.lngRadians)};S2LatLngRect.prototype.interiorContainsP=function(p){return this.interiorContainsLL(S2LatLng_1.S2LatLng.fromPoint(p))};S2LatLngRect.prototype.interiorContainsLL=function(ll){return this.lat.interiorContains(ll.latRadians)&&this.lng.interiorContains(ll.lngRadians)};S2LatLngRect.prototype.containsLLR=function(other){return this.lat.containsI(other.lat)&&this.lng.containsI(other.lng)};S2LatLngRect.prototype.interiorContainsLLR=function(other){return this.lat.interiorContainsI(other.lat)&&this.lng.interiorContainsI(other.lng)};S2LatLngRect.prototype.intersectsLLR=function(other){return this.lat.intersects(other.lat)&&this.lng.intersects(other.lng)};S2LatLngRect.prototype.intersects=function(cell){if(this.isEmpty()){return false}if(this.containsP(cell.getCenter())){return true}if(cell.contains(this.getCenter().toPoint())){return true}if(!this.intersectsLLR(cell.getRectBound())){return false}var cellV=new Array(4);var cellLl=new Array(4);for(var i=0;i<4;++i){cellV[i]=cell.getVertex(i);cellLl[i]=S2LatLng_1.S2LatLng.fromPoint(cellV[i]);if(this.containsLL(cellLl[i])){return true}}for(var i=0;i<4;++i){var edgeLng=S1Interval_1.S1Interval.fromPointPair(cellLl[i].lngRadians,cellLl[i+1&3].lngRadians);if(!this.lng.intersects(edgeLng)){continue}var a=cellV[i];var b=cellV[i+1&3];if(edgeLng.contains(this.lng.lo)){if(S2LatLngRect.intersectsLngEdge(a,b,this.lat,this.lng.lo)){return true}}if(edgeLng.contains(this.lng.hi)){if(S2LatLngRect.intersectsLngEdge(a,b,this.lat,this.lng.hi)){return true}}if(S2LatLngRect.intersectsLatEdge(a,b,this.lat.lo,this.lng)){return true}if(S2LatLngRect.intersectsLatEdge(a,b,this.lat.hi,this.lng)){return true}}return false};S2LatLngRect.prototype.interiorIntersects=function(other){return this.lat.interiorIntersects(other.lat)&&this.lng.interiorIntersects(other.lng)};S2LatLngRect.prototype.addPoint=function(p){return this.addPointLL(S2LatLng_1.S2LatLng.fromPoint(p))};S2LatLngRect.prototype.addPointLL=function(ll){var newLat=this.lat.addPoint(ll.latRadians);var newLng=this.lng.addPoint(ll.lngRadians);return new S2LatLngRect(newLat,newLng)};S2LatLngRect.prototype.expanded=function(margin){if(this.isEmpty()){return this}return new S2LatLngRect(this.lat.expanded(margin.latRadians).intersection(S2LatLngRect.fullLat()),this.lng.expanded(margin.lngRadians))};S2LatLngRect.prototype.union=function(other){return new S2LatLngRect(this.lat.union(other.lat),this.lng.union(other.lng))};S2LatLngRect.prototype.intersection=function(other){var intersectLat=this.lat.intersection(other.lat);var intersectLng=this.lng.intersection(other.lng);if(intersectLat.isEmpty()||intersectLng.isEmpty()){return S2LatLngRect.empty()}return new S2LatLngRect(intersectLat,intersectLng)};S2LatLngRect.prototype.area=function(){if(this.isEmpty()){return S2_1.S2.toDecimal(0)}return this.lng.getLength().times(decimal_1.Decimal.sin(this.lat.hi).minus(decimal_1.Decimal.sin(this.lat.lo)).abs())};S2LatLngRect.prototype.equals=function(that){if(!(that instanceof S2LatLngRect)){return false}return this.lat.equals(that.lat)&&this.lng.equals(that.lng)};S2LatLngRect.prototype.approxEquals=function(other,maxError){if(maxError===void 0){maxError=1e-15}return this.lat.approxEquals(other.lat,maxError)&&this.lng.approxEquals(other.lng,maxError)};S2LatLngRect.prototype.clone=function(){return new S2LatLngRect(this.lat,this.lng)};S2LatLngRect.prototype.getCapBound=function(){if(this.isEmpty()){return S2Cap_1.S2Cap.empty()}var poleZ,poleAngle;if(this.lat.lo.plus(this.lat.hi).lt(0)){poleZ=-1;poleAngle=this.lat.hi.plus(S2_1.S2.M_PI_2)}else{poleZ=1;poleAngle=this.lat.lo.neg().plus(S2_1.S2.M_PI_2)}var poleCap=S2Cap_1.S2Cap.fromAxisAngle(new S2Point_1.S2Point(0,0,poleZ),new S1Angle_1.S1Angle(poleAngle));var lngSpan=this.lng.hi.minus(this.lng.lo);if(S2_1.S2.IEEEremainder(lngSpan,2*S2_1.S2.M_PI).gte(0)){if(lngSpan.lt(2*S2_1.S2.M_PI)){var midCap=S2Cap_1.S2Cap.fromAxisAngle(this.getCenter().toPoint(),new S1Angle_1.S1Angle(0));for(var k=0;k<4;++k){midCap=midCap.addPoint(this.getVertex(k).toPoint())}if(midCap.height.lt(poleCap.height)){return midCap}}}return poleCap};S2LatLngRect.prototype.getRectBound=function(){return this};S2LatLngRect.prototype.containsC=function(cell){return this.containsLLR(cell.getRectBound())};S2LatLngRect.prototype.mayIntersectC=function(cell){return this.intersectsLLR(cell.getRectBound())};S2LatLngRect.prototype.containsP=function(p){return this.containsLL(S2LatLng_1.S2LatLng.fromPoint(p))};S2LatLngRect.intersectsLngEdge=function(a,b,lat,lng){return S2_1.S2.simpleCrossing(a,b,new S2LatLng_1.S2LatLng(lat.lo,lng).toPoint(),new S2LatLng_1.S2LatLng(lat.hi,lng).toPoint())};S2LatLngRect.intersectsLatEdge=function(a,b,lat,lng){var z=S2Point_1.S2Point.normalize(S2_1.S2.robustCrossProd(a,b));if(z.z.lt(0)){z=S2Point_1.S2Point.neg(z)}var y=S2Point_1.S2Point.normalize(S2_1.S2.robustCrossProd(z,new S2Point_1.S2Point(0,0,1)));var x=S2Point_1.S2Point.crossProd(y,z);var sinLat=decimal_1.Decimal.sin(lat);if(sinLat.abs().gte(x.z)){return false}var cosTheta=sinLat.dividedBy(x.z);var sinTheta=cosTheta.pow(2).neg().plus(1).sqrt();var theta=decimal_1.Decimal.atan2(sinTheta,cosTheta);var abTheta=S1Interval_1.S1Interval.fromPointPair(decimal_1.Decimal.atan2(a.dotProd(y),a.dotProd(x)),decimal_1.Decimal.atan2(b.dotProd(y),b.dotProd(x)));if(abTheta.contains(theta)){var isect=S2Point_1.S2Point.add(S2Point_1.S2Point.mul(x,cosTheta),S2Point_1.S2Point.mul(y,sinTheta));if(lng.contains(decimal_1.Decimal.atan2(isect.y,isect.x))){return true}}if(abTheta.contains(theta.neg())){var intersection=S2Point_1.S2Point.sub(S2Point_1.S2Point.mul(x,cosTheta),S2Point_1.S2Point.mul(y,sinTheta));if(lng.contains(decimal_1.Decimal.atan2(intersection.y,intersection.x))){return true}}return false};S2LatLngRect.prototype.allVertex=function(){return[this.getVertex(0),this.getVertex(1),this.getVertex(2),this.getVertex(3)]};S2LatLngRect.prototype.toGEOJSON=function(){return{type:"Feature",geometry:{type:"Polygon",coordinates:[this.allVertex().concat(this.getVertex(0)).map(function(v){return[parseFloat(v.lngDegrees.toFixed(5)),parseFloat(v.latDegrees.toFixed(5))]})]},properties:{}}};S2LatLngRect.prototype.toString=function(){return"[Lo="+this.lo().toString()+", Hi="+this.hi().toString()+"]"};return S2LatLngRect}();exports.S2LatLngRect=S2LatLngRect},{"./R1Interval":5,"./S1Angle":7,"./S1Interval":8,"./S2":9,"./S2Cap":10,"./S2EdgeUtil":14,"./S2LatLng":15,"./S2Point":18,"./decimal":21}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var S2_1=require("./S2");var S2Metric=function(){function S2Metric(_dim,_deriv){this._dim=S2_1.S2.toDecimal(_dim).toNumber();this._deriv=S2_1.S2.toDecimal(_deriv)}S2Metric.prototype.deriv=function(){return this._deriv};S2Metric.prototype.dim=function(){return this._dim};S2Metric.prototype.getValue=function(level){var scaleFactor=this.dim()*(1-level);return this.deriv().times(Math.pow(2,scaleFactor)).toNumber()};S2Metric.prototype.getClosestLevel=function(value){return this.getMinLevel(S2_1.S2.M_SQRT2*value)};S2Metric.prototype.getMinLevel=function(value){if(value<=0){return S2_1.S2.MAX_LEVEL}var exponent=S2_1.S2.exp(value/((1<<this.dim())*this.deriv().toNumber()));var level=Math.max(0,Math.min(S2_1.S2.MAX_LEVEL,-(exponent-1>>this.dim()-1)));return level};S2Metric.prototype.getMaxLevel=function(_value){var value=S2_1.S2.toDecimal(_value).toNumber();if(value<=0){return S2_1.S2.MAX_LEVEL}var exponent=S2_1.S2.exp((1<<this.dim())*this.deriv().toNumber()/value);var level=Math.max(0,Math.min(S2_1.S2.MAX_LEVEL,exponent-1>>this.dim()-1));return level};return S2Metric}();exports.S2Metric=S2Metric},{"./S2":9}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var R2Vector_1=require("./R2Vector");var Decimal=require("decimal.js");var S2_1=require("./S2");var S2Point=function(){function S2Point(x,y,z){this.x=new Decimal(x);this.y=new Decimal(y);this.z=new Decimal(z)}S2Point.minus=function(p1,p2){return S2Point.sub(p1,p2)};S2Point.neg=function(p){return new S2Point(p.x.negated(),p.y.negated(),p.z.negated())};S2Point.prototype.norm2=function(){return this.x.pow(2).plus(this.y.pow(2)).plus(this.z.pow(2))};S2Point.prototype.norm=function(){return this.norm2().sqrt()};S2Point.crossProd=function(p1,p2){return new S2Point(p1.y.times(p2.z).minus(p1.z.times(p2.y)),p1.z.times(p2.x).minus(p1.x.times(p2.z)),p1.x.times(p2.y).minus(p1.y.times(p2.x)))};S2Point.add=function(p1,p2){return new S2Point(p1.x.add(p2.x),p1.y.add(p2.y),p1.z.add(p2.z))};S2Point.sub=function(p1,p2){return new S2Point(p1.x.sub(p2.x),p1.y.sub(p2.y),p1.z.sub(p2.z))};S2Point.prototype.dotProd=function(that){return this.x.times(that.x).plus(this.y.times(that.y)).plus(this.z.times(that.z))};S2Point.mul=function(p,m){var mD=new Decimal(m);return new S2Point(mD.times(p.x),mD.times(p.y),mD.times(p.z))};S2Point.div=function(p,m){return new S2Point(p.x.div(m),p.y.div(m),p.z.div(m))};S2Point.prototype.ortho=function(){var k=this.largestAbsComponent();var temp;if(k==1){temp=new S2Point(1,0,0)}else if(k==2){temp=new S2Point(0,1,0)}else{temp=new S2Point(0,0,1)}return S2Point.normalize(S2Point.crossProd(this,temp))};S2Point.prototype.largestAbsComponent=function(){var temp=S2Point.fabs(this);if(temp.x.greaterThan(temp.y)){if(temp.x.greaterThan(temp.z)){return 0}else{return 2}}else{if(temp.y.greaterThan(temp.z)){return 1}else{return 2}}};S2Point.fabs=function(p){return new S2Point(p.x.abs(),p.y.abs(),p.z.abs())};S2Point.normalize=function(p){var norm=p.norm();if(!norm.eq(0)){norm=S2_1.S2.toDecimal(1).dividedBy(norm)}return S2Point.mul(p,norm)};S2Point.prototype.axis=function(axis){return axis==0?this.x:axis==1?this.y:this.z};S2Point.prototype.angle=function(va){return Decimal.atan2(S2Point.crossProd(this,va).norm(),this.dotProd(va))};S2Point.prototype.aequal=function(that,margin){return this.x.minus(that.x).abs().lessThan(margin)&&this.y.minus(that.y).abs().lessThan(margin)&&this.z.minus(that.z).abs().lessThan(margin)};S2Point.prototype.equals=function(that){if(!(that instanceof S2Point)){return false}return this.x.eq(that.x)&&this.y.eq(that.y)&&this.z.eq(that.z)};S2Point.prototype.lessThan=function(vb){if(this.x.lt(vb.x)){return true}if(vb.x.lt(this.x)){return false}if(this.y.lt(vb.y)){return true}if(vb.y.lt(this.y)){return false}if(this.z.lt(vb.z)){return true}return false};S2Point.prototype.compareTo=function(other){return this.lessThan(other)?-1:this.equals(other)?0:1};S2Point.prototype.toFace=function(){var face=this.largestAbsComponent();if(this.axis(face).lt(0)){face+=3}return face};S2Point.prototype.toR2Vector=function(face){if(face===void 0){face=this.toFace()}var u;var v;switch(face){case 0:u=this.y.div(this.x);v=this.z.div(this.x);break;case 1:u=this.x.neg().div(this.y);v=this.z.div(this.y);break;case 2:u=this.x.neg().div(this.z);v=this.y.neg().div(this.z);break;case 3:u=this.z.div(this.x);v=this.y.div(this.x);break;case 4:u=this.z.div(this.y);v=this.x.neg().div(this.y);break;case 5:u=this.y.neg().div(this.z);v=this.x.neg().div(this.z);break;default:throw new Error("Invalid face")}return new R2Vector_1.R2Vector(u,v)};S2Point.prototype.toString=function(){return"Point("+this.x.toNumber()+", "+this.y.toNumber()+", "+this.z.toNumber()+")"};return S2Point}();exports.S2Point=S2Point},{"./R2Vector":6,"./S2":9,"decimal.js":1}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var S2_1=require("./S2");var S2Point_1=require("./S2Point");var R2Vector_1=require("./R2Vector");var Projections;(function(Projections){Projections[Projections["S2_LINEAR_PROJECTION"]=0]="S2_LINEAR_PROJECTION";Projections[Projections["S2_TAN_PROJECTION"]=1]="S2_TAN_PROJECTION";Projections[Projections["S2_QUADRATIC_PROJECTION"]=2]="S2_QUADRATIC_PROJECTION"})(Projections=exports.Projections||(exports.Projections={}));var S2Projections=function(){function S2Projections(){}S2Projections.getUNorm=function(face,u){switch(face){case 0:return new S2Point_1.S2Point(u,-1,0);case 1:return new S2Point_1.S2Point(1,u,0);case 2:return new S2Point_1.S2Point(1,0,u);case 3:return new S2Point_1.S2Point(-u,0,1);case 4:return new S2Point_1.S2Point(0,-u,1);default:return new S2Point_1.S2Point(0,-1,-u)}};S2Projections.getVNorm=function(face,v){switch(face){case 0:return new S2Point_1.S2Point(-v,0,1);case 1:return new S2Point_1.S2Point(0,-v,1);case 2:return new S2Point_1.S2Point(0,-1,-v);case 3:return new S2Point_1.S2Point(v,-1,0);case 4:return new S2Point_1.S2Point(1,v,0);default:return new S2Point_1.S2Point(1,0,v)}};S2Projections.getUAxis=function(face){switch(face){case 0:return new S2Point_1.S2Point(0,1,0);case 1:return new S2Point_1.S2Point(-1,0,0);case 2:return new S2Point_1.S2Point(-1,0,0);case 3:return new S2Point_1.S2Point(0,0,-1);case 4:return new S2Point_1.S2Point(0,0,-1);default:return new S2Point_1.S2Point(0,1,0)}};S2Projections.getVAxis=function(face){switch(face){case 0:return new S2Point_1.S2Point(0,0,1);case 1:return new S2Point_1.S2Point(0,0,1);case 2:return new S2Point_1.S2Point(0,-1,0);case 3:return new S2Point_1.S2Point(0,-1,0);case 4:return new S2Point_1.S2Point(1,0,0);default:return new S2Point_1.S2Point(1,0,0)}};S2Projections.faceUvToXyz=function(face,u,v){return new R2Vector_1.R2Vector(u,v).toPoint(face)};S2Projections.MIN_WIDTH=new S2_1.S2Metric(1,S2_1.S2.M_SQRT2/3);S2Projections.AVG_AREA=new S2_1.S2Metric(2,S2_1.S2.M_PI/6);return S2Projections}();exports.S2Projections=S2Projections},{"./R2Vector":6,"./S2":9,"./S2Point":18}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var S2Cell_1=require("./S2Cell");var S2CellId_1=require("./S2CellId");var S2CellUnion_1=require("./S2CellUnion");var S2Projections_1=require("./S2Projections");var decimal_1=require("./decimal");var S2RegionCoverer=function(){function S2RegionCoverer(){this.minLevel=0;this.maxLevel=S2CellId_1.S2CellId.MAX_LEVEL;this.levelMod=1;this.maxCells=S2RegionCoverer.DEFAULT_MAX_CELLS;this.region=null;this.result=[];this.candidateQueue=new PriorityQueue}S2RegionCoverer.prototype.setMinLevel=function(minLevel){this.minLevel=Math.max(0,Math.min(S2CellId_1.S2CellId.MAX_LEVEL,minLevel));return this};S2RegionCoverer.prototype.setMaxLevel=function(maxLevel){this.maxLevel=Math.max(0,Math.min(S2CellId_1.S2CellId.MAX_LEVEL,maxLevel));return this};S2RegionCoverer.prototype.setLevelMod=function(levelMod){this.levelMod=Math.max(1,Math.min(3,levelMod));return this};S2RegionCoverer.prototype.setMaxCells=function(maxCells){this.maxCells=maxCells;return this};S2RegionCoverer.prototype.getCoveringCells=function(region){var tmp=this.getCoveringUnion(region);return tmp.denormalize(this.minLevel,this.levelMod)};S2RegionCoverer.prototype.getInteriorCoveringCells=function(region){var tmp=this.getInteriorCoveringUnion(region);return tmp.denormalize(this.minLevel,this.levelMod)};S2RegionCoverer.prototype.getCoveringUnion=function(region,covering){if(covering===void 0){covering=new S2CellUnion_1.S2CellUnion}this.interiorCovering=false;this.getCoveringInternal(region);covering.initSwap(this.result);return covering};S2RegionCoverer.prototype.getInteriorCoveringUnion=function(region,covering){if(covering===void 0){covering=new S2CellUnion_1.S2CellUnion}this.interiorCovering=true;this.getCoveringInternal(region);covering.initSwap(this.result);return covering};S2RegionCoverer.prototype.newCandidate=function(cell){if(!this.region.mayIntersectC(cell)){return null}var isTerminal=false;if(cell.level>=this.minLevel){if(this.interiorCovering){if(this.region.containsC(cell)){isTerminal=true}else if(cell.level+this.levelMod>this.maxLevel){return null}}else{if(cell.level+this.levelMod>this.maxLevel||this.region.containsC(cell)){isTerminal=true}}}var candidate=new Candidate;candidate.cell=cell;candidate.isTerminal=isTerminal;candidate.numChildren=0;if(!isTerminal){candidate.children=Array.apply(null,new Array(1<<this.maxChildrenShift()))}this.candidatesCreatedCounter++;return candidate};S2RegionCoverer.prototype.maxChildrenShift=function(){return 2*this.levelMod};S2RegionCoverer.prototype.addCandidate=function(candidate){if(candidate==null){return}if(candidate.isTerminal){this.result.push(candidate.cell.id);return}var numLevels=candidate.cell.level<this.minLevel?1:this.levelMod;var numTerminals=this.expandChildren(candidate,candidate.cell,numLevels);if(candidate.numChildren==0){}else if(!this.interiorCovering&&numTerminals==1<<this.maxChildrenShift()&&candidate.cell.level>=this.minLevel){candidate.isTerminal=true;this.addCandidate(candidate)}else{var priority=-(((candidate.cell.level<<this.maxChildrenShift())+candidate.numChildren<<this.maxChildrenShift())+numTerminals);this.candidateQueue.add(new QueueEntry(priority,candidate))}};S2RegionCoverer.prototype.expandChildren=function(candidate,cell,numLevels){numLevels--;var childCells=cell.subdivide();var numTerminals=0;for(var i=0;i<4;++i){if(numLevels>0){if(this.region.mayIntersectC(childCells[i])){numTerminals+=this.expandChildren(candidate,childCells[i],numLevels)}continue}var child=this.newCandidate(childCells[i]);if(child!=null){candidate.children[candidate.numChildren++]=child;if(child.isTerminal){++numTerminals}}}return numTerminals};S2RegionCoverer.prototype.getInitialCandidates=function(){if(this.maxCells>=4){var cap=this.region.getCapBound();var level=decimal_1.Decimal.min(S2Projections_1.S2Projections.MIN_WIDTH.getMaxLevel(cap.angle().radians.times(2)),decimal_1.Decimal.min(this.maxLevel,S2CellId_1.S2CellId.MAX_LEVEL-1)).toNumber();if(this.levelMod>1&&level>this.minLevel){level-=(level-this.minLevel)%this.levelMod}if(level>0){var id=S2CellId_1.S2CellId.fromPoint(cap.axis);var base=id.getVertexNeighbors(level);for(var i=0;i<base.length;++i){this.addCandidate(this.newCandidate(new S2Cell_1.S2Cell(base[i])))}return}}for(var face=0;face<6;++face){this.addCandidate(this.newCandidate(S2RegionCoverer.FACE_CELLS[face]))}};S2RegionCoverer.prototype.getCoveringInternal=function(region){if(!(this.candidateQueue.size()==0&&this.result.length==0)){throw new Error("preconditions are not satisfied")}this.region=region;this.candidatesCreatedCounter=0;this.getInitialCandidates();while(this.candidateQueue.size()!==0&&(!this.interiorCovering||this.result.length<this.maxCells)){var candidate=this.candidateQueue.poll().candidate;if(candidate.cell.level<this.minLevel||candidate.numChildren==1||this.result.length+(this.interiorCovering?0:this.candidateQueue.size())+candidate.numChildren<=this.maxCells){for(var i=0;i<candidate.numChildren;++i){this.addCandidate(candidate.children[i])}}else if(this.interiorCovering){}else{candidate.isTerminal=true;this.addCandidate(candidate)}}this.candidateQueue.clear();this.region=null};S2RegionCoverer.DEFAULT_MAX_CELLS=8;S2RegionCoverer.FACE_CELLS=[0,1,2,3,4,5].map(function(face){return S2Cell_1.S2Cell.fromFacePosLevel(face,0,0)});return S2RegionCoverer}();exports.S2RegionCoverer=S2RegionCoverer;var Candidate=function(){function Candidate(){}Candidate.prototype.toString=function(){return"isTermina: "+this.isTerminal+" - Cell: "+this.cell.toString()};return Candidate}();var PriorityQueue=function(){function PriorityQueue(){this.clear()}PriorityQueue.prototype.add=function(item){this.items.push(item);this.items.sort(function(a,b){return a.compare(b)})};PriorityQueue.prototype.clear=function(){this.items=[]};PriorityQueue.prototype.size=function(){return this.items.length};PriorityQueue.prototype.poll=function(){return this.items.splice(0,1)[0]};return PriorityQueue}();var QueueEntry=function(){function QueueEntry(id,candidate){this.id=id;this.candidate=candidate}QueueEntry.prototype.compare=function(other){return this.id<other.id?1:this.id>other.id?-1:0};return QueueEntry}()},{"./S2Cell":11,"./S2CellId":12,"./S2CellUnion":13,"./S2Projections":19,"./decimal":21}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});require("./decimal_augmentation");exports.Decimal=require("decimal.js")},{"./decimal_augmentation":22,"decimal.js":1}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})},{}],23:[function(require,module,exports){"use strict";function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p]}Object.defineProperty(exports,"__esModule",{value:true});var S2Cap_1=require("./S2Cap");__export(require("./Interval"));__export(require("./MutableInteger"));__export(require("./R1Interval"));__export(require("./R2Vector"));__export(require("./S1Angle"));__export(require("./S1Interval"));__export(require("./S2"));__export(require("./S2Cap"));__export(require("./S2Cell"));__export(require("./S2CellId"));__export(require("./S2CellUnion"));__export(require("./S2LatLng"));__export(require("./S2LatLngRect"));__export(require("./S2Point"));__export(require("./S2Projections"));__export(require("./S2RegionCoverer"));var Utils=function(){function Utils(){}Utils.calcRegionFromCenterRadius=function(center,radiusInKM,points){if(points===void 0){points=16}var pointsAtDistance=center.pointsAtDistance(radiusInKM,points);var s2Cap=S2Cap_1.S2Cap.empty().addPoint(center.toPoint());pointsAtDistance.map(function(p){return p.toPoint()}).forEach(function(p){s2Cap=s2Cap.addPoint(p)});return s2Cap};return Utils}();exports.Utils=Utils},{"./Interval":3,"./MutableInteger":4,"./R1Interval":5,"./R2Vector":6,"./S1Angle":7,"./S1Interval":8,"./S2":9,"./S2Cap":10,"./S2Cell":11,"./S2CellId":12,"./S2CellUnion":13,"./S2LatLng":15,"./S2LatLngRect":16,"./S2Point":18,"./S2Projections":19,"./S2RegionCoverer":20}]},{},[23])(23)});
