!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){"use strict";var o=n(1),r={get:function(e){var t=r.settings[e],n=localStorage.getItem(e);if(void 0===t.getURLValue&&(t.getURLValue=function(){return o.urlParameter(e)}),t.getURLValue&&0!=t.getURLValue){var a=t.getURLValue();a&&(n=a)}return void 0===n||null===n?t.defaultValue:"boolean"==t.type?"true"==n:"float"==t.type?parseFloat(n):"json"==t.type?JSON.parse(n):n},set:function(e,t){if(r.get("acceptCookies")){var n=r.settings[e];n.getURLValue=!1,"json"==n.type?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,t)}},settings:{acceptCookies:{type:"boolean",defaultValue:!1},showGyms:{type:"boolean",defaultValue:!0},showPokestops:{type:"boolean",defaultValue:!1},showPortals:{type:"boolean",defaultValue:!1},showParks:{type:"boolean",defaultValue:!1},highlightNewFeatures:{type:"boolean",defaultValue:!1},exGymsOnly:{type:"boolean",defaultValue:!1},s2Cells:{type:"json",defaultValue:[]},s2CellColors:{type:"json",defaultValue:{1:"#FF6F00",2:"#F57F17",3:"#827717",4:"#33691E",5:"#1B5E20",6:"#004D40",7:"#006064",8:"#01579B",9:"#0D47A1",10:"#1A237E",11:"#6A1B9A",12:"#AD1457",13:"#b71c1c",14:"#BF360C",15:"#FF7043",16:"#FFCA28",17:"#FDD835",18:"#00796B",19:"#0288D1",20:"#64B5F6"}},mapCenter:{type:"json",defaultValue:{lat:52.63282,lng:1.29732}},zoomLevel:{type:"float",defaultValue:13},discordToken:{type:"json",defaultValue:{}},user:{type:"json",defaultValue:{}}}};e.exports=r},function(e,t,n){"use strict";var o=location.protocol+"//"+location.host+location.pathname;e.exports={urlParameter:function(e){var t=decodeURIComponent(window.location.search.substring(1)).split("&"),n=void 0;return $.each(t,function(t,o){var r=o.split("="),a=r[0],i=r[1];if(a==e&&void 0!==i)return n=i,!1}),n},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},coordinateToLatLng:function(e){return new google.maps.LatLng(e[0],e[1])},dateToString:function(e){function t(e){return e<10?"0"+e:e}return t(e.getFullYear())+"-"+t(e.getMonth())+"-"+t(e.getDate())},isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)},coordsFromString:function(e){if(e){var t=e.split(",");if(t&&2===t.length){var n=$.map(t,function(e){return parseFloat(e)});if((0==n[0]||n[0])&&(0==n[1]||n[1]))return n}}},BASE_URL:o,NESTING_SPECIES:[1,4,7,10,13,16,19,21,23,25,27,29,32,35,37,39,41,43,46,48,50,52,54,56,58,60,63,66,69,72,74,77,79,81,84,86,90,92,95,96,98,100,102,104,111,116,118,120,123,124,125,126,127,129,133,138,140,152,155,158,161,163,165,167,170,177,183,187,190,191,193,194,200,202,203,206,209,211,213,215,216,218,220,223,228,252,255,258,261,263,265,273,276,278,283,285,293,296,299,300,304,307,309,316,318,320,322,325,333,339,341,343,353,355,363,370]}},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(t,n,o){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.marker=t,Array.isArray(n)?this.clickTargets=n:this.clickTargets=[n],this.label=new google.maps.InfoWindow(o),this.isOpen=!1,$.each(this.clickTargets,function(e,t){t.addListener("click",function(){r.toggle(t.map)})}),this.label.addListener("closeclick",function(){r.close()})}return o(e,[{key:"open",value:function(e){this.label.setPosition(this.marker.location),this.label.open(e),this.isOpen=!0}},{key:"close",value:function(){this.label.close(),this.isOpen=!1}},{key:"toggle",value:function(e){this.isOpen?this.close():this.open(e)}}]),e}();e.exports=r},,function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(1),a=n(2),i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.id=t.id,this.name=t.name,this.region=$.map(t.coords,function(e){return r.coordinateToLatLng(e)}),this.center=r.coordinateToLatLng([t.latitude,t.longitude]),this.location=this.center}return o(e,[{key:"draw",value:function(e,t){t&&this.hide(),this.polygon&&!t||(this.polygon=this._createPolygon(),this.showMarker&&(this.marker=this._createMarker()),this.showLabel&&(this.label=this._createLabel()))}},{key:"show",value:function(e,t){(r.isFunction(t)||t)&&this.draw(e,!0),this.isShown()||(this.draw(e),this.polygon.setMap(e),this.marker&&this.marker.setMap(e))}},{key:"hide",value:function(){this.polygon&&this.polygon.setMap(null),this.marker&&this.marker.setMap(null)}},{key:"isShown",value:function(){return this.polygon&&this.polygon.map}},{key:"_createPolygon",value:function(){return new google.maps.Polygon({paths:this.region,fillColor:"blue",fillOpacity:.5,strokeColor:"blue",strokeOpacity:1,strokeWeight:0})}},{key:"_createMarker",value:function(){return new google.maps.Marker({position:this.location,zIndex:this.isNew?30:20})}},{key:"_createLabel",value:function(){var e='\n      <div class="polygon-label">\n        <div class="polygon-label-name">\n          <b>'+this.name+"</b>\n        </div>\n      </div>";return new a(this,this.polygon,{content:e})}},{key:"showMarker",get:function(){return!1}},{key:"showLabel",get:function(){return!0}}]),e}();e.exports=i},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t||{},this.map=t.map,this.lookup=t.lookup,this.matchFilter=t.matchFilter,this.size=t.size||4,this.searchBox=this._createInput(),this.dropdown=this._createDropdown(),this._attachInputListener(),this.options.placeholder&&this.setPlaceholder(this.options.placeholder),this.options.startDisabled&&this.disable()}return o(e,[{key:"enable",value:function(){this.searchBox.prop("disabled",!1)}},{key:"disable",value:function(){this.searchBox.prop("disabled",!0)}},{key:"setPlaceholder",value:function(e){this.searchBox.attr("placeholder",e)}},{key:"clear",value:function(){this.dropdown.empty()}},{key:"add",value:function(e){var t=this,n=document.createElement("div");if(n.setAttribute("class","pac-item"),e.icon){var o=document.createElement("span");o.setAttribute("class","pac-icon pac-icon-"+e.icon),n.appendChild(o)}var r=document.createElement("span");if(r.setAttribute("class","pac-item-query"),r.innerHTML=e.name,n.appendChild(r),e.description){var a=document.createElement("span");a.innerHTML=e.description,n.appendChild(a)}this.dropdown[0].appendChild(n),$(n).click(function(){t.map.panTo(e.location),e.label&&e.label.open&&e.label.open(t.map)})}},{key:"_createInput",value:function(){var e=$(document.createElement("input"));return e.attr("id","pac-input"),e.attr("class","controls"),e.attr("type","text"),e}},{key:"_createDropdown",value:function(){var e=$(document.createElement("div"));return e.attr("class","pac-container  pac-logo"),e.appendTo("body"),e}},{key:"_attachInputListener",value:function(){var e=this;this.searchBox.on("input",function(t){if(e.clear(),e.lookup){var n=e.lookup(t.currentTarget.value);e.matchFilter&&(n=n.filter(e.matchFilter)),$.each(n.slice(0,e.size),function(t,n){e.add(n)}),e.dropdown.show()}})}},{key:"input",get:function(){return this.searchBox[0]}}]),e}();e.exports=r},,function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(1),a=n(4),i=n(2),s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.cssId=n.id.toLowerCase().replace(/\//g,"-"),n.pokemon=e.pokemon,n.permalinkName=n.name.replace(/[^\w]/g,"").toLowerCase(),n.dateAdded=e.dateAdded,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),o(t,[{key:"shouldShow",value:function(){return!0}},{key:"_createPolygon",value:function(){return new google.maps.Polygon({paths:this.region,fillColor:"green",fillOpacity:.5,strokeColor:"green",strokeOpacity:1,strokeWeight:0})}},{key:"_createMarker",value:function(){var e={};if(this.pokemon&&this.pokemon.sprite){var t=this.pokemon.sprite,n={x:34/t.width,y:34/t.height};e={url:"https://cdn.rawgit.com/pogo-excalibur/images/956c44dd/pokemon_sprites.png",origin:new google.maps.Point(t.x*n.x,t.y*n.y),size:new google.maps.Size(t.width*n.x,t.height*n.y),scaledSize:new google.maps.Size(t.sheetWidth*n.x,t.sheetHeight*n.y),anchor:new google.maps.Point(t.width/2*n.x,t.height/2*n.y)}}return new google.maps.Marker({position:this.location,icon:e,zIndex:20})}},{key:"pokemonNameStr",value:function(){return this.pokemon?this.pokemon.name+" (#"+this.pokemon.id+")":"?"}},{key:"_createLabel",value:function(){var e=r.BASE_URL+"?nest="+this.permalinkName,t='\n      <div id="nest-label-'+this.cssId+'" class="nest-label">\n        <div class="name">\n          '+this.name.trim()+'\n          <a href="'+e+'"><span class="fas fa-link"></span></a>\n        </div>\n        <div class="pokemon">\n          Species: '+this.pokemonNameStr()+'\n        </div>\n        <div class="options">\n          <a href="#" class="report">Add a Report</a>\n        </div>\n      </div>',n=[this.polygon];return this.marker&&n.push(this.marker),new i(this,n,{content:t})}},{key:"showMarker",get:function(){return this.pokemon&&this.pokemon.id}}]),t}();e.exports=s},function(e,t,n){"use strict";var o=n(0),r=n(1),a=n(5),i=n(7);window.initMap=function(){var e=r.urlParameter("ll"),t=r.coordsFromString(e);t&&o.set("mapCenter",{lat:t[0],lng:t[1]});var n=new google.maps.Map(document.getElementById("map"),{center:o.get("mapCenter"),zoom:o.get("zoomLevel"),gestureHandling:"greedy",fullscreenControl:!1,streetViewControl:!0,mapTypeControl:!0,clickableIcons:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID]}});return Promise.resolve().then(function(){return function(e){e.searchBox=new a({map:e,size:4,placeholder:"Search Nests",startDisabled:!0}),e.controls[google.maps.ControlPosition.TOP_LEFT].push(e.searchBox.input),$(document).click(function(){e.searchBox.dropdown.hide()}),e.searchBox.searchBox.click(function(e){e.stopPropagation()})}(n)}).then(function(){return function(e){return Promise.resolve($.getJSON("/data/pokemon.json")).then(function(t){return e.pokemonData=t,$.each(e.pokemonData,function(e,t){t.id=e}),Promise.resolve($.getJSON("https://cdn.rawgit.com/pogo-excalibur/images/d4b555aa/pokemon_sprites.json"))}).then(function(t){return $.each(e.pokemonData,function(e,n){n.sprite=t.sprites.find(function(e){return e.name==n.id}),n.sprite&&(n.sprite.sheetWidth=t.width,n.sprite.sheetHeight=t.height)}),e.pokemonData})}(n)}).then(function(){return function(e){e.nestReportOverlay=$(".nest-report-overlay"),e.nestReportOverlay.click(function(){e.updateSelectedNest=null,e.nestReportOverlay.hide()}),$(".nest-report-popup .close-icon").click(function(){e.updateSelectedNest=null,e.nestReportOverlay.hide()}),$(".nest-report-popup .heading").html("Select a Pokémon:");var t=$(".nest-report-popup .selection"),n=function(n){var o=void 0;if(n.id&&n.id>0){var r=(""+n.id).padStart(3,"0");o=$('\n        <div class="pokemon">\n          <div class="icon pokemon-sprite-'+n.id+'"></div>\n          <span class="id">'+r+'</span>\n          <span class="name">'+n.name+"</span>\n        </div>\n        ")}else o=$('\n        <div class="pokemon">\n          <div class="icon clear"></div>\n          <span class="clear-label">'+n.name+"</span>\n        </div>\n        ");o.appendTo(t),o.click(function(){e.nestReportOverlay.hide(),e.updateSelectedNest&&e.updateSelectedNest(n)})};n({id:0,name:"Clear"}),$.each(r.NESTING_SPECIES,function(t,o){var r=e.pokemonData[o];n(r)})}(n)}).then(function(){return function(e){return e.showNests=function(t){$.each(e.nests,function(n,o){o.shouldShow()?o.show(e,t):o.hide()})},e.getNestById=function(t){if(e.nests&&!(!e.nests.length>0))return e.nests.find(function(e){return e.id==t})},function(){var e=$.ajax({type:"GET",url:"https://api.pokemongonorwich.uk/nests?action=get",dataType:"json"});return Promise.resolve(e)}().then(function(t){e.nests=$.map(t,function(e){return new i(e)}),$.each(e.pokemonData,function(e,t){t.id=e}),$.each(e.nests,function(t,n){n.pokemon&&(n.pokemon=e.pokemonData[n.pokemon])}),e.showNests(),e.nests.nameLookup=new Fuse(e.nests,{shouldSort:!0,threshold:.5,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:["name"]}),e.searchBox.lookup=function(t){return e.nests.nameLookup.search(t)},e.addListener("click",function(){$.each(e.nests,function(e,t){t.label&&t.label.close()})}),$("body").on("click",".nest-label .report",function(t){var n=$(t.target).parents(".nest-label");if(n){var o=n.attr("id").replace(/^nest-label-/,"").replace(/-/,"/");if(o){var r=e.getNestById(o);r&&setTimeout(function(){e.updateSelectedNest=function(t){!function(e,t,n){t.label.close(),t.hide();var o=$.ajax({type:"GET",url:"https://api.pokemongonorwich.uk/nests?action=update&id="+t.id+"&pokemonId="+n.id,dataType:"json"});Promise.resolve(o).then(function(o){if(!o)throw t.show(),new Error("Could not update this nest");if(o.error)throw t.show(),new Error("Could not update this nest: "+o.error);0==n.id?(t.pokemon=null,t.marker=null):t.pokemon=n,t.show(e,!0)})}(e,r,t),e.updateSelectedNest=null},e.nestReportOverlay.show()})}}});var n=r.urlParameter("nest");if(n){var o=e.nests.find(function(e){return e.permalinkName==n});o&&(e.panTo(o.center),e.setZoom(17))}e.searchBox.enable()})}(n)}).then(function(){return function(e){google.maps.event.addListener(e,"idle",function(){o.set("mapCenter",{lat:e.getCenter().lat(),lng:e.getCenter().lng()}),o.set("zoomLevel",e.getZoom())})}(n)})}}]);
//# sourceMappingURL=nests.min.js.map