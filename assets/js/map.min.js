!function(e){var t={};function o(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}([function(e,t,o){"use strict";e.exports={urlParameter:function(e){var t=decodeURIComponent(window.location.search.substring(1)).split("&"),o=void 0;return $.each(t,function(t,n){var a=n.split("="),s=a[0],l=a[1];if(s==e&&void 0!==l)return o=l,!1}),o},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},coordinateToLatLng:function(e){return new google.maps.LatLng(e[0],e[1])},dateToString:function(e){function t(e){return e<10?"0"+e:e}return t(e.getFullYear())+"-"+t(e.getMonth())+"-"+t(e.getDate())}}},function(e,t,o){"use strict";var n=o(0),a={get:function(e){var t=a.settings[e],o=localStorage.getItem(e);if(void 0===t.getURLValue&&(t.getURLValue=function(){return n.urlParameter(e)}),t.getURLValue&&0!=t.getURLValue){var s=t.getURLValue();s&&(o=s)}return void 0===o||null===o?t.defaultValue:"boolean"==t.type?"true"==o:"float"==t.type?parseFloat(o):"json"==t.type?JSON.parse(o):o},set:function(e,t){var o=a.settings[e];o.getURLValue=!1,"json"==o.type?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,t)},settings:{showGyms:{type:"boolean",defaultValue:!0},showPokestops:{type:"boolean",defaultValue:!1},showPortals:{type:"boolean",defaultValue:!1},showParks:{type:"boolean",defaultValue:!1},highlightNewFeatures:{type:"boolean",defaultValue:!1},s2Cells:{type:"json",defaultValue:[]},s2CellColors:{type:"json",defaultValue:{1:"#FF6F00",2:"#F57F17",3:"#827717",4:"#33691E",5:"#1B5E20",6:"#004D40",7:"#006064",8:"#01579B",9:"#0D47A1",10:"#1A237E",11:"#6A1B9A",12:"#AD1457",13:"#b71c1c",14:"#BF360C",15:"#FF7043",16:"#FFCA28",17:"#FDD835",18:"#00796B",19:"#0288D1",20:"#64B5F6"}},mapCenter:{type:"json",defaultValue:{lat:52.63282,lng:1.29732}},zoomLevel:{type:"float",defaultValue:13}}};e.exports=a},,function(e,t,o){"use strict";var n=o(1),a=o(0);function s(e,t){var o=$.ajax({type:"GET",url:"https://api.pokemongonorwich.uk/pois?action=get&count="+e+"&start="+t,dataType:"json"});return Promise.resolve(o)}function l(e){var t=location.protocol+"//"+location.host+location.pathname,o=new Date(1990,0,1);$.each(e,function(e,t){t.dateAdded&&(t.dateAdded=new Date(t.dateAdded),t.dateAdded>o&&(o=t.dateAdded))});var s=[];return $.each(e,function(e,l){l.type&&l.latitude&&l.longitude&&(l.type=l.type.toLowerCase(),l.coords=[l.latitude,l.longitude],l.location=a.coordinateToLatLng(l.coords),l.permalinkName=l.id,l.permalink=t+"?"+l.type+"="+l.id,l.dateAdded&&l.dateAdded.getTime()>=o.getTime()&&(l.isNew=!0),l.hide=function(){l.marker&&l.marker.setMap(null)},l.show=function(e,t){this.shouldShow()?(t&&t(l)&&this.draw(e,!0),this.isShown()||(this.draw(e),this.marker.setMap(e))):this.hide()},l.shouldShow=function(){if("gym"==l.type&&n.get("showGyms")||"pokestop"==l.type&&n.get("showPokestops")||"portal"==l.type&&n.get("showPortals"))return!0},l.isShown=function(){return l.marker&&l.marker.map},l.draw=function(e,t){t?(this.hide(),r(e,l)):l.marker||r(e,l)},s.push(l))}),s}function r(e,t){var o={gym:"/assets/images/gym.png",new_gym:"/assets/images/gym.png",pokestop:"/assets/images/pokestop.png",new_pokestop:"/assets/images/new_pokestop.png",portal:"/assets/images/portal.png",new_portal:"/assets/images/new_portal.png"},a=void 0;a=n.get("highlightNewFeatures")&&t.isNew?o["new_"+t.type]:o[t.type];var s="gym"==t.type?22:15,l=void 0;l=o[t.type]?new google.maps.Marker({position:t.location,icon:{url:a,scaledSize:new google.maps.Size(30,30),anchor:new google.maps.Point(s,30)},zIndex:20}):new google.maps.Marker({position:t.location,zIndex:20}),t.marker=l;var r=void 0;"gym"==t.type?r=function(e){var t=e.name||"Gym",o=""+(e.description||""),n='\n    <div class="feature-label">\n      <div class="feature-label-name">\n        <b>'+t+'</b>\n      </div>\n      <div class="feature-label-description">\n        '+o.replace(/\\n/gi,"<br />")+"\n      </div>\n    </div>";return new google.maps.InfoWindow({content:n,pixelOffset:new google.maps.Size(-7,-30)})}(t):"pokestop"==t.type?r=function(e){var t=e.name||"Pokestop",o=e.description||"",n='\n    <div class="feature-label">\n      <div class="feature-label-name">\n        <b>'+t+'</b>\n      </div>\n      <div class="feature-label-description">\n        '+o.replace(/\\n/gi,"<br />")+"\n      </div>\n    </div>";return new google.maps.InfoWindow({content:n,pixelOffset:new google.maps.Size(0,-30)})}(t):"portal"==t.type&&(r=function(e){var t=e.name||"Portal",o=e.description||"",n='\n    <div class="feature-label">\n      <div class="feature-label-name">\n        <b>'+t+'</b>\n      </div>\n      <div class="feature-label-description">\n        '+o.replace(/\\n/gi,"<br />")+"\n      </div>\n    </div>";return new google.maps.InfoWindow({content:n,pixelOffset:new google.maps.Size(0,-30)})}(t)),r&&(t.label=r,function(e,t){t.label.isOpen=!1,t.label._open=t.label.open,t.label._close=t.label.close,t.label.open=function(e){t.label.setPosition(t.location),t.label._open(e),t.label.isOpen=!0},t.label.close=function(){t.label._close(),t.label.isOpen=!1},t.marker.addListener("click",function(){t.label.isOpen?t.label.close():t.label.open(e)}),e.addListener("click",function(){t.label.close()}),t.label.addListener("closeclick",function(){t.label.close()})}(e,t))}window.initMap=function(){var e=new google.maps.Map(document.getElementById("map"),{center:n.get("mapCenter"),zoom:n.get("zoomLevel"),gestureHandling:"greedy",fullscreenControl:!1,streetViewControl:!0,mapTypeControl:!0,clickableIcons:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID]}});!function(e){var t=document.createElement("input");t.setAttribute("id","pac-input"),t.setAttribute("class","controls"),t.setAttribute("type","text"),t.setAttribute("placeholder","Search Gyms and Pokestops");var o=document.createElement("div");o.setAttribute("class","pac-container  pac-logo"),e.controls[google.maps.ControlPosition.TOP_LEFT].push(t),e.searchBox=$(t),e.searchBox.prop("disabled",!0),e.searchBox.dropdown=$(o),e.searchBox.dropdown.appendTo("body"),$(document).click(function(){e.searchBox.dropdown.hide()}),e.searchBox.click(function(e){e.stopPropagation()}),e.searchBox.dropdown.add=function(t){var o=document.createElement("div");o.setAttribute("class","pac-item");var n=document.createElement("span");n.setAttribute("class","pac-icon pac-icon-"+t.type);var a=document.createElement("span");a.setAttribute("class","pac-item-query"),a.innerHTML='<span class="pac-item-query">'+t.name+"</span>";var s=document.createElement("span");s.innerHTML=t.description||"",o.appendChild(n),o.appendChild(a),o.appendChild(s),e.searchBox.dropdown[0].appendChild(o),$(o).click(function(){e.panTo(t.location),t.label.open(e)})},e.searchBox.on("input",function(t){if(e.searchBox.dropdown.empty(),e.features&&e.features.nameLookup){var o=e.features.nameLookup.search(t.currentTarget.value),n=o.filter(function(e){return e.isShown()});$.each(n.slice(0,4),function(t,o){e.searchBox.dropdown.add(o)}),e.searchBox.dropdown.show()}})}(e),function(e){e.drawS2Cells=function(t){var o=(e.s2Cells||[]).slice(0,-200);$.each(o,function(e,t){t.hide()});var n=(e.s2Cells||[]).slice(-200);$.merge(n,t),$.each(n,function(t,o){o.shouldShow()?o.isShown()||(o.draw(e),o.show(e)):o.hide()}),e.s2Cells=n},e.updateS2Cells=function(){e.cancelS2CellUpdate(),e.pendingS2CellUpdate=setTimeout(function(){var t=function(e){if(!e.getBounds())return[];var t=e.getBounds(),o=t.getSouthWest(),a=t.getNorthEast(),s=S2.S2LatLng.fromDegrees(o.lat(),o.lng()),l=S2.S2LatLng.fromDegrees(a.lat(),a.lng()),r=S2.S2LatLngRect.fromLatLng(s,l),i=[];return $.each(n.get("s2Cells"),function(t,o){if(e.shouldDisplayCellLevel(o)){var a=new S2.S2RegionCoverer;a.setMinLevel(o),a.setMaxLevel(o),a.setMaxCells(50);var s=a.getCoveringCells(r);$.each(s,function(t,o){var a=new S2.S2Cell(o);a.hide=function(){a.polygon&&a.polygon.setMap(null)},a.show=function(e){a.polygon&&a.polygon.setMap(e)},a.shouldShow=function(){return $.inArray(""+a.level,n.get("s2Cells"))>-1&&e.shouldDisplayCellLevel(a.level)},a.isShown=function(){return a.polygon&&a.polygon.map},a.draw=function(e){a.polygon||function(e,t){function o(e){var t=S2.S2LatLng.fromPoint(e);return{lat:t.latDegrees.toNumber(),lng:t.lngDegrees.toNumber()}}var a=[o(t.getVertex(0)),o(t.getVertex(1)),o(t.getVertex(2)),o(t.getVertex(3))],s=n.get("s2CellColors")[t.level];t.polygon=new google.maps.Polygon({paths:a,strokeColor:s,strokeOpacity:.75,strokeWeight:2+(20-t.level)/4,fillColor:s,fillOpacity:0,zIndex:120-t.level})}(0,a)},i.push(a)})}}),i}(e);e.drawS2Cells(t)},800)},e.cancelS2CellUpdate=function(){e.pendingS2CellUpdate&&clearTimeout(e.pendingS2CellUpdate)},e.shouldDisplayCellLevel=function(t){var o=void 0;return o=1==t||2==t?0:t,a.isMobile()&&o>0&&(o-=1),e.getZoom()>=o},google.maps.event.addListener(e,"idle",e.updateS2Cells),google.maps.event.addListener(e,"bounds_changed",e.cancelS2CellUpdate)}(e),function(e){e.showFeatures=function(t){$.each(e.features,function(o,n){n.show(e,t)})},function(e){return function(){var e=$.ajax({type:"GET",url:"https://api.pokemongonorwich.uk/pois?action=count",dataType:"json"});return Promise.resolve(e)}().then(function(t){for(var o=Math.ceil(t/250),n=[],a=0;a<o;++a){var r=s(250,250*a).then(function(e){return l(e)}).then(function(t){return $.each(t,function(t,o){o.show(e)}),t});n.push(r)}return Promise.all(n)}).then(function(e){return e.reduce(function(e,t){return e.concat(t)},[])})}(e).then(function(t){e.features=t,e.features.nameLookup=new Fuse(e.features,{shouldSort:!0,threshold:.5,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:["name"]}),$("#pac-input").prop("disabled",!1)})}(e),function(e){Promise.resolve($.getJSON("/data/parks.geojson")).then(function(t){var o=new google.maps.Data;o.addGeoJson(t),o.setStyle({fillColor:"green"}),o.show=function(t){!1===t?o.setMap(null):o.setMap(e)},e.parksLayer=o,e.parksLayer.show(n.get("showParks"))})}(e),function(e){function t(){for(var t="",o=1;o<=20;++o){var a="";e.shouldDisplayCellLevel(o)?(a+='<option value="'+o+'">',a+=o):(a+='<option value="'+o+'"disabled>',a+=o+" - zoom in"),t+=a+="</option>"}$("[name='select-s2-cells']").html(t),$("[name='select-s2-cells']").selectpicker("val",n.get("s2Cells")),$("[name='select-s2-cells']").selectpicker("refresh")}google.maps.event.addListener(e,"click",function(){$(".settings").collapse("hide")}),$('[name="toggle-gyms"]').bootstrapSwitch(),$('[name="toggle-gyms"]').bootstrapSwitch("state",n.get("showGyms")),$('[name="toggle-gyms"]').on("switchChange.bootstrapSwitch",function(t,o){n.set("showGyms",o),e.showFeatures()}),$("[name='toggle-pokestops']").bootstrapSwitch(),$("[name='toggle-pokestops']").bootstrapSwitch("state",n.get("showPokestops")),$('[name="toggle-pokestops"]').on("switchChange.bootstrapSwitch",function(t,o){n.set("showPokestops",o),e.showFeatures()}),$("[name='toggle-portals']").bootstrapSwitch(),$("[name='toggle-portals']").bootstrapSwitch("state",n.get("showPortals")),$('[name="toggle-portals"]').on("switchChange.bootstrapSwitch",function(t,o){n.set("showPortals",o),e.showFeatures()}),$("[name='toggle-parks']").bootstrapSwitch(),$("[name='toggle-parks']").bootstrapSwitch("state",n.get("showParks")),$('[name="toggle-parks"]').on("switchChange.bootstrapSwitch",function(t,o){n.set("showParks",o),e.parksLayer.show(o)}),$("[name='toggle-highlight-new-features']").bootstrapSwitch(),$("[name='toggle-highlight-new-features']").bootstrapSwitch("state",n.get("highlightNewFeatures")),$('[name="toggle-highlight-new-features"]').on("switchChange.bootstrapSwitch",function(t,o){n.set("highlightNewFeatures",o),e.showFeatures(function(e){return e.isNew})}),google.maps.event.addListener(e,"idle",function(){n.set("mapCenter",{lat:e.getCenter().lat(),lng:e.getCenter().lng()}),n.set("zoomLevel",e.getZoom())}),t(),google.maps.event.addListener(e,"idle",t),$("[name='select-s2-cells']").selectpicker({size:5,dropupAuto:!1}),$("[name='select-s2-cells']").on("changed.bs.select",function(){n.set("s2Cells",$(this).val()||[]),e.updateS2Cells()}),$(".select-s2-cells-wrapper .bs-select-all").prop("disabled",!0)}(e)}}]);
//# sourceMappingURL=map.min.js.map