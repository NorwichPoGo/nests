!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(e,t,n){"use strict";var o=location.protocol+"//"+location.host+location.pathname;e.exports={urlParameter:function(e){var t=decodeURIComponent(window.location.search.substring(1)).split("&"),n=void 0;return $.each(t,function(t,o){var r=o.split("="),a=r[0],i=r[1];if(a==e&&void 0!==i)return n=i,!1}),n},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},coordinateToLatLng:function(e){return new google.maps.LatLng(e[0],e[1])},dateToString:function(e){function t(e){return e<10?"0"+e:e}return t(e.getFullYear())+"-"+t(e.getMonth())+"-"+t(e.getDate())},isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)},coordsFromString:function(e){if(e){var t=e.split(",");if(t&&2===t.length){var n=$.map(t,function(e){return parseFloat(e)});if((0==n[0]||n[0])&&(0==n[1]||n[1]))return n}}},BASE_URL:o,NESTING_SPECIES:[1,4,7,10,13,16,19,21,23,25,27,29,32,35,37,39,41,43,46,48,50,52,54,56,58,60,63,66,69,72,74,77,79,81,84,86,90,92,95,96,98,100,102,104,111,116,118,120,123,124,125,126,127,129,133,138,140,152,155,158,161,163,165,167,170,177,183,187,190,191,193,194,200,202,203,206,209,211,213,215,216,218,220,223,228,252,255,258,261,263,265,273,276,278,283,285,293,296,299,300,304,307,309,316,318,320,322,325,333,339,341,343,353,355,363,370]}},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(t,n,o){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.feature=t,Array.isArray(n)?this.clickTargets=n:this.clickTargets=[n],this.label=new google.maps.InfoWindow(o),this.isOpen=!1,$.each(this.clickTargets,function(e,t){t.addListener("click",function(){r.toggle(t.map)})}),this.label.addListener("closeclick",function(){r.close()})}return o(e,[{key:"open",value:function(e){this.label.setPosition(this.feature.location),this.label.open(e),this.isOpen=!0}},{key:"close",value:function(){this.label.close(),this.isOpen=!1}},{key:"toggle",value:function(e){this.isOpen?this.close():this.open(e)}}]),e}();e.exports=r},function(e,t,n){"use strict";var o=n(0),r={get:function(e){var t=r.settings[e],n=localStorage.getItem(e);if(void 0===t.getURLValue&&(t.getURLValue=function(){return o.urlParameter(e)}),t.getURLValue&&0!=t.getURLValue){var a=t.getURLValue();a&&(n=a)}return void 0===n||null===n?t.defaultValue:"boolean"==t.type?"true"==n:"float"==t.type?parseFloat(n):"json"==t.type?JSON.parse(n):n},set:function(e,t){var n=r.settings[e];n.getURLValue=!1,"json"==n.type?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,t)},settings:{showGyms:{type:"boolean",defaultValue:!0},showPokestops:{type:"boolean",defaultValue:!1},showPortals:{type:"boolean",defaultValue:!1},showParks:{type:"boolean",defaultValue:!1},highlightNewFeatures:{type:"boolean",defaultValue:!1},exGymsOnly:{type:"boolean",defaultValue:!1},s2Cells:{type:"json",defaultValue:[]},s2CellColors:{type:"json",defaultValue:{1:"#FF6F00",2:"#F57F17",3:"#827717",4:"#33691E",5:"#1B5E20",6:"#004D40",7:"#006064",8:"#01579B",9:"#0D47A1",10:"#1A237E",11:"#6A1B9A",12:"#AD1457",13:"#b71c1c",14:"#BF360C",15:"#FF7043",16:"#FFCA28",17:"#FDD835",18:"#00796B",19:"#0288D1",20:"#64B5F6"}},mapCenter:{type:"json",defaultValue:{lat:52.63282,lng:1.29732}},zoomLevel:{type:"float",defaultValue:13}}};e.exports=r},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(0),a=n(1),i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.id=t.id,this.name=t.name,this.region=$.map(t.coords,function(e){return r.coordinateToLatLng(e)}),this.center=r.coordinateToLatLng([t.latitude,t.longitude]),this.location=this.center}return o(e,[{key:"draw",value:function(e,t){t&&this.hide(),this.polygon&&!t||(this.polygon=this._createPolygon(),this.showMarker&&(this.marker=this._createMarker()),this.showLabel&&(this.label=this._createLabel()))}},{key:"show",value:function(e,t){(r.isFunction(t)||t)&&this.draw(e,!0),this.isShown()||(this.draw(e),this.polygon.setMap(e),this.marker&&this.marker.setMap(e))}},{key:"hide",value:function(){this.polygon&&this.polygon.setMap(null),this.marker&&this.marker.setMap(null)}},{key:"isShown",value:function(){return this.polygon&&this.polygon.map}},{key:"_createPolygon",value:function(){return new google.maps.Polygon({paths:this.region,fillColor:"blue",fillOpacity:.5,strokeColor:"blue",strokeOpacity:1,strokeWeight:0})}},{key:"_createMarker",value:function(){return new google.maps.Marker({position:this.location,zIndex:this.isNew?30:20})}},{key:"_createLabel",value:function(){var e='\n      <div class="polygon-label">\n        <div class="polygon-label-name">\n          <b>'+this.name+"</b>\n        </div>\n      </div>";return new a(this,this.polygon,{content:e})}},{key:"showMarker",get:function(){return!1}},{key:"showLabel",get:function(){return!0}}]),e}();e.exports=i},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(0),a=n(2),i=n(1),s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.id=t.id,this.cssId=this.id.toLowerCase().replace(/\./g,"_"),this.name=t.name,this.coords=[t.latitude,t.longitude],this.imageURL=t.image,this.type=t.type.toLowerCase(),this.dateAdded=t.dateAdded,this.location=r.coordinateToLatLng(this.coords)}return o(e,[{key:"draw",value:function(e,t){t&&this.hide(),this.marker&&!t||(this.marker=this._createMarker(),this._createLabel&&(this.label=this._createLabel()))}},{key:"show",value:function(e,t){(r.isFunction(t)||t)&&this.draw(e,!0),this.isShown()||(this.draw(e),this.marker.setMap(e))}},{key:"hide",value:function(){this.marker&&this.marker.setMap(null)}},{key:"isShown",value:function(){return this.marker&&this.marker.map}},{key:"_getMarkerIcon",value:function(){return this.isNew&&a.get("highlightNewFeatures")?this.constructor.markerIcons.new:this.constructor.markerIcons.normal}},{key:"_createMarker",value:function(){return new google.maps.Marker({position:this.location,icon:{url:this._getMarkerIcon(),scaledSize:new google.maps.Size(30,30),anchor:new google.maps.Point(15,30)},zIndex:this.isNew?30:20})}},{key:"_createLabel",value:function(){var e='\n      <div class="feature-label">\n        <div class="feature-label-name">\n          <b>'+this.name+"</b>\n        </div>\n      </div>";return new i(this,this.marker,{content:e,pixelOffset:new google.maps.Size(0,-30)})}},{key:"icon",get:function(){return this.type}}]),e}();e.exports=s},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t||{},this.map=t.map,this.lookup=t.lookup,this.matchFilter=t.matchFilter,this.size=t.size||4,this.searchBox=this._createInput(),this.dropdown=this._createDropdown(),this._attachInputListener(),this.options.placeholder&&this.setPlaceholder(this.options.placeholder),this.options.startDisabled&&this.disable()}return o(e,[{key:"enable",value:function(){this.searchBox.prop("disabled",!1)}},{key:"disable",value:function(){this.searchBox.prop("disabled",!0)}},{key:"setPlaceholder",value:function(e){this.searchBox.attr("placeholder",e)}},{key:"clear",value:function(){this.dropdown.empty()}},{key:"add",value:function(e){var t=this,n=document.createElement("div");if(n.setAttribute("class","pac-item"),e.icon){var o=document.createElement("span");o.setAttribute("class","pac-icon pac-icon-"+e.icon),n.appendChild(o)}var r=document.createElement("span");if(r.setAttribute("class","pac-item-query"),r.innerHTML=e.name,n.appendChild(r),e.description){var a=document.createElement("span");a.innerHTML=e.description,n.appendChild(a)}this.dropdown[0].appendChild(n),$(n).click(function(){t.map.panTo(e.location),e.label&&e.label.open&&e.label.open(t.map)})}},{key:"_createInput",value:function(){var e=$(document.createElement("input"));return e.attr("id","pac-input"),e.attr("class","controls"),e.attr("type","text"),e}},{key:"_createDropdown",value:function(){var e=$(document.createElement("div"));return e.attr("class","pac-container  pac-logo"),e.appendTo("body"),e}},{key:"_attachInputListener",value:function(){var e=this;this.searchBox.on("input",function(t){if(e.clear(),e.lookup){var n=e.lookup(t.currentTarget.value);e.matchFilter&&(n=n.filter(e.matchFilter)),$.each(n.slice(0,e.size),function(t,n){e.add(n)}),e.dropdown.show()}})}},{key:"input",get:function(){return this.searchBox[0]}}]),e}();e.exports=r},,,function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(3),a=n(2),i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=new S2.S2Cell(e),o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{id:e,coords:[t.s2PointToCoord(n.getVertex(0)),t.s2PointToCoord(n.getVertex(1)),t.s2PointToCoord(n.getVertex(2)),t.s2PointToCoord(n.getVertex(3))]}));return o.cell=n,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),o(t,[{key:"shouldShow",value:function(){var e=""+this.cell.level,t=a.get("s2Cells");return $.inArray(e,t)>-1}},{key:"_createPolygon",value:function(){var e=a.get("s2CellColors")[this.cell.level];return console.log(this.region),new google.maps.Polygon({paths:this.region,strokeColor:e,strokeOpacity:.75,strokeWeight:2+(20-this.cell.level)/4,fillColor:e,fillOpacity:0,clickable:!1,zIndex:120-this.cell.level})}},{key:"showMarker",get:function(){return!1}},{key:"showLabel",get:function(){return!1}}]),t}();i.s2PointToCoord=function(e){var t=S2.S2LatLng.fromPoint(e);return[t.latDegrees.toNumber(),t.lngDegrees.toNumber()]},e.exports=i},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(4),a=n(2),i=n(1),s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),o(t,[{key:"shouldShow",value:function(){return a.get("showPortals")}},{key:"_createLabel",value:function(){var e='\n      <div id="feature-label-'+this.cssId+'" class="feature-label">\n        <div class="name">'+this.name.trim()+'</div>\n        <div class="options">\n          <div class="update">\n            <div class="option-heading">Update to:</div>\n            <div class="update-to pokestop"></div>\n            <div class="update-to gym"></div>\n          </div>\n        </div>\n      </div>';return new i(this,this.marker,{content:e,pixelOffset:new google.maps.Size(0,-30)})}}]),t}();s.markerIcons={normal:"/assets/images/portal.png",new:"/assets/images/new_portal.png"},e.exports=s},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(4),a=n(2),i=n(1),s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),o(t,[{key:"shouldShow",value:function(){return a.get("showPokestops")}},{key:"_createLabel",value:function(){var e='\n      <div id="feature-label-'+this.cssId+'" class="feature-label">\n        <div class="name">'+this.name.trim()+'</div>\n        <div class="options">\n          <div class="update">\n            <div class="option-heading">Update to:</div>\n            <div class="update-to portal"></div>\n            <div class="update-to gym"></div>\n          </div>\n        </div>\n      </div>';return new i(this,this.marker,{content:e,pixelOffset:new google.maps.Size(0,-30)})}}]),t}();s.markerIcons={normal:"/assets/images/pokestop.png",new:"/assets/images/new_pokestop.png"},e.exports=s},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(4),a=n(2),i=n(1),s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.exEligibility=e.exEligibility.toLowerCase(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),o(t,[{key:"shouldShow",value:function(){return!!a.get("showGyms")&&(!a.get("exGymsOnly")||(this.isExEligible||this.maybeExEligible))}},{key:"_getMarkerIcon",value:function(){var e=this.isNew&&a.get("highlightNewFeatures");return e&&this.isExEligible?this.constructor.markerIcons.newEx:e&&this.maybeExEligible?this.constructor.markerIcons.newMaybeEx:e?this.constructor.markerIcons.new:this.isExEligible?this.constructor.markerIcons.ex:this.maybeExEligible?this.constructor.markerIcons.maybeEx:this.constructor.markerIcons.normal}},{key:"_createMarker",value:function(){var e=20;return this.isNew?e=26:this.isExEligible?e=24:this.maybeExEligible&&(e=22),new google.maps.Marker({position:this.location,icon:{url:this._getMarkerIcon(),scaledSize:new google.maps.Size(30,30),anchor:new google.maps.Point(22,30)},zIndex:e})}},{key:"_createLabel",value:function(){var e="";this.isExEligible?e='<span class="ex">EX</span>':this.maybeExEligible&&(e='<span class="ex">EX?</span>');var t='\n      <div id="feature-label-'+this.cssId+'" class="feature-label">\n        <div class="name">\n          <b>'+this.name.trim()+"</b>"+e+'\n        </div>\n        <div class="options">\n          <div class="update">\n            <div class="option-heading">Update to:</div>\n            <div class="update-to portal"></div>\n            <div class="update-to pokestop"></div>\n          </div>\n        </div>\n      </div>';return new i(this,this.marker,{content:t,pixelOffset:new google.maps.Size(-7,-30)})}},{key:"isExEligible",get:function(){return this.exEligibility&&"eligible"==this.exEligibility}},{key:"maybeExEligible",get:function(){return this.exEligibility&&"may be eligible"==this.exEligibility}}]),t}();s.markerIcons={normal:"/assets/images/gym.png",new:"/assets/images/new_gym.png",ex:"/assets/images/ex_gym.png",newEx:"/assets/images/new_ex_gym.png",maybeEx:"/assets/images/maybe_ex_gym.png",newMaybeEx:"/assets/images/new_maybe_ex_gym.png"},e.exports=s},function(e,t,n){"use strict";var o=n(2),r=n(0),a=n(5),i=n(11),s=n(10),l=n(9),c=n(8);function u(e,t){var n=$.ajax({type:"GET",url:"https://api.pokemongonorwich.uk/pois?action=get&count="+e+"&start="+t,dataType:"json"});return Promise.resolve(n)}function p(e){var t=[];return $.each(e,function(e,n){if(n.name&&n.type&&n.latitude&&n.longitude){var o=h(n);t.push(o)}}),t}function h(e){switch(e.type.toLowerCase()){case"gym":return new i(e);case"pokestop":return new s(e);case"portal":return new l(e)}}window.initMap=function(){var e=r.urlParameter("ll"),t=r.coordsFromString(e);t&&o.set("mapCenter",{lat:t[0],lng:t[1]});var n=new google.maps.Map(document.getElementById("map"),{center:o.get("mapCenter"),zoom:o.get("zoomLevel"),gestureHandling:"greedy",fullscreenControl:!1,streetViewControl:!0,mapTypeControl:!0,clickableIcons:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID]}});!function(e){e.searchBox=new a({map:e,matchFilter:function(e){return e.isShown()},size:4,startDisabled:!0}),e.controls[google.maps.ControlPosition.TOP_LEFT].push(e.searchBox.input),$(document).click(function(){e.searchBox.dropdown.hide()}),e.searchBox.searchBox.click(function(e){e.stopPropagation()}),e.searchBox.updateText=function(){var t=[];o.get("showGyms")&&t.push("Gyms"),o.get("showPokestops")&&t.push("Pokestops"),o.get("showPortals")&&t.push("Portals");var n="Search";if(1===t.length)n+=" "+t[0];else if(t.length>1){var r=t.slice(0,-1),a=t.slice(-1);n+=" "+r.join(", ")+" and "+a}e.searchBox.setPlaceholder(n)},e.searchBox.updateText()}(n),function(e){e.drawS2Cells=function(t){var n=(e.s2Cells||[]).slice(0,-200);$.each(n,function(e,t){t.hide()});var o=(e.s2Cells||[]).slice(-200);$.merge(o,t),$.each(o,function(t,n){n.shouldShow()&&e.shouldDisplayCellLevel(n.cell.level)?n.isShown()||(n.draw(e),n.show(e)):n.hide()}),e.s2Cells=o},e.updateS2Cells=function(){e.cancelS2CellUpdate(),e.pendingS2CellUpdate=setTimeout(function(){var t=function(e){if(!e.getBounds())return[];var t=e.getBounds(),n=t.getSouthWest(),r=t.getNorthEast(),a=S2.S2LatLng.fromDegrees(n.lat(),n.lng()),i=S2.S2LatLng.fromDegrees(r.lat(),r.lng()),s=S2.S2LatLngRect.fromLatLng(a,i),l=[];return $.each(o.get("s2Cells"),function(t,n){if(e.shouldDisplayCellLevel(n)){var o=new S2.S2RegionCoverer;o.setMinLevel(n),o.setMaxLevel(n),o.setMaxCells(50);var r=o.getCoveringCells(s);$.each(r,function(e,t){var n=new c(t);l.push(n)})}}),l}(e);e.drawS2Cells(t)},800)},e.cancelS2CellUpdate=function(){e.pendingS2CellUpdate&&clearTimeout(e.pendingS2CellUpdate)},e.shouldDisplayCellLevel=function(t){var n=void 0;return n=1==t||2==t?0:t,r.isMobile()&&n>0&&(n-=1),e.getZoom()>=n},google.maps.event.addListener(e,"idle",e.updateS2Cells),google.maps.event.addListener(e,"bounds_changed",e.cancelS2CellUpdate)}(n),function(e){e.showFeatures=function(t){$.each(e.features,function(n,o){o.shouldShow()?o.show(e,t):o.hide()})},e.getFeatureById=function(t){if(e.features&&!(!e.features.length>0))return e.features.find(function(e){return e.id==t})},function(e){var t=$(document.createElement("div"));return t.attr("class","loader loader-center"),t.appendTo("body"),function(){var e=$.ajax({type:"GET",url:"https://api.pokemongonorwich.uk/pois?action=count",dataType:"json"});return Promise.resolve(e)}().then(function(t){for(var n=Math.ceil(t/250),o=[],r=0;r<n;++r){var a=u(250,250*r).then(function(e){return p(e)}).then(function(t){return $.each(t,function(t,n){n.shouldShow()&&n.show(e)}),t});o.push(a)}return Promise.all(o)}).then(function(e){return t.remove(),e.reduce(function(e,t){return e.concat(t)},[])}).then(function(e){var t=new Date(1990,0,1);return $.each(e,function(e,n){n.dateAdded&&(n.dateAdded=new Date(n.dateAdded),n.dateAdded>t&&(t=n.dateAdded))}),$.each(e,function(e,n){n.dateAdded&&n.dateAdded.getTime()>=t.getTime()&&(n.isNew=!0)}),e})}(e).then(function(t){e.features=t,e.showFeatures(function(e){return e.isNew}),e.features.nameLookup=new Fuse(e.features,{shouldSort:!0,threshold:.5,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:["name"]}),e.searchBox.lookup=function(t){return e.features.nameLookup.search(t)},e.addListener("click",function(){$.each(e.features,function(e,t){t.label&&t.label.close()})}),$.each(["portal","pokestop","gym"],function(t,n){var o=".feature-label .update-to."+n;$("body").on("click",o,function(t){var o=$(t.target).parents(".feature-label");if(o){var r=o.attr("id").replace(/^feature-label-/,"").replace(/_/,".");if(r){var a=e.getFeatureById(r);a&&setTimeout(function(){!function(e,t,n){t.label.close(),t.hide();var o=$.ajax({type:"GET",url:"https://api.pokemongonorwich.uk/pois?action=update&id="+t.id+"&type="+n,dataType:"json"});Promise.resolve(o).then(function(o){if(!o)throw t.show(),new Error("Could not update this portal");if(o.error)throw t.show(),new Error("Could not update this portal: "+o.error);e.features=e.features.filter(function(e){return e.id!=t.id}),t.options.type=n;var r=h(t.options);e.features.push(r),r.show(e),r.label.open(e)})}(e,a,n)})}}})}),e.searchBox.enable()})}(n),function(e){Promise.resolve($.getJSON("/data/parks.geojson")).then(function(t){var n=new google.maps.Data;n.addGeoJson(t),n.setStyle({fillColor:"green"}),n.show=function(t){!1===t?n.setMap(null):n.setMap(e)},e.parksLayer=n,e.parksLayer.show(o.get("showParks"))})}(n),function(e){function t(){for(var t="",n=1;n<=20;++n){var r="";e.shouldDisplayCellLevel(n)?(r+='<option value="'+n+'">',r+=n):(r+='<option value="'+n+'"disabled>',r+=n+" - zoom in"),t+=r+="</option>"}$("[name='select-s2-cells']").html(t),$("[name='select-s2-cells']").selectpicker("val",o.get("s2Cells")),$("[name='select-s2-cells']").selectpicker("refresh")}google.maps.event.addListener(e,"click",function(){$(".settings").collapse("hide")}),$('[name="toggle-gyms"]').bootstrapSwitch(),$('[name="toggle-gyms"]').bootstrapSwitch("state",o.get("showGyms")),$('[name="toggle-gyms"]').on("switchChange.bootstrapSwitch",function(t,n){o.set("showGyms",n),e.showFeatures(),e.searchBox.updateText()}),$("[name='toggle-pokestops']").bootstrapSwitch(),$("[name='toggle-pokestops']").bootstrapSwitch("state",o.get("showPokestops")),$('[name="toggle-pokestops"]').on("switchChange.bootstrapSwitch",function(t,n){o.set("showPokestops",n),e.showFeatures(),e.searchBox.updateText()}),$("[name='toggle-portals']").bootstrapSwitch(),$("[name='toggle-portals']").bootstrapSwitch("state",o.get("showPortals")),$('[name="toggle-portals"]').on("switchChange.bootstrapSwitch",function(t,n){o.set("showPortals",n),e.showFeatures(),e.searchBox.updateText()}),$("[name='toggle-parks']").bootstrapSwitch(),$("[name='toggle-parks']").bootstrapSwitch("state",o.get("showParks")),$('[name="toggle-parks"]').on("switchChange.bootstrapSwitch",function(t,n){o.set("showParks",n),e.parksLayer.show(n)}),$("[name='toggle-highlight-new-features']").bootstrapSwitch(),$("[name='toggle-highlight-new-features']").bootstrapSwitch("state",o.get("highlightNewFeatures")),$('[name="toggle-highlight-new-features"]').on("switchChange.bootstrapSwitch",function(t,n){o.set("highlightNewFeatures",n),e.showFeatures(function(e){return e.isNew})}),$("[name='toggle-ex-gyms-only']").bootstrapSwitch(),$("[name='toggle-ex-gyms-only']").bootstrapSwitch("state",o.get("exGymsOnly")),$('[name="toggle-ex-gyms-only"]').on("switchChange.bootstrapSwitch",function(t,n){o.set("exGymsOnly",n),e.showFeatures(function(e){return"gym"==e.type.toLowerCase()})}),google.maps.event.addListener(e,"idle",function(){o.set("mapCenter",{lat:e.getCenter().lat(),lng:e.getCenter().lng()}),o.set("zoomLevel",e.getZoom())}),t(),google.maps.event.addListener(e,"idle",t),$("[name='select-s2-cells']").selectpicker({size:5}),$("[name='select-s2-cells']").on("changed.bs.select",function(){o.set("s2Cells",$(this).val()||[]),e.updateS2Cells()}),$(".select-s2-cells-wrapper .bs-select-all").prop("disabled",!0)}(n)}}]);
//# sourceMappingURL=map.min.js.map