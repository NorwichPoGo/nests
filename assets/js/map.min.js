!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=9)}([function(e,t,n){"use strict";var o=n(1),r={get:function(e){var t=r.settings[e],n=localStorage.getItem(e);if(void 0===t.getURLValue&&(t.getURLValue=function(){return o.urlParameter(e)}),t.getURLValue&&0!=t.getURLValue){var a=t.getURLValue();a&&(n=a)}return void 0===n||null===n?t.defaultValue:"boolean"==t.type?"true"==n:"float"==t.type?parseFloat(n):"json"==t.type?JSON.parse(n):n},set:function(e,t){var n=r.settings[e];n.getURLValue=!1,"json"==n.type?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,t)},settings:{showGyms:{type:"boolean",defaultValue:!0},showPokestops:{type:"boolean",defaultValue:!1},showPortals:{type:"boolean",defaultValue:!1},showParks:{type:"boolean",defaultValue:!1},highlightNewFeatures:{type:"boolean",defaultValue:!1},s2Cells:{type:"json",defaultValue:[]},s2CellColors:{type:"json",defaultValue:{1:"#FF6F00",2:"#F57F17",3:"#827717",4:"#33691E",5:"#1B5E20",6:"#004D40",7:"#006064",8:"#01579B",9:"#0D47A1",10:"#1A237E",11:"#6A1B9A",12:"#AD1457",13:"#b71c1c",14:"#BF360C",15:"#FF7043",16:"#FFCA28",17:"#FDD835",18:"#00796B",19:"#0288D1",20:"#64B5F6"}},mapCenter:{type:"json",defaultValue:{lat:52.63282,lng:1.29732}},zoomLevel:{type:"float",defaultValue:13}}};e.exports=r},function(e,t,n){"use strict";e.exports={urlParameter:function(e){var t=decodeURIComponent(window.location.search.substring(1)).split("&"),n=void 0;return $.each(t,function(t,o){var r=o.split("="),a=r[0],s=r[1];if(a==e&&void 0!==s)return n=s,!1}),n},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},coordinateToLatLng:function(e){return new google.maps.LatLng(e[0],e[1])},dateToString:function(e){function t(e){return e<10?"0"+e:e}return t(e.getFullYear())+"-"+t(e.getMonth())+"-"+t(e.getDate())},isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)}}},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.feature=t,this.label=new google.maps.InfoWindow(n),this.isOpen=!1,this.feature.marker.addListener("click",function(){o.toggle(o.feature.marker.map)}),this.label.addListener("closeclick",function(){o.close()})}return o(e,[{key:"open",value:function(e){this.label.setPosition(this.feature.location),this.label.open(e),this.isOpen=!0}},{key:"close",value:function(){this.label.close(),this.isOpen=!1}},{key:"toggle",value:function(e){this.isOpen?this.close():this.open(e)}}]),e}();e.exports=r},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(1),a=n(0),s=n(2),i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t.id,this.name=t.name,this.coords=[t.latitude,t.longitude],this.imageURL=t.image,this.type=t.type.toLowerCase(),this.dateAdded=t.dateAdded,this.location=r.coordinateToLatLng(this.coords)}return o(e,[{key:"draw",value:function(e,t){t&&this.hide(),this.marker&&!t||(this.marker=this._createMarker(),this._createLabel&&(this.label=this._createLabel()))}},{key:"show",value:function(e,t){(r.isFunction(t)||t)&&this.draw(e,!0),this.isShown()||(this.draw(e),this.marker.setMap(e))}},{key:"hide",value:function(){this.marker&&this.marker.setMap(null)}},{key:"isShown",value:function(){return this.marker&&this.marker.map}},{key:"_getMarkerIcon",value:function(){return this.isNew&&a.get("highlightNewFeatures")?this.constructor.markerIcons.new:this.constructor.markerIcons.normal}},{key:"_createMarker",value:function(){return new google.maps.Marker({position:this.location,icon:{url:this._getMarkerIcon(),scaledSize:new google.maps.Size(30,30),anchor:new google.maps.Point(15,30)},zIndex:20})}},{key:"_createLabel",value:function(){var e='\n      <div class="feature-label">\n        <div class="feature-label-name">\n          <b>'+this.name+"</b>\n        </div>\n      </div>";return new s(this,{content:e,pixelOffset:new google.maps.Size(0,-30)})}}]),e}();e.exports=i},,function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(1),a=n(0),s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cell=new S2.S2Cell(t)}return o(e,[{key:"draw",value:function(e,t){t&&this.hide(),this.polygon&&!t||(this.polygon=this._createPolygon())}},{key:"show",value:function(e,t){(r.isFunction(t)||t)&&this.draw(e,!0),this.isShown()||(this.draw(e),this.polygon.setMap(e))}},{key:"hide",value:function(){this.polygon&&this.polygon.setMap(null)}},{key:"shouldShow",value:function(){var e=""+this.cell.level,t=a.get("s2Cells");return $.inArray(e,t)>-1}},{key:"isShown",value:function(){return this.polygon&&this.polygon.map}},{key:"_createPolygon",value:function(){var e=[this._s2PointToGMapsLatLng(this.cell.getVertex(0)),this._s2PointToGMapsLatLng(this.cell.getVertex(1)),this._s2PointToGMapsLatLng(this.cell.getVertex(2)),this._s2PointToGMapsLatLng(this.cell.getVertex(3))],t=a.get("s2CellColors")[this.cell.level];return new google.maps.Polygon({paths:e,strokeColor:t,strokeOpacity:.75,strokeWeight:2+(20-this.cell.level)/4,fillColor:t,fillOpacity:0,clickable:!1,zIndex:120-this.cell.level})}},{key:"_s2PointToGMapsLatLng",value:function(e){var t=S2.S2LatLng.fromPoint(e);return r.coordinateToLatLng([t.latDegrees.toNumber(),t.lngDegrees.toNumber()])}}]),e}();e.exports=s},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(3),a=n(0),s=n(2),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),o(t,[{key:"shouldShow",value:function(){return a.get("showPortals")}},{key:"_createLabel",value:function(){var e='\n      <div class="feature-label">\n        <div class="feature-label-name">\n          <b>'+this.name+"</b>\n        </div>\n      </div>";return new s(this,{content:e,pixelOffset:new google.maps.Size(0,-30)})}}]),t}();i.markerIcons={normal:"/assets/images/portal.png",new:"/assets/images/new_portal.png"},e.exports=i},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(3),a=n(0),s=n(2),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),o(t,[{key:"shouldShow",value:function(){return a.get("showPokestops")}},{key:"_createLabel",value:function(){var e='\n      <div class="feature-label">\n        <div class="feature-label-name">\n          <b>'+this.name+"</b>\n        </div>\n      </div>";return new s(this,{content:e,pixelOffset:new google.maps.Size(0,-30)})}}]),t}();i.markerIcons={normal:"/assets/images/pokestop.png",new:"/assets/images/new_pokestop.png"},e.exports=i},function(e,t,n){"use strict";var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n(3),a=n(0),s=n(2),i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),o(t,[{key:"shouldShow",value:function(){return a.get("showGyms")}},{key:"_createMarker",value:function(){return new google.maps.Marker({position:this.location,icon:{url:this._getMarkerIcon(),scaledSize:new google.maps.Size(30,30),anchor:new google.maps.Point(22,30)},zIndex:20})}},{key:"_createLabel",value:function(){var e='\n      <div class="feature-label">\n        <div class="feature-label-name">\n          <b>'+this.name+"</b>\n        </div>\n      </div>";return new s(this,{content:e,pixelOffset:new google.maps.Size(-7,-30)})}}]),t}();i.markerIcons={normal:"/assets/images/gym.png",new:"/assets/images/gym.png"},e.exports=i},function(e,t,n){"use strict";var o=n(0),r=n(1),a=n(8),s=n(7),i=n(6),l=n(5);function c(e,t){var n=$.ajax({type:"GET",url:"https://api.pokemongonorwich.uk/pois?action=get&count="+e+"&start="+t,dataType:"json"});return Promise.resolve(n)}function u(e){var t=new Date(1990,0,1);$.each(e,function(e,n){n.dateAdded&&(n.dateAdded=new Date(n.dateAdded),n.dateAdded>t&&(t=n.dateAdded))});var n=[];return $.each(e,function(e,o){if(o.name&&o.type&&o.latitude&&o.longitude){var r=function(e){switch(e.type.toLowerCase()){case"gym":return new a(e);case"pokestop":return new s(e);case"portal":return new i(e)}}(o);r.dateAdded&&r.dateAdded.getTime()>=t.getTime()&&(r.isNew=!0),n.push(r)}}),n}window.initMap=function(){var e=new google.maps.Map(document.getElementById("map"),{center:o.get("mapCenter"),zoom:o.get("zoomLevel"),gestureHandling:"greedy",fullscreenControl:!1,streetViewControl:!0,mapTypeControl:!0,clickableIcons:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID]}});!function(e){var t=document.createElement("input");t.setAttribute("id","pac-input"),t.setAttribute("class","controls"),t.setAttribute("type","text"),t.setAttribute("placeholder","Search Gyms and Pokestops");var n=document.createElement("div");n.setAttribute("class","pac-container  pac-logo"),e.controls[google.maps.ControlPosition.TOP_LEFT].push(t),e.searchBox=$(t),e.searchBox.prop("disabled",!0),e.searchBox.dropdown=$(n),e.searchBox.dropdown.appendTo("body"),$(document).click(function(){e.searchBox.dropdown.hide()}),e.searchBox.click(function(e){e.stopPropagation()}),e.searchBox.dropdown.add=function(t){var n=document.createElement("div");n.setAttribute("class","pac-item");var o=document.createElement("span");o.setAttribute("class","pac-icon pac-icon-"+t.type);var r=document.createElement("span");r.setAttribute("class","pac-item-query"),r.innerHTML='<span class="pac-item-query">'+t.name+"</span>";var a=document.createElement("span");a.innerHTML=t.description||"",n.appendChild(o),n.appendChild(r),n.appendChild(a),e.searchBox.dropdown[0].appendChild(n),$(n).click(function(){e.panTo(t.location),t.label.open(e)})},e.searchBox.on("input",function(t){if(e.searchBox.dropdown.empty(),e.features&&e.features.nameLookup){var n=e.features.nameLookup.search(t.currentTarget.value),o=n.filter(function(e){return e.isShown()});$.each(o.slice(0,4),function(t,n){e.searchBox.dropdown.add(n)}),e.searchBox.dropdown.show()}})}(e),function(e){e.drawS2Cells=function(t){var n=(e.s2Cells||[]).slice(0,-200);$.each(n,function(e,t){t.hide()});var o=(e.s2Cells||[]).slice(-200);$.merge(o,t),$.each(o,function(t,n){n.shouldShow()&&e.shouldDisplayCellLevel(n.cell.level)?n.isShown()||(n.draw(e),n.show(e)):n.hide()}),e.s2Cells=o},e.updateS2Cells=function(){e.cancelS2CellUpdate(),e.pendingS2CellUpdate=setTimeout(function(){var t=function(e){if(!e.getBounds())return[];var t=e.getBounds(),n=t.getSouthWest(),r=t.getNorthEast(),a=S2.S2LatLng.fromDegrees(n.lat(),n.lng()),s=S2.S2LatLng.fromDegrees(r.lat(),r.lng()),i=S2.S2LatLngRect.fromLatLng(a,s),c=[];return $.each(o.get("s2Cells"),function(t,n){if(e.shouldDisplayCellLevel(n)){var o=new S2.S2RegionCoverer;o.setMinLevel(n),o.setMaxLevel(n),o.setMaxCells(50);var r=o.getCoveringCells(i);$.each(r,function(e,t){var n=new l(t);c.push(n)})}}),c}(e);e.drawS2Cells(t)},800)},e.cancelS2CellUpdate=function(){e.pendingS2CellUpdate&&clearTimeout(e.pendingS2CellUpdate)},e.shouldDisplayCellLevel=function(t){var n=void 0;return n=1==t||2==t?0:t,r.isMobile()&&n>0&&(n-=1),e.getZoom()>=n},google.maps.event.addListener(e,"idle",e.updateS2Cells),google.maps.event.addListener(e,"bounds_changed",e.cancelS2CellUpdate)}(e),function(e){e.showFeatures=function(t){$.each(e.features,function(n,o){o.shouldShow()?o.show(e,t):o.hide()})},function(e){return function(){var e=$.ajax({type:"GET",url:"https://api.pokemongonorwich.uk/pois?action=count",dataType:"json"});return Promise.resolve(e)}().then(function(t){for(var n=Math.ceil(t/250),o=[],r=0;r<n;++r){var a=c(250,250*r).then(function(e){return u(e)}).then(function(t){return $.each(t,function(t,n){n.shouldShow()&&n.show(e)}),t});o.push(a)}return Promise.all(o)}).then(function(e){return e.reduce(function(e,t){return e.concat(t)},[])})}(e).then(function(t){e.features=t,e.features.nameLookup=new Fuse(e.features,{shouldSort:!0,threshold:.5,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:["name"]}),$.each(e.features,function(t,n){e.addListener("click",function(){n.label&&n.label.close()})}),$("#pac-input").prop("disabled",!1)})}(e),function(e){Promise.resolve($.getJSON("/data/parks.geojson")).then(function(t){var n=new google.maps.Data;n.addGeoJson(t),n.setStyle({fillColor:"green"}),n.show=function(t){!1===t?n.setMap(null):n.setMap(e)},e.parksLayer=n,e.parksLayer.show(o.get("showParks"))})}(e),function(e){function t(){for(var t="",n=1;n<=20;++n){var r="";e.shouldDisplayCellLevel(n)?(r+='<option value="'+n+'">',r+=n):(r+='<option value="'+n+'"disabled>',r+=n+" - zoom in"),t+=r+="</option>"}$("[name='select-s2-cells']").html(t),$("[name='select-s2-cells']").selectpicker("val",o.get("s2Cells")),$("[name='select-s2-cells']").selectpicker("refresh")}google.maps.event.addListener(e,"click",function(){$(".settings").collapse("hide")}),$('[name="toggle-gyms"]').bootstrapSwitch(),$('[name="toggle-gyms"]').bootstrapSwitch("state",o.get("showGyms")),$('[name="toggle-gyms"]').on("switchChange.bootstrapSwitch",function(t,n){o.set("showGyms",n),e.showFeatures()}),$("[name='toggle-pokestops']").bootstrapSwitch(),$("[name='toggle-pokestops']").bootstrapSwitch("state",o.get("showPokestops")),$('[name="toggle-pokestops"]').on("switchChange.bootstrapSwitch",function(t,n){o.set("showPokestops",n),e.showFeatures()}),$("[name='toggle-portals']").bootstrapSwitch(),$("[name='toggle-portals']").bootstrapSwitch("state",o.get("showPortals")),$('[name="toggle-portals"]').on("switchChange.bootstrapSwitch",function(t,n){o.set("showPortals",n),e.showFeatures()}),$("[name='toggle-parks']").bootstrapSwitch(),$("[name='toggle-parks']").bootstrapSwitch("state",o.get("showParks")),$('[name="toggle-parks"]').on("switchChange.bootstrapSwitch",function(t,n){o.set("showParks",n),e.parksLayer.show(n)}),$("[name='toggle-highlight-new-features']").bootstrapSwitch(),$("[name='toggle-highlight-new-features']").bootstrapSwitch("state",o.get("highlightNewFeatures")),$('[name="toggle-highlight-new-features"]').on("switchChange.bootstrapSwitch",function(t,n){o.set("highlightNewFeatures",n),e.showFeatures(function(e){return e.isNew})}),google.maps.event.addListener(e,"idle",function(){o.set("mapCenter",{lat:e.getCenter().lat(),lng:e.getCenter().lng()}),o.set("zoomLevel",e.getZoom())}),t(),google.maps.event.addListener(e,"idle",t),$("[name='select-s2-cells']").selectpicker({size:5,dropupAuto:!1}),$("[name='select-s2-cells']").on("changed.bs.select",function(){o.set("s2Cells",$(this).val()||[]),e.updateS2Cells()}),$(".select-s2-cells-wrapper .bs-select-all").prop("disabled",!0)}(e)}}]);
//# sourceMappingURL=map.min.js.map