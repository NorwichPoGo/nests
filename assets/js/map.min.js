!function(){function p(s,l,i){function r(n,e){if(!l[n]){if(!s[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);var o=new Error("Cannot find module '"+n+"'");throw o.code="MODULE_NOT_FOUND",o}var a=l[n]={exports:{}};s[n][0].call(a.exports,function(e){var t;return r(s[n][1][e]||e)},a,a.exports,p,s,l,i)}return l[n].exports}for(var c="function"==typeof require&&require,e=0;e<i.length;e++)r(i[e]);return r}return p}()({1:[function(e,t,n){"use strict";function o(s){var e=document.createElement("input");e.setAttribute("id","pac-input"),e.setAttribute("class","controls"),e.setAttribute("type","text"),e.setAttribute("placeholder","Search Gyms and Pokestops");var t=document.createElement("div");t.setAttribute("class","pac-container  pac-logo"),s.controls[google.maps.ControlPosition.TOP_LEFT].push(e),s.searchBox=$(e),s.searchBox.prop("disabled",!0),s.searchBox.dropdown=$(t),s.searchBox.dropdown.appendTo("body"),$(document).click(function(){s.searchBox.dropdown.hide()}),s.searchBox.click(function(e){e.stopPropagation()}),s.searchBox.dropdown.add=function(e){var t=document.createElement("div");t.setAttribute("class","pac-item");var n=document.createElement("span");n.setAttribute("class","pac-icon pac-icon-"+e.type);var o=document.createElement("span");o.setAttribute("class","pac-item-query"),o.innerHTML='<span class="pac-item-query">'+e.name+"</span>";var a=document.createElement("span");a.innerHTML=e.description||"",t.appendChild(n),t.appendChild(o),t.appendChild(a),s.searchBox.dropdown[0].appendChild(t),$(t).click(function(){s.panTo(e.location),e.label.open(s)})},s.searchBox.on("input",function(e){if(s.searchBox.dropdown.empty(),s.features&&s.features.nameLookup){var t,n=s.features.nameLookup.search(e.currentTarget.value).filter(function(e){return e.isShown()});$.each(n.slice(0,4),function(e,t){s.searchBox.dropdown.add(t)}),s.searchBox.dropdown.show()}})}function a(o){o.drawS2Cells=function(e){var t=(o.s2Cells||[]).slice(0,-200);$.each(t,function(e,t){t.hide()});var n=(o.s2Cells||[]).slice(-200);$.merge(n,e),$.each(n,function(e,t){t.shouldShow()?t.isShown()||(t.draw(o),t.show(o)):t.hide()}),o.s2Cells=n},o.updateS2Cells=function(){o.cancelS2CellUpdate(),o.pendingS2CellUpdate=setTimeout(function(){var e=S(o);o.drawS2Cells(e)},800)},o.cancelS2CellUpdate=function(){o.pendingS2CellUpdate&&clearTimeout(o.pendingS2CellUpdate)},o.shouldDisplayCellLevel=function(e){var t=void 0;return t=1==e||2==e?0:e,k()&&0<t&&(t-=1),o.getZoom()>=t},google.maps.event.addListener(o,"idle",o.updateS2Cells),google.maps.event.addListener(o,"bounds_changed",o.cancelS2CellUpdate)}function s(o){return o.showFeatures=function(n){$.each(o.features,function(e,t){t.show(o,n)})},r(o).then(function(e){o.features=e,o.features.nameLookup=new Fuse(o.features,{shouldSort:!0,threshold:.5,location:0,distance:100,maxPatternLength:32,minMatchCharLength:1,keys:["name"]}),$("#pac-input").prop("disabled",!1)})}function l(n){u().then(function(e){var t=new google.maps.Data;t.addGeoJson(e),t.setStyle({fillColor:"green"}),t.show=function(e){!1===e?t.setMap(null):t.setMap(n)},n.parksLayer=t,n.parksLayer.show(Settings.get("showParks"))})}function i(o){function e(){for(var e="",t=1;t<=20;++t){var n="";o.shouldDisplayCellLevel(t)?(n+='<option value="'+t+'">',n+=t):(n+='<option value="'+t+'"disabled>',n+=t+" - zoom in"),e+=n+="</option>"}$("[name='select-s2-cells']").html(e),$("[name='select-s2-cells']").selectpicker("val",Settings.get("s2Cells")),$("[name='select-s2-cells']").selectpicker("refresh")}google.maps.event.addListener(o,"click",function(){$(".settings").collapse("hide")}),$('[name="toggle-gyms"]').bootstrapSwitch(),$('[name="toggle-gyms"]').bootstrapSwitch("state",Settings.get("showGyms")),$('[name="toggle-gyms"]').on("switchChange.bootstrapSwitch",function(e,t){Settings.set("showGyms",t),o.showFeatures()}),$("[name='toggle-pokestops']").bootstrapSwitch(),$("[name='toggle-pokestops']").bootstrapSwitch("state",Settings.get("showPokestops")),$('[name="toggle-pokestops"]').on("switchChange.bootstrapSwitch",function(e,t){Settings.set("showPokestops",t),o.showFeatures()}),$("[name='toggle-portals']").bootstrapSwitch(),$("[name='toggle-portals']").bootstrapSwitch("state",Settings.get("showPortals")),$('[name="toggle-portals"]').on("switchChange.bootstrapSwitch",function(e,t){Settings.set("showPortals",t),o.showFeatures()}),$("[name='toggle-parks']").bootstrapSwitch(),$("[name='toggle-parks']").bootstrapSwitch("state",Settings.get("showParks")),$('[name="toggle-parks"]').on("switchChange.bootstrapSwitch",function(e,t){Settings.set("showParks",t),o.parksLayer.show(t)}),$("[name='toggle-highlight-new-features']").bootstrapSwitch(),$("[name='toggle-highlight-new-features']").bootstrapSwitch("state",Settings.get("highlightNewFeatures")),$('[name="toggle-highlight-new-features"]').on("switchChange.bootstrapSwitch",function(e,t){Settings.set("highlightNewFeatures",t),o.showFeatures(function(e){return e.isNew})}),google.maps.event.addListener(o,"idle",function(){Settings.set("mapCenter",{lat:o.getCenter().lat(),lng:o.getCenter().lng()}),Settings.set("zoomLevel",o.getZoom())}),e(),google.maps.event.addListener(o,"idle",e),$("[name='select-s2-cells']").selectpicker({size:5,dropupAuto:!1}),$("[name='select-s2-cells']").on("changed.bs.select",function(){Settings.set("s2Cells",$(this).val()||[]),o.updateS2Cells()}),$(".select-s2-cells-wrapper .bs-select-all").prop("disabled",!0)}function r(s){var l=250;return c().then(function(e){for(var t=Math.ceil(e/l),n=[],o=0;o<t;++o){var a=p(l,o*l).then(function(e){return g(e)}).then(function(e){return $.each(e,function(e,t){t.show(s)}),e});n.push(a)}return Promise.all(n)}).then(function(e){return e.reduce(function(e,t){return e.concat(t)},[])})}function c(){var e=$.ajax({type:"GET",url:"https://api.pokemongonorwich.uk/pois?action=count",dataType:"json"});return Promise.resolve(e)}function p(e,t){var n=$.ajax({type:"GET",url:"https://api.pokemongonorwich.uk/pois?action=get&count="+e+"&start="+t,dataType:"json"});return Promise.resolve(n)}function g(e){var t=location.protocol+"//"+location.host+location.pathname,o=new Date(1990,0,1);$.each(e,function(e,t){t.dateAdded&&(t.dateAdded=new Date(t.dateAdded),t.dateAdded>o&&(o=t.dateAdded))});var a=[];return $.each(e,function(e,n){n.type&&n.latitude&&n.longitude&&(n.type=n.type.toLowerCase(),n.location=y([n.latitude,n.longitude]),n.permalinkName=n.id,n.permalink=t+"?"+n.type+"="+n.id,n.dateAdded&&n.dateAdded.getTime()>=o.getTime()&&(n.isNew=!0),n.hide=function(){n.marker&&n.marker.setMap(null)},n.show=function(e,t){this.shouldShow()?(t&&t(n)&&this.draw(e,!0),this.isShown()||(this.draw(e),this.marker.setMap(e))):this.hide()},n.shouldShow=function(){if("gym"==n.type&&Settings.get("showGyms")||"pokestop"==n.type&&Settings.get("showPokestops")||"portal"==n.type&&Settings.get("showPortals"))return!0},n.isShown=function(){return n.marker&&n.marker.map},n.draw=function(e,t){t?(this.hide(),h(e,n)):n.marker||h(e,n)},a.push(n))}),a}function u(){return Promise.resolve($.getJSON("/data/parks.geojson"))}function d(e,t,n){e.panTo(t.location),e.setZoom(n||17)}function h(e,t){var n={gym:"/assets/images/gym.png",new_gym:"/assets/images/gym.png",pokestop:"/assets/images/pokestop.png",new_pokestop:"/assets/images/new_pokestop.png",portal:"/assets/images/portal.png",new_portal:"/assets/images/new_portal.png"},o=void 0;o=Settings.get("highlightNewFeatures")&&t.isNew?n["new_"+t.type]:n[t.type];var a="gym"==t.type?22:15,s=void 0;s=n[t.type]?new google.maps.Marker({position:t.location,icon:{url:o,scaledSize:new google.maps.Size(30,30),anchor:new google.maps.Point(a,30)},zIndex:20}):new google.maps.Marker({position:t.location,zIndex:20}),t.marker=s;var l=void 0;"gym"==t.type?l=m(t):"pokestop"==t.type?l=f(t):"portal"==t.type&&(l=w(t)),l&&(t.label=l,v(e,t))}function m(e){var t,n,o='\n    <div class="feature-label">\n      <div class="feature-label-name">\n        <b>'+(e.name||"Gym")+'</b>\n      </div>\n      <div class="feature-label-description">\n        '+(""+(e.description||"")).replace(/\\n/gi,"<br />")+"\n      </div>\n    </div>";return new google.maps.InfoWindow({content:o,pixelOffset:new google.maps.Size(-7,-30)})}function f(e){var t,n,o='\n    <div class="feature-label">\n      <div class="feature-label-name">\n        <b>'+(e.name||"Pokestop")+'</b>\n      </div>\n      <div class="feature-label-description">\n        '+(e.description||"").replace(/\\n/gi,"<br />")+"\n      </div>\n    </div>";return new google.maps.InfoWindow({content:o,pixelOffset:new google.maps.Size(0,-30)})}function w(e){var t,n,o='\n    <div class="feature-label">\n      <div class="feature-label-name">\n        <b>'+(e.name||"Portal")+'</b>\n      </div>\n      <div class="feature-label-description">\n        '+(e.description||"").replace(/\\n/gi,"<br />")+"\n      </div>\n    </div>";return new google.maps.InfoWindow({content:o,pixelOffset:new google.maps.Size(0,-30)})}function v(e,t){t.label.isOpen=!1,t.label._open=t.label.open,t.label._close=t.label.close,t.label.open=function(e){t.label.setPosition(t.location),t.label._open(e),t.label.isOpen=!0},t.label.close=function(){t.label._close(),t.label.isOpen=!1},t.marker.addListener("click",function(){t.label.isOpen?t.label.close():t.label.open(e)}),e.addListener("click",function(){t.label.close()}),t.label.addListener("closeclick",function(){t.label.close()})}function S(a){if(!a.getBounds())return[];var e=a.getBounds(),t=e.getSouthWest(),n=e.getNorthEast(),o=S2.S2LatLng.fromDegrees(t.lat(),t.lng()),s=S2.S2LatLng.fromDegrees(n.lat(),n.lng()),l=S2.S2LatLngRect.fromLatLng(o,s),i=[];return $.each(Settings.get("s2Cells"),function(e,t){if(a.shouldDisplayCellLevel(t)){var n=new S2.S2RegionCoverer;n.setMinLevel(t),n.setMaxLevel(t),n.setMaxCells(50);var o=n.getCoveringCells(l);$.each(o,function(e,t){var n=new S2.S2Cell(t);n.hide=function(){n.polygon&&n.polygon.setMap(null)},n.show=function(e){n.polygon&&n.polygon.setMap(e)},n.shouldShow=function(){return-1<$.inArray(""+n.level,Settings.get("s2Cells"))&&a.shouldDisplayCellLevel(n.level)},n.isShown=function(){return n.polygon&&n.polygon.map},n.draw=function(e){n.polygon||b(e,n)},i.push(n)})}}),i}function b(e,t){function n(e){var t=S2.S2LatLng.fromPoint(e);return{lat:t.latDegrees.toNumber(),lng:t.lngDegrees.toNumber()}}var o=[n(t.getVertex(0)),n(t.getVertex(1)),n(t.getVertex(2)),n(t.getVertex(3))],a=Settings.get("s2CellColors")[t.level];t.polygon=new google.maps.Polygon({paths:o,strokeColor:a,strokeOpacity:.75,strokeWeight:2+(20-t.level)/4,fillColor:a,fillOpacity:0,zIndex:120-t.level})}function y(e){return new google.maps.LatLng(e[0],e[1])}function k(){var e;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}window.initMap=function(){var e=new google.maps.Map(document.getElementById("map"),{center:Settings.get("mapCenter"),zoom:Settings.get("zoomLevel"),gestureHandling:"greedy",fullscreenControl:!1,streetViewControl:!0,mapTypeControl:!0,clickableIcons:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID]}});o(e),a(e),s(e),l(e),i(e)}},{}]},{},[1]);
//# sourceMappingURL=map.min.js.map